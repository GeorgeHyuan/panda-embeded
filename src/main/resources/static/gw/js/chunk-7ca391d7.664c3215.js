(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ca391d7","chunk-52ed442e","chunk-2d238110"],{"0495":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",[n("template",{slot:"header"},[n("el-breadcrumb",[n("el-breadcrumb-item",[e._v("当前位置")]),n("el-breadcrumb-item",[e._v("智能巡检")]),n("el-breadcrumb-item",{attrs:{to:{path:"/refresh"}}},[e._v("巡检记录")])],1)],1),n("d2-card",{staticClass:"box-card d2-mr"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("i",{staticClass:"fa fa-list-ol"}),n("span",[e._v("巡检记录列表")])]),n("d2-crud",{ref:"d2Crud",attrs:{columns:e.columns,data:e.data,"selection-row":"",loading:e.loading,options:e.options,pagination:e.pagination,"row-handle":e.rowHandle},on:{detailsOpen:e.detailsOpen,"sort-change":e.sortChange,download:e.download,"selection-change":e.handleSelectionChange,"pagination-current-change":e.paginationCurrentChange}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("el-form",{staticClass:"d2-form",attrs:{"label-position":"right",inline:!0,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-row",[n("el-col",{attrs:{span:20}},[n("el-row",{attrs:{gutter:10}},[n("el-form-item",{attrs:{label:"任务名称:"}},[n("el-input",{attrs:{clearable:"",placeholder:"请输入任务名称"},model:{value:e.appname,callback:function(t){e.appname=t},expression:"appname"}})],1),n("el-form-item",{attrs:{label:"是否报警:"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.taskType,callback:function(t){e.taskType=t},expression:"taskType"}},e._l(e.warningOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"巡检时间:"}},[n("el-date-picker",{attrs:{type:"daterange","range-separator":"至",clearable:!0,"default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions0,"start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),n("el-form-item",{attrs:{"label-width":"0px"}},[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.puery}},[e._v("查询")])],1)],1)],1),n("el-col",{attrs:{span:4}},[n("div",{staticClass:"d2-form-fr"},[n("el-form-item",[n("el-button",{attrs:{type:"warning",icon:"fa fa-download",loading:e.submitLoading},on:{click:e.addOpen}},[e._v("导出列表")])],1),n("el-form-item",[n("el-button",{attrs:{type:"warning",icon:"el-icon-s-check"},on:{click:e.shenheAll}},[e._v("批量审核")])],1)],1)])],1)],1)],1)])],1),n("shenheAllOpen",{ref:"shenheAllOpen",on:{getappList:e.getappList}}),n("detailsOpen",{ref:"detailsOpen"})],2)},i=[],o=n("9951"),r=n("fe94"),s=n("6477"),l=n("948a"),c=n("f732"),d=n("c8b8"),u={name:"app-manage",components:{detailsOpen:l["default"],shenheAllOpen:d["default"]},mixins:[s["a"],o["a"],r["default"]],data:function(){return{submitLoading:!1,ids:[],appname:"",taskType:"",taskState:[1,6],time:"",wordLoading:!1}},computed:{},created:function(){this.getappList()},methods:{paginationCurrentChange:function(e){this.pagination.currentPage=e,this.getappList()},puery:function(){this.pagination.currentPage=1,this.getappList()},handleSelectionChange:function(e){this.ids=e},getappList:function(){var e=this;this.data=[],this.loading=!0;var t={current:this.pagination.currentPage,size:this.pagination.pageSize,name:this.appname,statusList:this.taskState,startTime:this.time[0]||null,startTimeEnd:this.time[1]||null};c["a"].getRecordPage(t).then((function(t){e.data=t.data.records,e.pagination.total=t.data.total})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1}))},sortChange:function(e){e.column;var t=e.prop,n=e.order;this.pagination.sortName=t,this.pagination.sortOrder="descending"===n?"desc":"ascending"===n?"asc":null,this.getappList()},deleteapp:function(){if(0===this.ids.length)this.$message({message:"还没有选择操作应用，请勾选一条数据再进行操作",type:"warning"});else{var e=[];this.ids.map((function(t){e.push(t.id)})),this.removeApi(e)}},removeRow:function(e){var t=e.row,n=[];n.push(t.id),this.removeApi(n)},removeApi:function(e){var t=this;this.$confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c["a"].batchDelete(e.join(",")).then((function(e){var n=e.code;"0"===n&&(t.$message({type:"success",message:"删除成功!"}),t.getappList())})).catch((function(){}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},editOpen:function(e){var t=e.row;this.$refs.editOpen.open(t.id)},addOpen:function(){var e=this;this.submitLoading=!0,c["a"].recordExportForExcel().then((function(t){var n=new Blob([t],{type:"application/msexcel;charset=UTF-8"}),a=window.URL.createObjectURL(n),i=document.createElement("a");i.style.display="none",i.href=a,i.setAttribute("download","巡检记录.xls"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a),e.$message({type:"success",message:"导出成功!"})})).finally((function(){e.submitLoading=!1})).catch((function(){e.submitLoading=!1}))},download:function(e){var t=e.row;if(t.fileUrl){var n=t.fileUrl,a=document.createElement("a");a.style.display="none",a.href=n,a.setAttribute("download","".concat(t.name,".docx")),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n),this.$message({type:"success",message:"导出成功！"})}else this.$message({type:"warning",message:"文件生成中，请稍后重试！"})},detailsOpen:function(e){var t=e.row;this.$router.push({path:"recordChild/"+t.id})},shenheAll:function(){if(!this.ids.length)return this.$message({message:"还没有选择巡检记录，请勾选一条数据再进行操作",type:"warning"}),!1;this.$refs.shenheAllOpen.open(this.ids)}}},p=u,m=n("2877"),f=Object(m["a"])(p,a,i,!1,null,null,null);t["default"]=f.exports},6477:function(e,t,n){"use strict";t["a"]={data:function(){var e=this,t=this;return{selectDate:null,pickerOptions0:{disabledDate:function(e){var n=e.getTime(),a=new Date(new Date((new Date).toLocaleDateString()).getTime()+864e5-1);if(t.selectDate){var i=(new Date).getFullYear(),o=(new Date).getMonth()+1,r=new Date(i+"-"+o+"-01 00:00:00").getTime();return t.selectDate.getMonth()+1===Number(o)?n>a||n<r:t.selectDate.getMonth()+1!==e.getMonth()+1}return n>a},onPick:function(t){!t.maxDate&&t.minDate?e.selectDate=t.minDate:e.selectDate=null}}}}}},c8b8:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("dialog-container",{attrs:{title:"全部审核",width:"400px",height:"400px",visible:e.visible,submitLoading:e.submitLoading,appendBody:!0,confirmText:"确认"},on:{"update:visible":function(t){e.visible=t},closed:e.handleClosed,closeDialog:e.close,comfirmDialog:e.comfirmDialog}},[n("div",{staticClass:"dialog-box"},[n("el-form",{ref:"ruleForm",staticClass:"d2-form d2-form-check",attrs:{"label-position":"right",model:e.formInline,"label-width":"90px"}},[n("el-col",{staticClass:"rules",attrs:{span:24}},[n("el-form-item",{attrs:{label:"审核结果"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.formInline.addr,callback:function(t){e.$set(e.formInline,"addr",t)},expression:"formInline.addr"}},e._l(e.shenheOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),n("el-col",{staticClass:"rules",attrs:{span:24}},[n("el-form-item",{attrs:{label:"审核意见"}},[n("el-input",{attrs:{type:"textarea",rows:4,placeholder:"审核结果修正"},model:{value:e.formInline.suggestion,callback:function(t){e.$set(e.formInline,"suggestion",t)},expression:"formInline.suggestion"}})],1)],1)],1)],1)])},i=[],o=n("f732"),r={components:{},data:function(){return{visible:!1,submitLoading:!1,formInline:{addr:"1",suggestion:""},shenheOptions:[{value:"1",label:"正常"},{value:"0",label:"异常"}],data:[]}},computed:{},mounted:function(){},methods:{open:function(e){this.data=e,this.formInline={addr:"1",suggestion:""},this.init()},close:function(){this.visible=!1},handleClosed:function(){var e=this;this.$nextTick((function(){e.$refs.ruleForm.resetFields()}))},init:function(){this.visible=!0},comfirmDialog:function(){var e=this;this.submitLoading=!0;var t=JSON.parse(JSON.stringify(this.formInline)),n=[];this.data.map((function(e){n.push({id:e.id,addr:t.addr,suggestion:t.suggestion})})),o["a"].updateRecordItemByRecordId(n).then((function(t){var n=t.code;"0"===n&&(e.visible=!1,e.$emit("getappList"),e.$message.success("操作成功"))})).catch((function(e){console.log(e)})).finally((function(){e.submitLoading=!1}))}}},s=r,l=n("2877"),c=Object(l["a"])(s,a,i,!1,null,null,null);t["default"]=c.exports},f732:function(e,t,n){"use strict";var a=n("9bd2"),i=VUE_APP_API_STATION;t["a"]={getRecordPage:function(e){return Object(a["a"])({url:"".concat(i,"/inspection/record/getRecordPage"),method:"post",data:e})},recordExportForExcel:function(e){return Object(a["a"])({url:"".concat(i,"/inspection/record/recordExportForExcel"),responseType:"blob",method:"post",data:{}})},recordExportForWord:function(e){return Object(a["a"])({url:"".concat(i,"/inspection/record/recordExportForWord"),responseType:"blob",method:"post",data:e})},updateRecordItemStatus:function(e){return Object(a["a"])({url:"".concat(i,"/inspection/recordItem/updateRecordItemStatus"),method:"post",data:e})},updateRecordItemByRecordId:function(e){return Object(a["a"])({url:"".concat(i,"/inspection/record/updateRecordItemByRecordId"),method:"post",data:e})}}},fe94:function(e,t,n){"use strict";n.r(t),t["default"]={data:function(){var e=this;this.$createElement;return{data:[],columns:[{title:"序号",key:"",width:60,formatter:function(t,n,a,i){return(e.pagination.currentPage-1)*e.pagination.pageSize+(i+1)}},{title:"任务名称",key:"name",showOverflowTooltip:!0},{title:"任务类型",key:"type",showOverflowTooltip:!0,formatter:function(t,n,a,i){var o="";return e.taskTypeOptions.forEach((function(e){a===e.value&&(o=e.label)})),o}},{title:"状态",key:"status",showOverflowTooltip:!0,formatter:function(t,n,a,i){var o="";return e.taskStateOptions.forEach((function(e){a===e.value&&(o=e.label)})),o}},{title:"启动类型",key:"execType",showOverflowTooltip:!0,formatter:function(t,n,a,i){var o="";return e.implementOptions.forEach((function(e){a===e.value&&(o=e.label)})),o}},{title:"启动时间",key:"startTime",width:180,showOverflowTooltip:!0},{title:"结束时间",key:"endTime",width:180,showOverflowTooltip:!0},{title:"总巡检点位",key:"inspectPointTotal",showOverflowTooltip:!0},{title:"报警点位",key:"inspectPointAbnormal",showOverflowTooltip:!0,formatter:function(e,t,n,a){return n||0}},{title:"正常点位",key:"",showOverflowTooltip:!0,formatter:function(e,t,n,a){return(e.inspectPointTotal||0)-(e.inspectPointAbnormal||0)}},{title:"已巡检点位",key:"",showOverflowTooltip:!0,formatter:function(e,t,n,a){return e.inspectPointChecked||0}},{title:"未巡检点位",key:"",showOverflowTooltip:!0,formatter:function(e,t,n,a){return(e.inspectPointTotal||0)-(e.inspectPointChecked||0)}},{title:"审核状态",key:"addr",width:80,showOverflowTooltip:!0,component:{render:function(e,t){return"1"===t.addr?e("el-tag",{attrs:{type:"success"}},["已审核"]):"0"===t.addr?e("el-tag",{attrs:{type:"danger"}},["未审核"]):void 0}}}],loading:!1,pagination:{currentPage:1,pageSize:20,total:0},rowHandle:{fixed:"right",width:110,custom:[{emit:"detailsOpen",text:"详情",size:"mini",type:"primary",icon:"el-icon-tickets",circle:!0},{emit:"download",text:"导出报告",size:"mini",type:"warning",icon:"fa fa-download",circle:!0,disabled:function(e,t){return"0"===t.addr}}]},options:{stripe:!0,height:"calc(100vh - 333px)",border:!0}}}}}}]);