(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76b3f9ca"],{"1c36":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-card",{staticClass:"box-card d2-mb",staticStyle:{height:"100%"},attrs:{cardHeaderShow:!0},on:{cardRefresh:e.cardRefresh}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"fa fa-video-camera"}),a("span",[e._v("实时视频")])]),a("div",{staticClass:"video-style",attrs:{id:"video-style"}},[a("div",{staticClass:"tou-kuang",on:{dblclick:e.dbVideoClick}}),a("player",{ref:"player",staticClass:"dplayer",attrs:{url:e.addrSrc,widthStyle:"100%",heightStyle:"100%"}})],1)])},r=[],c=a("868c"),i=a("2f62"),o=a("7658"),s=a("3709"),l=a("f5b2");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f={components:{player:c["a"]},data:function(){return{addrSrc:"",active_item:{},fullScreen:!0}},computed:d(d({},Object(i["c"])("d2admin",{devTreeNode:"tree/devTreeNode"})),{},{devId:function(){return this.devTreeNode.id}}),watch:{devId:function(e,t){e&&this.getBasicInfo()}},methods:{cardRefresh:function(){},getBasicInfo:function(){var e=this;s["a"].basicInfo({rawId:this.devTreeNode.rawId,type:1}).then((function(t){var a=null,n=null;if(t&&t.data){t.data.forEach((function(t){"devNum"===t.url?a=t.name:"channelNum"===t.url?n=t.name:"id"===t.url&&(e.active_item.nodeId=t.name)}));var r="webrtc://".concat(serverIp_app_live,"/live/").concat(a,"@").concat(n);r!==e.addrSrc&&(e.addrSrc=r,e.videoPlayer()),e.goPreset(e.devTreeNode.rawId,e.active_item.nodeId)}})).finally((function(){}))},videoPlayer:function(){var e=this;setTimeout((function(){e.playerDom=!0,e.$refs.player.playerInitWatch(e.addrSrc)}),0)},goPreset:function(e,t){s["a"].querySpaceIns({id:e}).then((function(e){if(e&&e.data.length){var a={cameraId:t,point:e.data[0].token};o["a"].movePresetByAli(a).then((function(e){}))}}))},playerOpen:function(e){this.active_item=e,this.controlFlag="true"===e.aiAddr,this.addrSrc=e.addrSrc},dbVideoClick:function(){var e=document.getElementById("video-style");this.fullScreen?Object(l["a"])(e):Object(l["b"])(e)}},mounted:function(){var e=this;window.onresize=function(){e.fullScreen=!e.fullScreen}},beforeDestroy:function(){this.$refs.player&&this.$refs.player.clearRtc()}},h=f,m=(a("e35c"),a("2877")),y=Object(m["a"])(h,n,r,!1,null,"571d9520",null);t["default"]=y.exports},"1c79":function(e,t,a){"use strict";a("c92c")},"315e":function(e,t,a){"use strict";a("f0f9")},3709:function(e,t,a){"use strict";var n=a("9bd2"),r=VUE_APP_API_STATION,c=VUE_APP_API;t["a"]={basicInfo:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/getRawBasicBySpaceId"),method:"post",params:e})},querySpaceIns:function(e){return Object(n["a"])({url:"".concat(c,"/device/space/queryRawIns"),method:"post",data:e})},basicInfoRow:function(e){return Object(n["a"])({url:"".concat(c,"/device/raw/getRawBasicAndRawGroup/").concat(e),method:"get"})},confirmResult:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/confirmResult"),method:"post",params:e})},inspectSingleHst:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/inspectSingleHst"),method:"post",data:e})},startIdentificate:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/startIdetity"),method:"post",params:e})},getIdentityStatus:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/getIdentityStatus"),method:"post",params:e})},initializeIdentityStatus:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/initializeIdentityStatus"),method:"post",params:e})},getLatestRecord:function(e){return Object(n["a"])({url:"".concat(r,"/dynamicMonControl/getLatestRecord/").concat(e),method:"post"})},defectAnalysis:function(e){return Object(n["a"])({url:"".concat(r,"/inspection/defect/defectAnalysis/").concat(e),method:"get"})}}},7658:function(e,t,a){"use strict";var n=a("9bd2"),r=VUE_APP_API_LIVE,c=VUE_APP_API_STATION,i=VUE_APP_API;t["a"]={ptzcontrollerStart:function(e){return Object(n["a"])({url:"".concat(c,"/camera/ptzcontrollerStart"),method:"post",data:e})},ptzcontrollerStop:function(e){return Object(n["a"])({url:"".concat(c,"/camera/ptzcontrollerStop"),method:"post",data:e})},getBasicsBySpaceIdAndType:function(e){return Object(n["a"])({url:"".concat(c,"/station/video/getBasicsBySpaceIdAndType"),method:"post",data:e})},getOrganizeSpaceIds:function(e){return Object(n["a"])({url:"".concat(c,"/station/video/getOrganizeSpaceIds"),method:"post",params:e})},getPageVideo:function(e){var t=e.data;return Object(n["a"])({url:"".concat(c,"/station/video/getBasicsBySpaceIdAndType?spaceId=").concat(t.spaceId,"&type=assistance_camera"),method:"get"})},startPlay:function(e){var t=e.data;return Object(n["a"])({url:"".concat(r,"/").concat(t.room,"/").concat(t.channel,"/startPlay"),method:"get"})},stopPlay:function(e){var t=e.data;return Object(n["a"])({url:"".concat(r,"/").concat(t.room,"/").concat(t.channel,"/stopPlay"),method:"get"})},ptzStart:function(e){var t=e.data;return Object(n["a"])({url:"".concat(c,"/common/sipPtzCmd?idAndChild=").concat(t.idAndChild,"&ptzcmd=").concat(t.direct),method:"get"})},eventMediaUpload:function(e){var t=e.data;return Object(n["a"])({url:"".concat(r,"/").concat(t.deviceId,"/").concat(t.evtId,"/").concat(t.protocol,"/").concat(t.type,"/eventMediaUpload"),method:"get"})},movePresetByAli:function(e){return Object(n["a"])({url:"".concat(c,"/camera/movePreset"),method:"post",data:{id:e.cameraId,presetToken:e.point}})},snapShot:function(e){return Object(n["a"])({url:"".concat(i,"/camera/snapShot"),method:"post",data:e})},getDataPointDetailYx:function(e){return Object(n["a"])({url:"".concat(i,"/device/space/queryDgtByRawId"),method:"post",data:e})},getDataPointDetailYc:function(e){return Object(n["a"])({url:"".concat(i,"/device/space/queryAnalogByRawId"),method:"post",data:e})},cameraStatus:function(e){return Object(n["a"])({url:"".concat(i,"/real/cameraStatus"),method:"post",params:e})},pauseTask:function(e){return Object(n["a"])({url:"".concat(c,"/camera/").concat(e,"/pauseTask"),method:"post"})},restartTask:function(e){return Object(n["a"])({url:"".concat(c,"/camera/").concat(e,"/restartTask"),method:"post"})},stopTask:function(e){return Object(n["a"])({url:"".concat(c,"/camera/").concat(e,"/stopTask"),method:"post"})},queryChannel:function(){return Object(n["a"])({url:"".concat(i,"/srs/queryChannel"),method:"get"})},querySession:function(){return Object(n["a"])({url:"".concat(i,"/srs/querySession"),method:"get"})},sip_invite:function(e){return Object(n["a"])({url:"".concat(VUE_APP_API_LIVE_KONG,"?action=sip_invite&id=").concat(e.id,"&chid=").concat(e.chid),method:"get"})},snapShotAndExcuteBase:function(e){return Object(n["a"])({url:"".concat(c,"/camera/snapShotAndExcuteBase"),method:"post",data:e})}}},"868c":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"videoClass",style:"width:"+e.widthStyle+";height:"+e.heightStyle+";"},["RTMP"===e.activeSetting.name?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"videoClass",style:"width:"+e.widthStyle+";height:"+e.heightStyle+";"},[a("div",{style:"width:"+e.widthStyle+";height:"+e.heightStyle+";",attrs:{id:"player"+e.index}}),a("div",{staticClass:"kbpsClass"},[e._v(e._s(e.kbps))]),a("flashOpen",{ref:"flashOpen"})],1):a("video",{ref:"rtc_media_player",staticStyle:{"pointer-events":"none"},style:"width:"+e.widthStyle+";height:"+e.heightStyle,attrs:{id:"rtc_media_player"+e.index,controls:"",autoplay:e.autoplay,controlslist:"nofullscreen nodownload noremoteplayback"}})])},r=[],c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:"flash权限快捷入口",width:"800px",visible:e.visible,"show-footer":!1,appendBody:!0},on:{"update:visible":function(t){e.visible=t},closed:e.handleClosed,closeDialog:e.close,comfirmDialog:e.comfirmDialog}},[a("div",{staticClass:"dialog-box"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("p",[e._v("\n            请点击下面的图标，启用Flash\n        ")]),a("div",{staticClass:"hide",attrs:{id:"main_flash_hdr"}}),a("p",[e._v("\n            若没有见到这个图标或无法通过图标开启权限，请点击链接下载"),a("a",{staticStyle:{color:"#fff"},attrs:{href:"/video/flash_tutorial.pdf",download:"flash_tutorial.pdf"}},[e._v("flash操作指南")])])])],1)],1)])},i=[],o={components:{},data:function(){return{visible:!1}},props:{},methods:{open:function(e){var t=this;this.visible=!0,$("#main_flash_hdr").hide(),setTimeout((function(){t.playerWin()}),0)},handleClosed:function(){this.visible=!1},playerWin:function(){$("#main_flash_hdr").html('\n            <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="100%" height="100%"> \n                <param name="movie" value="srs_player/release/srs_player.swf"> \n                <param name="quality" value="autohigh"> \n                <param name="swliveconnect" value="true"> \n                <param name="allowScriptAccess" value="always"> \n                <param name="bgcolor" value="#0"> \n                <param name="allowFullScreen" value="true"> \n                <param name="wmode" value="opaque"> \n                <param name="FlashVars" value="log=1"> \n                <param name="flashvars" value="id=1&on_player_ready=__on_flash_ready"> \n                <embed src="srs_player/release/srs_player.swf" width="100%" height="100%" \n                    quality="autohigh" bgcolor="#0" align="middle" allowfullscreen="true" allowscriptaccess="always" \n                    type="application/x-shockwave-flash" swliveconnect="true" wmode="opaque" \n                    flashvars="id=1&on_player_ready=__on_flash_ready" \n                    pluginspage="http://www.macromedia.com/go/getflashplayer"> \n            </object> \n            '),$("#main_flash_hdr").show()},close:function(){this.handleClosed()},comfirmDialog:function(){}}},s=o,l=a("2877"),u=Object(l["a"])(s,c,i,!1,null,null,null),d=u.exports,p=a("7658"),f=a("2f62");function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v={name:"about",components:{flashOpen:d},props:{index:{type:[Number,String],default:null},widthStyle:{type:String,default:"900px"},heightStyle:{type:String,default:"320px"},autoplay:{default:!0}},data:function(){return{loading:!1,startPlay:null,url:"",pc:null,srs_player:null,query:null,autoLoadPage:null,player:null,kbps:""}},computed:m({},Object(f["c"])("d2admin",{activeSetting:"theme/activeSetting"})),methods:{playerInit:function(){var e=this;"RTMP"===this.activeSetting.name?this.$nextTick((function(){e.srs_player=null;var t=null,a=parse_query_string();if(t=e.url,!e.srs_player){$("#div_container"+e.index).remove();var n=$("<div/>");$(n).attr("id","div_container"+e.index),$("#player"+e.index).append(n);var r=$("<div/>");$(r).attr("id","player_id"+e.index),$(n).append(r);var c=$("#player"+e.index).width(),i=$("#player"+e.index).height();e.srs_player=new SrsPlayer("player_id"+e.index,c,i),e.srs_player.on_player_ready=function(){if(t.indexOf(".m3u8")>0&&2,a.buffer)for(var e=0;e<bts.length-1;e++){var n=bts[e],r=bts[e+1];if(Number(a.buffer)>=n&&Number(a.buffer)<r){n;break}}this.play(t)},e.srs_player.on_player_timer=function(t,a,n,r,c){e.kbps=n.toFixed(0)+"kbps"},e.srs_player.start()}})):this.$nextTick((function(){e.pc=null,e.startPlay=function(){$("#rtc_media_player"+e.index).show();var t=parse_rtmp_url(e.url),a=window.location.protocol;e.pc&&e.pc.close(),e.pc=new RTCPeerConnection(null),e.pc.onaddstream=function(t){$("#rtc_media_player"+e.index).prop("srcObject",t.stream)},new Promise((function(t,a){e.pc.addTransceiver("audio",{direction:"recvonly"}),e.pc.addTransceiver("video",{direction:"recvonly"}),e.pc.createOffer((function(e){t(e)}),(function(e){a(e)}))})).then((function(t){return e.pc.setLocalDescription(t).then((function(){return t}))})).then((function(e){return new Promise((function(n,r){var c=t.port||1985,i=t.user_query.play||"/rtc/v1/play/";i.lastIndexOf("/")!==i.length-1&&(i+="/");var o=a+"//"+t.server+":"+c+i;for(var s in t.user_query)"api"!==s&&"play"!==s&&(o+="&"+s+"="+t.user_query[s]);o=o.replace(i+"&",i+"?");var l={api:o,streamurl:t.url,clientip:null,sdp:e.sdp};$.ajax({type:"POST",url:o,data:JSON.stringify(l),contentType:"application/json",dataType:"json"}).done((function(e){if(e.code)r(e);else{var i=a+"//"+t.server+":"+c+"/rtc/v1/nack/";$("#sessionid").html(e.sessionid),$("#simulator-drop").attr("href",i+"?drop=1&username="+e.sessionid),n(e.sdp)}})).fail((function(e){r(e)}))}))})).then((function(t){return e.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}))})).catch((function(t){throw e.pc.close(),$("#rtc_media_player"+e.index).hide(),t}))},$("#rtc_media_player"+e.index).hide();var t=parse_query_string();"true"===t.autostart&&($("#rtc_media_player"+e.index).prop("muted",!0),e.startPlay())}))},playerInitWatch:function(e){var t=this;this.url=e;var a=this.url.split("/live/")[1];p["a"].queryChannel().then((function(n){var r=!1;if(n.data.map((function(e){e.id===a&&(r=!0)})),r)if("RTMP"===t.activeSetting.name){var c=t.hasUsableFlash();c||t.$refs.flashOpen.open(),t.url="rtmp://".concat(serverIp_app_live,":1935/live")+e.split("live")[1],t.playerInit()}else t.startPlay(),t.setIntervalFun();else{var i={id:a.split("@")[0],chid:a.split("@")[1]};p["a"].queryChannel(i).then((function(a){if("RTMP"===t.activeSetting.name){var n=t.hasUsableFlash();n||t.$refs.flashOpen.open(),t.url="rtmp://".concat(serverIp_app_live,":1935/live")+e.split("live")[1],t.playerInit()}else t.startPlay(),t.setIntervalFun()}))}}))},playerInitWatchCarousel:function(e){this.url=e,this.startPlay(),$("#rtc_media_player"+this.index).prop("muted",!0)},clearRtc:function(){"RTMP"===this.activeSetting.name?this.srs_player&&(this.kbps="",this.srs_player.stop(),this.srs_player=null):this.pc&&(this.pc.close(),$("#rtc_media_player"+this.index).hide())},setIntervalFun:function(){},hasUsableFlash:function(){var e;return e="undefined"!==typeof window.ActiveXObject?new ActiveXObject("ShockwaveFlash.ShockwaveFlash"):navigator.plugins["Shockwave Flash"],!!e},zhuapai:function(){var e,t,a=1;t=$("#output"),e=$("#rtc_media_player"+this.index).get(0);var n=function(){var n=document.createElement("canvas");n.width=e.videoWidth*a,n.height=e.videoHeight*a,n.getContext("2d").drawImage(e,0,0,n.width,n.height);var r=document.createElement("img");r.src=n.toDataURL(),t.prepend(r)};n()}},watch:{},mounted:function(){this.playerInit()},destroyed:function(){}},b=v,g=(a("1c79"),a("315e"),Object(l["a"])(b,n,r,!1,null,"57a62aec",null));t["a"]=g.exports},c92c:function(e,t,a){},e35c:function(e,t,a){"use strict";a("f9d9")},f0f9:function(e,t,a){},f5b2:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r}));var n=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},r=function(e){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},f9d9:function(e,t,a){}}]);