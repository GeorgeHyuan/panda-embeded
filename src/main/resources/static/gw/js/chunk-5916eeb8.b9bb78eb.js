(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5916eeb8"],{"0f89":function(e,t,a){},1435:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:"任务执行",width:"800px",height:"400px",visible:e.visible,submitLoading:e.submitLoading,confirmText:"确定",showFooter:!1},on:{"update:visible":function(t){e.visible=t},closed:e.handleClosed,closeDialog:e.close,comfirmDialog:e.comfirmDialog}},[a("div",{staticClass:"dialog-box"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-form",{ref:"ruleForm",staticClass:"d2-form d2-form-check",attrs:{"label-position":"right",model:e.formInline,rules:e.rules,"label-width":"90px"}},[a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1)],1),a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[a("el-select",{attrs:{disabled:"",clearable:"",placeholder:"请选择"},model:{value:e.formInline.type,callback:function(t){e.$set(e.formInline,"type",t)},expression:"formInline.type"}},e._l(e.taskTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"执行方式",prop:"execType"}},[a("el-select",{attrs:{disabled:"",clearable:"",placeholder:"请选择"},on:{change:e.implementChange},model:{value:e.formInline.execType,callback:function(t){e.$set(e.formInline,"execType",t)},expression:"formInline.execType"}},e._l(e.implementOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),3===e.formInline.execType?a("div",[e._l(e.timeStrData,(function(t,i){return[a("el-tag",{key:i+"tag",staticClass:"tagClass"},[e._v(e._s(t.timeType+" "+t.time+" "+t.htime))])]})),e._l(e.timesData,(function(t,i){return[a("el-form",{key:i+"key",staticClass:"demo-form-inline",attrs:{inline:!0,"label-width":"0px",model:e.timesData[i]}},[a("el-form-item",{staticClass:"timeTypeSelect",attrs:{label:"开始时间","label-width":"95px"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.timesData[i].timeType,callback:function(t){e.$set(e.timesData[i],"timeType",t)},expression:"timesData[index].timeType"}},e._l(e.timeOptions,(function(e){return a("el-option",{key:e.value+"timeOptions"+i,attrs:{label:e.label,value:e.value}})})),1)],1),"2"===e.timesData[i].timeType?a("el-form-item",{staticClass:"timeSelect"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.timesData[i].time,callback:function(t){e.$set(e.timesData[i],"time",t)},expression:"timesData[index].time"}},e._l(e.weekOptions,(function(e){return a("el-option",{key:e.value+"weekOptions"+i,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"3"===e.timesData[i].timeType?a("el-form-item",{staticClass:"timeSelect"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.timesData[i].time,callback:function(t){e.$set(e.timesData[i],"time",t)},expression:"timesData[index].time"}},e._l(e.monthOptions,(function(e){return a("el-option",{key:e.value+"monthOptions"+i,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),a("el-form-item",{staticClass:"htimeSelect"},[a("el-time-select",{attrs:{clearable:!1,"picker-options":{start:"00:00",step:"00:01",end:"23:59"},placeholder:"选择时间"},model:{value:e.timesData[i].htime,callback:function(t){e.$set(e.timesData[i],"htime",t)},expression:"timesData[index].htime"}})],1),3===e.formInline.execType?a("el-form-item",{staticClass:"timeAdd"},[a("el-button",{attrs:{type:"primary",circle:"",icon:"fa fa-plus"},on:{click:e.addTime}})],1):e._e(),3===e.formInline.execType?a("el-form-item",{staticClass:"timedelete"},[a("el-button",{attrs:{type:"danger",circle:"",icon:"fa fa-trash"},on:{click:function(t){return e.removeTime(i)}}})],1):e._e()],1)]}))],2):e._e(),2===e.formInline.execType?a("div",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,"label-width":"95px",model:e.execForm}},[a("el-form-item",{attrs:{label:"执行方式",prop:"execType"}},[a("el-date-picker",{attrs:{type:"datetime",clearable:!1,placeholder:"选择日期时间",align:"right","picker-options":e.pickerOptions},model:{value:e.execForm.execDate,callback:function(t){e.$set(e.execForm,"execDate",t)},expression:"execForm.execDate"}})],1)],1)],1):e._e()],1)],1)],1),a("div",{staticClass:"btn-group"},[3===e.formInline.execType?a("el-button",{attrs:{icon:"fa fa-floppy-o",type:"primary",size:"medium",loading:e.submitLoading},on:{click:e.addTime}},[e._v("新增周期")]):e._e(),a("el-button",{attrs:{size:"medium"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{icon:"fa fa-floppy-o",type:"primary",size:"medium",loading:e.submitLoading},on:{click:e.comfirmDialog}},[e._v(e._s(3===e.formInline.execType?"执行并保存":"执行"))])],1)])},l=[],n=a("e1e5"),s=a("9951"),r=a("f0b0"),o=a("6f62"),c=a("2f62");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var b={components:{},mixins:[s["a"]],data:function(){return{visible:!1,submitLoading:!1,formInline:{execType:null,name:"",type:null},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{validator:r["a"],trigger:"blur"},{max:64,message:"最大长度64 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"blur"}],execType:[{required:!0,message:"请选择执行方式",trigger:"blur"}]},rulesTime:{timeType:[{required:!0,message:"请选择时间类型",trigger:"blur"}],time:[{required:!0,message:"请选择时间",trigger:"blur"}],htime:[{required:!0,message:"请选择时分",trigger:"blur"}]},loading:!1,timesData:[{timeType:"1",time:"",htime:"00:00"}],timeStrData:[],execForm:{execDate:""},pickerOptions:{shortcuts:[{text:"一小时后",onClick:function(e){e.$emit("pick",new Date+36e5)}},{text:"明天",onClick:function(e){var t=new Date;t.setTime(t.getTime()+864e5),e.$emit("pick",t)}},{text:"一周后",onClick:function(e){var t=new Date;t.setTime(t.getTime()+6048e5),e.$emit("pick",t)}}],disabledDate:function(e){var t=e.getTime(),a=(new Date).getTime()-864e5;return t<a}}}},computed:u(u({},Object(c["c"])("d2admin",{treeNode:"tree/treeNode"})),{},{deviceId:function(){var e=this.treeNode.id;return e}}),watch:{stepTimeNum:function(e){this.$set(this.formInline,"desc",e)}},mounted:function(){},methods:{open:function(e,t){var a=this;this.$set(this.formInline,"type",e.type),this.$set(this.formInline,"name",e.name),this.$set(this.formInline,"id",e.id),this.$set(this.formInline,"execType",t),this.timesData=[],1===this.formInline.execType||(2===this.formInline.execType?this.execForm.execDate=(new Date).getTime()+6e4:3===this.formInline.execType&&(this.timeStrData=[],e.url&&(this.timesData=JSON.parse(e.url),this.timeStrData=[],this.timesData.map((function(e){var t={timeType:"",time:"",htime:""};t.time=e.time,t.htime=e.htime,"1"===e.timeType?t.timeType="每日":"2"===e.timeType?(t.timeType="每周",t.time="周"+e.time):(t.timeType="每月",t.time=e.time+"号"),a.timeStrData.push(t)}))))),this.init()},close:function(){this.visible=!1},handleClosed:function(){var e=this;this.$nextTick((function(){e.$refs.ruleForm.resetFields()}))},init:function(){this.visible=!0},addTime:function(){this.timesData.push({timeType:"1",time:"",htime:"01:00"})},removeTime:function(e){this.$delete(this.timesData,e)},implementChange:function(e){this.timesData=1===e?[]:[{timeType:"1",time:"",htime:"00:00"}]},comfirmDialog:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.apiFun()}))},apiFun:function(){var e=this;this.submitLoading=!0;var t=JSON.parse(JSON.stringify(this.formInline));t.execTime=this.timesData,t.url=this.timesData,t.execDate=Object(o["b"])(this.execForm.execDate),n["a"].startTask(t).then((function(t){var a=t.code;"0"===a&&(e.$message.success("任务已下发"),e.$emit("getappList"),e.$emit("monthInit"),e.visible=!1)})).finally((function(){e.submitLoading=!1}))}}},d=b,f=(a("a62e"),a("85b4"),a("2877")),v=Object(f["a"])(d,i,l,!1,null,"4dcdad08",null);t["default"]=v.exports},"4c12":function(e,t,a){},"85b4":function(e,t,a){"use strict";a("4c12")},9951:function(e,t,a){"use strict";t["a"]={data:function(){return{implementOptions:[{value:1,label:"立即"},{value:2,label:"定时"},{value:3,label:"周期"}],taskStateOptions:[{value:6,label:"手动停止"},{value:5,label:"等待执行"},{value:4,label:"正在执行"},{value:3,label:"任务暂停"},{value:2,label:"异常终止"},{value:1,label:"已完成"}],taskTypeOptions:[{value:"1",label:"例行巡视"},{value:"2",label:"特殊巡视"},{value:"3",label:"专项巡视"},{value:"4",label:"自定义巡视"}],timeOptions:[{value:"1",label:"每天"},{value:"2",label:"每周"},{value:"3",label:"每月"}],monthOptions:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"},{value:"8",label:"8"},{value:"9",label:"9"},{value:"10",label:"10"},{value:"11",label:"11"},{value:"12",label:"12"},{value:"13",label:"13"},{value:"14",label:"14"},{value:"15",label:"15"},{value:"16",label:"16"},{value:"17",label:"17"},{value:"18",label:"18"},{value:"19",label:"19"},{value:"20",label:"20"},{value:"21",label:"21"},{value:"22",label:"22"},{value:"23",label:"23"},{value:"24",label:"24"},{value:"25",label:"25"},{value:"26",label:"26"},{value:"27",label:"27"},{value:"28",label:"28"},{value:"29",label:"29"},{value:"30",label:"30"},{value:"31",label:"31"}],weekOptions:[{value:"1",label:"周一"},{value:"2",label:"周二"},{value:"3",label:"周三"},{value:"4",label:"周四"},{value:"5",label:"周五"},{value:"6",label:"周六"},{value:"7",label:"周日"}],warningOptions:[{value:1,label:"是"},{value:0,label:"否"}],addrFormat:{"power-infra-gloves-detection":"未带手套","helmet-classify":"未带安全帽"}}}}},a62e:function(e,t,a){"use strict";a("0f89")},e1e5:function(e,t,a){"use strict";var i=a("9bd2"),l=VUE_APP_API,n=VUE_APP_API_STATION;t["a"]={nodeGetById:function(e){return Object(i["a"])({url:"".concat(l,"/device/space/getById/").concat(e),method:"get"})},deleteInspectTaskById:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/deleteInspectTaskById/").concat(e),method:"delete"})},saveInspectTask:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/saveInspectTask"),method:"post",data:e})},updateInspectTask:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/updateInspectTask"),method:"put",data:e})},getPageInspectTask:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/getPageInspectTask"),method:"post",data:e})},getInspectTaskById:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/getInspectTaskById"),method:"post",data:e})},startTask:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/record/startTask"),method:"post",data:e})},getCameraPoint:function(e){return Object(i["a"])({url:"".concat(l,"/device/space/getInspectionPointById"),method:"post",params:e})},getCameraPointType:function(e){return Object(i["a"])({url:"".concat(l,"/device/space/getInspectionPointById?id=").concat(e.id,"&nodeTypeList=").concat(e.nodeTypeList[0],"&nodeTypeList=").concat(e.nodeTypeList[1]),method:"post"})},getCalendar:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/getCalendar"),method:"post",data:e})},getYear:function(e){return Object(i["a"])({url:"".concat(n,"/inspection/task/getYear"),method:"post",data:e})}}},f0b0:function(e,t,a){"use strict";function i(e,t,a){var i=/^[^\s]*$/;if(!i.test(t))return a(new Error("不能有空格"));a()}a.d(t,"a",(function(){return i}))}}]);