(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1fbe8404","chunk-3a6b8d1a","chunk-539ca09a","chunk-97409b40","chunk-3897b5d6","chunk-3f85fc6e","chunk-2d0be070","chunk-2d20f5c2"],{"0579":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:"add"===e.dialogTitle?"新增授权":"编辑授权",width:"500px",showFooter:!0,visible:e.visible},on:{"update:visible":function(t){e.visible=t},closeDialog:e.closeDialog,closed:e.handleClosed,comfirmDialog:e.comfirmDialog}},[e.template?a("d2-form",{ref:"keyForm",staticClass:"eventReport__header__form",attrs:{formOptions:e.formOptions,template:e.template,rules:e.rules},on:{"form-data-change":e.formChange}}):e._e()],1)},n=[],i=a("6c51"),r=a("2ef0"),c=a("8d33"),l={data:function(){return{dialogTitle:"add",visible:!1,uuid:null,formOptions:{labelWidth:"100px",inline:!0},template:{authName:{title:"授权名称",component:{name:"el-input",clearable:!0}},authUser:{title:"执行人员",component:{name:"el-select",options:[],clearable:!0}},choiceKey:{title:"选择钥匙",component:{name:"el-select",options:[],clearable:!0}},choiceLock:{title:"选择锁具",component:{name:"el-select",options:[],clearable:!0}},startTime:{title:"开始时间",component:{name:"el-date-picker",type:"datetime",placeholder:"开始时间",clearable:!0}},endTime:{title:"结束时间",component:{name:"el-date-picker",type:"datetime",placeholder:"结束时间",clearable:!0}}},rules:{authName:[{required:!0,message:"授权名称不能为空",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],authUser:[{required:!0,message:"执行人员不能为空",trigger:"change"}],choiceKey:[{required:!0,message:"钥匙不能为空",trigger:"change"}],choiceLock:[{required:!0,message:"锁具不能为空弄",trigger:"change"}],startTime:[{required:!0,message:"开始时间不能为空",trigger:"change"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"change"}]},editData:[]}},methods:{getAdministratorList:function(){var e=this;this.template.authUser.component.options=[];var t={page:1,pageSize:1e7,userName:"",owneUuid:""};c["a"].administratorList(t).then((function(t){var a=t.rows;a.forEach((function(t){e.template.authUser.component.options.push({label:t.name,value:t.uuid})}))}))},getAllKeyList:function(e){var t=this,a={keyOwner:e};c["a"].getAllKey(a).then((function(e){if(e&&e.data){var a=e.data;console.log(a,"钥匙信息"),t.template.choiceKey.component.options=[],a.forEach((function(e){t.template.choiceKey.component.options.push({label:e.keyName,value:e.uuid})}))}})).catch((function(e){console.log(e)}))},getAllLockList:function(){var e=this;c["a"].getAllLock().then((function(t){if(console.log(t,"锁具信息"),t&&t.data){var a=t.data;e.template.choiceLock.component.options=[],a.forEach((function(t){e.template.choiceLock.component.options.push({label:t.lockName,value:t.uuid})}))}})).catch((function(e){console.log(e)}))},open:function(e,t){var a=this;this.visible=!0,this.dialogTitle=e,"edit"===e&&this.$nextTick((function(){if(console.log(t[0],"当前条数据>>>"),t[0]){a.uuid=t[0]["uuid"];var e={};Object(r["forEach"])(a.template,(function(a,o){e[o]=t[0][o]})),a.$refs.keyForm.setFormData(e)}})),this.getAdministratorList(),this.getAllLockList()},closeDialog:function(){this.visible=!1},handleClosed:function(){this.visible=!1,this.$refs.keyForm.resetFields()},comfirmDialog:function(){var e=this;this.$refs["keyForm"].validate((function(t){if(!t)return console.log("error submit!!"),!1;"add"===e.dialogTitle?e.handleAdd():"edit"===e.dialogTitle&&e.handleEdit()}))},handleAdd:function(){var e=this;console.log(this.$refs.keyForm.formData,"新增的数据");var t=this.$refs.keyForm.formData,a={authName:t.authName,authUser:t.authUser,authKey:t.choiceKey,authLock:t.choiceLock,startTime:Object(i["g"])(t.startTime),endTime:Object(i["g"])(t.endTime)};c["a"].addAuth(a).then((function(t){e.$message({type:"success",message:"新增成功"}),e.handleClosed(),e.$emit("handleList")})).catch((function(e){console.log(e)}))},handleEdit:function(){var e=this,t=this.$refs.keyForm.formData,a={uuid:this.uuid,authName:t.authName,authUser:t.authUser,authKey:t.choiceKey,authLock:t.choiceLock,startTime:Object(i["g"])(t.startTime),endTime:Object(i["g"])(t.endTime)};c["a"].editAuth(a).then((function(t){e.$message({type:"success",message:"编辑成功"}),e.handleClosed(),e.$emit("handleList")})).catch((function(e){console.log(e)}))},handleSearch:function(){var e=this.$refs.form.formData;this.$emit("handleCheck",e)},formChange:function(e){"authUser"===e.key&&(this.$refs.keyForm.setFormData({choiceKey:null}),this.template.choiceKey.component.options=[],this.getAllKeyList(e.value))}},created:function(){}},s=l,u=(a("07c7"),a("2877")),h=Object(u["a"])(s,o,n,!1,null,null,null);t["default"]=h.exports},"07c7":function(e,t,a){"use strict";a("3728")},"2f06":function(e,t,a){"use strict";a.r(t),t["default"]={data:function(){return{columns:[{title:"序号",width:50,key:"serialNumber",showOverflowTooltip:!0},{title:"授权名称",key:"authName",showOverflowTooltip:!0},{title:"执行人员",key:"userName",showOverflowTooltip:!0},{title:"授权钥匙",key:"keyName",showOverflowTooltip:!0},{title:"锁具名称",key:"lockName",showOverflowTooltip:!0},{title:"开始时间",key:"startTime",showOverflowTooltip:!0},{title:"结束时间",key:"endTime",showOverflowTooltip:!0}],loading:!1,pagination:{currentPage:1,pageSize:20,total:0},options:{stripe:!0,height:"calc(100vh - 274px)",border:!0},data:[]}},methods:{},mounted:function(){},created:function(){}}},"325d":function(e,t,a){"use strict";a("97ea")},3728:function(e,t,a){},5676:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d2-clearfix"},[a("d2-form",{ref:"form",staticClass:"eventReport__header__form",attrs:{formOptions:e.formOptions,template:e.template},on:{"form-data-change":e.formChange}})],1)},n=[],i={name:"search-group",components:{},data:function(){this.$createElement;var e=this;return{formOptions:{labelWidth:"100px",inline:!0},template:{authName:{title:"授权名称",component:{name:"el-input",clearable:!0}},authUser:{title:"执行人员",component:{name:"el-input",clearable:!0}},lockName:{title:"锁具名称",component:{name:"el-input",clearable:!0}},searchBtn:{component:{render:function(t){return t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},["查询"])}}}}}},computed:{},created:function(){},methods:{handleSearch:function(){var e=this.$refs.form.formData;this.$emit("handleCheck",e)},formChange:function(e){}}},r=i,c=(a("d151"),a("2877")),l=Object(c["a"])(r,o,n,!1,null,"af17ee4a",null);t["default"]=l.exports},"59b9":function(e,t,a){},"78c0":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",{staticClass:"intelligent-locks"},[a("template",{slot:"header"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("当前位置")]),a("el-breadcrumb-item",{attrs:{to:{path:"/refresh"}}},[e._v(e._s(e.tabDesc))])],1)],1),a("el-radio-group",{on:{change:e.changeTab},model:{value:e.tabPosition,callback:function(t){e.tabPosition=t},expression:"tabPosition"}},[a("el-radio-button",{attrs:{label:1}},[e._v("授权管理")]),a("el-radio-button",{attrs:{label:2}},[e._v("日志管理")])],1),a(e.componentName,{tag:"component",staticStyle:{"margin-top":"10px"}})],2)},n=[],i=a("d8e1"),r=a("9c4b"),c={components:{AuthorizationManage:i["default"],LogManage:r["default"]},data:function(){return{tabPosition:1,tabDesc:"授权管理",componentName:"AuthorizationManage"}},methods:{changeTab:function(){console.log(this.tabPosition,"当前值"),1===this.tabPosition?(this.tabDesc="授权管理",this.componentName="AuthorizationManage"):2===this.tabPosition&&(this.tabDesc="日志管理",this.componentName="LogManage")}}},l=c,s=a("2877"),u=Object(s["a"])(l,o,n,!1,null,null,null);t["default"]=u.exports},"8d33":function(e,t,a){"use strict";var o=a("9bd2"),n=VUE_APP_API_STATION;t["a"]={administratorList:function(e){var t=e.page,a=e.pageSize,i=void 0===a?1e7:a,r=e.userName,c=e.owneUuid;return Object(o["a"])({url:"".concat(n,"/user/getUserList"),method:"post",data:{page:t,pageSize:i,userName:r,owneUuid:c}})},getAllKey:function(e){var t=e.keyOwner;return Object(o["a"])({url:"".concat(n,"/intelligentLocks/key/getAll"),method:"post",data:{keyOwner:t}})},getAllLock:function(){return Object(o["a"])({url:"".concat(n,"/intelligentLocks/lock/getAll"),method:"post"})},addAuth:function(e){var t=e.authName,a=e.authUser,i=e.authKey,r=e.authLock,c=e.startTime,l=e.endTime;return Object(o["a"])({url:"".concat(n,"/intelligentLocks/auth/add"),method:"post",data:{authName:t,authUser:a,authKey:i,authLock:r,startTime:c,endTime:l}})},editAuth:function(e){var t=e.uuid,a=e.authName,i=e.authUser,r=e.authKey,c=e.authLock,l=e.startTime,s=e.endTime;return Object(o["a"])({url:"".concat(n,"/intelligentLocks/auth/update"),method:"post",data:{uuid:t,authName:a,authUser:i,authKey:r,authLock:c,startTime:l,endTime:s}})},deleteAllAuth:function(e){var t=e.uuidList;return Object(o["a"])({url:"".concat(n,"/intelligentLocks/auth/deleteAll"),method:"post",data:{uuidList:t}})},selectAuthInfo:function(e){var t=e.authName,a=e.userName,i=e.lockName,r=e.nowPage,c=e.pageSize;return Object(o["a"])({url:"".concat(n,"/intelligentLocks/auth/find"),method:"post",data:{authName:t,userName:a,lockName:i,nowPage:r,pageSize:c}})}}},"97ea":function(e,t,a){},"9c4b":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"keys-manage"},[a("d2-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("日志列表")]),a("div",{staticClass:"button_box"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleExport}},[e._v("\n          导出\n        ")]),a("el-button",{attrs:{type:"danger"},on:{click:e.handleDel}},[e._v("删除")])],1)]),a("search-group",{on:{handleCheck:e.searchValue}}),a("d2-crud",{staticClass:"equipmentReport-crud",attrs:{columns:e.columns,data:e.data,loading:e.loading,pagination:e.pagination,options:e.options,"selection-row":""},on:{"pagination-current-change":e.paginationCurrentChange,"selection-change":e.handleSelectionChange}})],1)],1)},n=[],i=a("e194"),r=a("b2fb"),c=a("9bd2"),l=VUE_APP_API_STATION,s={addLog:function(e){var t=e.operateTime,a=e.operateUser,o=e.operateType,n=e.keyName,i=e.lockName,r=e.location,s=e.operateStatus;return Object(c["a"])({url:"".concat(l,"/intelligentLocks/logs/add"),method:"post",data:{operateTime:t,operateUser:a,operateType:o,keyName:n,lockName:i,location:r,operateStatus:s}})},deleteAllLog:function(e){var t=e.uuidList;return Object(c["a"])({url:"".concat(l,"/intelligentLocks/logs/deleteAll"),method:"post",data:{uuidList:t}})},selectLog:function(e){var t=e.startTime,a=e.endTime,o=e.operateType,n=e.operateUser,i=e.location,r=e.lockName,s=e.nowPage,u=e.pageSize;return Object(c["a"])({url:"".concat(l,"/intelligentLocks/logs/find"),method:"post",data:{startTime:t,endTime:a,operateType:o,operateUser:n,location:i,lockName:r,nowPage:s,pageSize:u}})},exportLog:function(e){var t=e.startTime,a=e.endTime,o=e.operateType,n=e.operateUser,i=e.location,r=e.uuidList;return Object(c["a"])({url:"".concat(l,"/intelligentLocks/logs/export"),method:"post",responseType:"blob",data:{startTime:t,endTime:a,operateType:o,operateUser:n,location:i,uuidList:r}})}},u=a("6c51"),h={mixins:[r["default"]],components:{SearchGroup:i["default"]},data:function(){return{selectCheckBox:[],parameter:{}}},methods:{initTableData:function(){var e=this,t={startTime:this.parameter.time?Object(u["g"])(this.parameter.time[0]):"",endTime:this.parameter.time?Object(u["g"])(this.parameter.time[1]):"",operateType:this.parameter.operationType,operateUser:this.parameter.operator,location:this.parameter.areaName,lockName:this.parameter.lockName,nowPage:this.pagination.currentPage,pageSize:this.pagination.pageSize};s.selectLog(t).then((function(t){if(e.data=[],t&&t.data){var a=t.data;e.data=a,e.data.map((function(t,a){var o=10*(e.pagination.currentPage-1);e.data[a].serialNumber=a+1+o})),e.pagination.total=t.total}}))},searchValue:function(e){this.parameter=e,this.clearPagenation(),this.initTableData()},clickRow:function(){},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.initTableData()},clearPagenation:function(){this.pagination={currentPage:1,pageSize:20,total:0}},handleSelectionChange:function(e){this.selectCheckBox=e},handleExport:function(){var e=[];this.selectCheckBox.forEach((function(t){e.push(t.uuid)}));var t={startTime:this.parameter.time?Object(u["g"])(this.parameter.time[0]):"",endTime:this.parameter.time?Object(u["g"])(this.parameter.time[1]):"",operateType:this.parameter.operationType,operateUser:this.parameter.operator,location:this.parameter.areaName,lockName:this.parameter.lockName,uuidList:e};s.exportLog(t).then((function(e){var t=new Blob([e],{type:"application/vnd.ms-excel;charset=utf-8"}),a=window.URL.createObjectURL(t),o=document.createElement("a");o.style.display="none",o.href=a,o.setAttribute("download","智能锁具日志列表.xls"),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)})).catch((function(e){console.log(e)}))},handleDel:function(){var e=this;if(this.selectCheckBox.length){var t=[];this.selectCheckBox.forEach((function(e){t.push(e.uuid)})),s.deleteAllLog({uuidList:t}).then((function(t){e.$message({type:"success",message:"删除成功"}),e.initTableData()}))}else this.$message({message:"还没有选择设备，请勾选一条数据再进行操作",type:"warning"})}},created:function(){this.initTableData()}},m=h,d=(a("e376"),a("2877")),p=Object(d["a"])(m,o,n,!1,null,"c55b0ee0",null);t["default"]=p.exports},b2fb:function(e,t,a){"use strict";a.r(t),t["default"]={data:function(){return{columns:[{title:"序号",width:50,key:"serialNumber",showOverflowTooltip:!0},{title:"日志ID",key:"uuid",showOverflowTooltip:!0},{title:"操作时间",key:"operateTime",showOverflowTooltip:!0},{title:"操作人",key:"operateUser",showOverflowTooltip:!0},{title:"操作类型",key:"operateType",showOverflowTooltip:!0,formatter:function(e,t,a,o){return 0===e.operateType?"钥匙开门":1===e.operateType?"要是关门":2===e.operateType?"远程开门":3===e.operateType?"NB钥匙开门":4===e.operateType?"NB钥匙关门":void 0}},{title:"钥匙名称",key:"keyName",showOverflowTooltip:!0},{title:"锁名称",key:"lockName",showOverflowTooltip:!0},{title:"所在区域",key:"location",showOverflowTooltip:!0},{title:"状态",key:"operateStatus",showOverflowTooltip:!0,formatter:function(e,t,a,o){return 1===e.operateStatus?"成功":0===e.operateStatus?"失败":void 0}},{title:"上传时间",key:"createTime",showOverflowTooltip:!0}],loading:!1,pagination:{currentPage:1,pageSize:20,total:0},options:{stripe:!0,height:"calc(100vh - 274px)",border:!0},data:[]}}}},b4bf:function(e,t,a){},cdef:function(e,t,a){"use strict";a("f66e")},d151:function(e,t,a){"use strict";a("b4bf")},d8e1:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"keys-manage"},[a("d2-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("钥匙列表")]),a("div",{staticClass:"button_box",staticStyle:{"text-align":"right","margin-right":"5px",width:"50%"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("\n          新增\n        ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleEdit}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger"},on:{click:e.handleDel}},[e._v("删除")])],1)]),a("search-group",{on:{handleCheck:e.searchValue}}),a("d2-crud",{staticClass:"equipmentReport-crud",attrs:{columns:e.columns,data:e.data,loading:e.loading,pagination:e.pagination,options:e.options,"selection-row":""},on:{"row-click":function(t){return t.target!==t.currentTarget?null:e.clickRow(t)},"pagination-current-change":e.paginationCurrentChange,"selection-change":e.handleSelectionChange}})],1),a("dialog-form",{ref:"dialogForm",on:{handleList:e.initTableData}})],1)},n=[],i=a("5676"),r=a("2f06"),c=a("0579"),l=a("8d33"),s={mixins:[r["default"]],components:{SearchGroup:i["default"],DialogForm:c["default"]},data:function(){return{selectCheckBox:[],parameter:{}}},methods:{initTableData:function(){var e=this,t={authName:this.parameter.authName,userName:this.parameter.authUser,lockName:this.parameter.lockName,nowPage:this.pagination.currentPage,pageSize:this.pagination.pageSize};l["a"].selectAuthInfo(t).then((function(t){if(e.data=[],t&&t.data){var a=t.data;console.log(a,"获取到的数据"),a.forEach((function(t,a){var o=10*(e.pagination.currentPage-1);e.data.push({serialNumber:a+1+o,uuid:t.uuid,authName:t.authName,authUser:t.authUser,choiceKey:t.authKey,choiceLock:t.authLock,startTime:t.startTime,endTime:t.endTime,userName:t.userName,lockName:t.lockName,keyName:t.keyName})})),e.pagination.total=t.total}}))},searchValue:function(e){this.parameter=e,this.clearPagenation(),this.initTableData()},clickRow:function(){},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.initTableData()},clearPagenation:function(){this.pagination={currentPage:1,pageSize:20,total:0}},handleSelectionChange:function(e){this.selectCheckBox=e},handleAdd:function(){this.$refs.dialogForm.open("add")},handleEdit:function(){this.selectCheckBox.length?this.selectCheckBox.length>1?this.$message({message:"只能操作一条数据",type:"warning"}):this.$refs.dialogForm.open("edit",this.selectCheckBox):this.$message({message:"还没有选择设备，请勾选一条数据再进行操作",type:"warning"})},handleDel:function(){var e=this;if(this.selectCheckBox.length){var t=[];this.selectCheckBox.forEach((function(e){t.push(e.uuid)})),l["a"].deleteAllAuth({uuidList:t}).then((function(t){e.$message({type:"success",message:"删除成功"}),e.initTableData()}))}else this.$message({message:"还没有选择设备，请勾选一条数据再进行操作",type:"warning"})}},created:function(){this.initTableData()}},u=s,h=(a("cdef"),a("2877")),m=Object(h["a"])(u,o,n,!1,null,"6bbf350a",null);t["default"]=m.exports},e194:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d2-clearfix keys-manage-search-group"},[a("d2-form",{ref:"form",attrs:{formOptions:e.formOptions,template:e.template},on:{"form-data-change":e.formChange}})],1)},n=[],i={name:"search-group",components:{},data:function(){this.$createElement;var e=this;return{formOptions:{labelWidth:"80px",inline:!0},template:{time:{title:"选择时间",component:{name:"el-date-picker",type:"datetimerange",startPlaceholder:"开始日期",endPlaceholder:"结束日期",size:"mini",clearable:!0}},operationType:{title:"操作类型",component:{name:"el-input",clearable:!0}},operator:{title:"操作人员",component:{name:"el-input",clearable:!0}},lockName:{title:"锁具名称",component:{name:"el-input",clearable:!0}},areaName:{title:"区域名称",component:{name:"el-input",clearable:!0}},searchBtn:{component:{render:function(t){return t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},["查询"])}}}}}},computed:{},created:function(){},methods:{handleSearch:function(){var e=this.$refs.form.formData;this.$emit("handleCheck",e)},formChange:function(e){}}},r=i,c=(a("325d"),a("2877")),l=Object(c["a"])(r,o,n,!1,null,null,null);t["default"]=l.exports},e376:function(e,t,a){"use strict";a("59b9")},f66e:function(e,t,a){}}]);