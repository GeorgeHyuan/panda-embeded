(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-116c3250"],{"1c79":function(e,t,a){"use strict";a("c92c")},"1fc7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",{staticClass:"drawerTreeVideo",attrs:{title:e.title,visible:e.drawer,direction:e.direction,modal:!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.drawer=t}}},[a("el-tree",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree2",attrs:{props:e.defaultProps,"node-key":"id",data:e.treeData,"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","default-expand-all":!0,"expand-on-click-node":!1,"render-content":e.renderContent,"highlight-current":!0},on:{"node-click":e.handleNodeClick}},"el-tree",e.$attrs,!1))],1)},r=[],n=a("5cf4"),o=a("7658"),s={data:function(){return{drawer:!1,direction:"rtl",treeId:"",loading:!1,defaultProps:{children:"children",label:"name",id:"id"},title:"",MouseEvent:null,treeData:[]}},computed:{},methods:{open:function(e,t){this.treeId=e,this.title=t,this.drawer=!0,this.getPointInfo()},handleClose:function(){this.drawer=!1},goPreset:function(e,t){var a={cameraId:t,point:e.token};o["a"].movePresetByAli(a).then((function(e){}))},getPointInfo:function(){var e=this;this.treeData=[],n["a"].getRawInspectionByCamaraId({id:this.treeId}).then((function(t){t&&t.data.length&&(e.treeData=t.data)}))},handleNodeClick:function(e,t,a){this.Node=e,this.Nodes=t,this.MouseEvent=a.$el.childNodes[0].childNodes[0],this.goPreset(e,this.treeId)},renderContent:function(e,t){var a=t.node,i=t.data;t.store;return e("div",{class:"custom-tree-node",attrs:{id:"node"+i.id}},[e("i",{class:"el-icon-video-camera-solid"}),a.label])}}},l=s,c=(a("90af"),a("2877")),d=Object(c["a"])(l,i,r,!1,null,null,null);t["default"]=d.exports},"315e":function(e,t,a){"use strict";a("f0f9")},"67ee":function(e,t,a){"use strict";a("ff66")},"796f":function(e,t,a){"use strict";a("a37b")},"868c":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"videoClass",style:"width:"+e.widthStyle+";height:"+e.heightStyle+";"},["RTMP"===e.activeSetting.name?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"videoClass",style:"width:"+e.widthStyle+";height:"+e.heightStyle+";"},[a("div",{style:"width:"+e.widthStyle+";height:"+e.heightStyle+";",attrs:{id:"player"+e.index}}),a("div",{staticClass:"kbpsClass"},[e._v(e._s(e.kbps))]),a("flashOpen",{ref:"flashOpen"})],1):a("video",{ref:"rtc_media_player",staticStyle:{"pointer-events":"none"},style:"width:"+e.widthStyle+";height:"+e.heightStyle,attrs:{id:"rtc_media_player"+e.index,controls:"",autoplay:e.autoplay,controlslist:"nofullscreen nodownload noremoteplayback"}})])},r=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:"flash权限快捷入口",width:"800px",visible:e.visible,"show-footer":!1,appendBody:!0},on:{"update:visible":function(t){e.visible=t},closed:e.handleClosed,closeDialog:e.close,comfirmDialog:e.comfirmDialog}},[a("div",{staticClass:"dialog-box"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("p",[e._v("\n            请点击下面的图标，启用Flash\n        ")]),a("div",{staticClass:"hide",attrs:{id:"main_flash_hdr"}}),a("p",[e._v("\n            若没有见到这个图标或无法通过图标开启权限，请点击链接下载"),a("a",{staticStyle:{color:"#fff"},attrs:{href:"/video/flash_tutorial.pdf",download:"flash_tutorial.pdf"}},[e._v("flash操作指南")])])])],1)],1)])},o=[],s={components:{},data:function(){return{visible:!1}},props:{},methods:{open:function(e){var t=this;this.visible=!0,$("#main_flash_hdr").hide(),setTimeout((function(){t.playerWin()}),0)},handleClosed:function(){this.visible=!1},playerWin:function(){$("#main_flash_hdr").html('\n            <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="100%" height="100%"> \n                <param name="movie" value="srs_player/release/srs_player.swf"> \n                <param name="quality" value="autohigh"> \n                <param name="swliveconnect" value="true"> \n                <param name="allowScriptAccess" value="always"> \n                <param name="bgcolor" value="#0"> \n                <param name="allowFullScreen" value="true"> \n                <param name="wmode" value="opaque"> \n                <param name="FlashVars" value="log=1"> \n                <param name="flashvars" value="id=1&on_player_ready=__on_flash_ready"> \n                <embed src="srs_player/release/srs_player.swf" width="100%" height="100%" \n                    quality="autohigh" bgcolor="#0" align="middle" allowfullscreen="true" allowscriptaccess="always" \n                    type="application/x-shockwave-flash" swliveconnect="true" wmode="opaque" \n                    flashvars="id=1&on_player_ready=__on_flash_ready" \n                    pluginspage="http://www.macromedia.com/go/getflashplayer"> \n            </object> \n            '),$("#main_flash_hdr").show()},close:function(){this.handleClosed()},comfirmDialog:function(){}}},l=s,c=a("2877"),d=Object(c["a"])(l,n,o,!1,null,null,null),u=d.exports,h=a("7658"),p=a("2f62");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var m={name:"about",components:{flashOpen:u},props:{index:{type:[Number,String],default:null},widthStyle:{type:String,default:"900px"},heightStyle:{type:String,default:"320px"},autoplay:{default:!0}},data:function(){return{loading:!1,startPlay:null,url:"",pc:null,srs_player:null,query:null,autoLoadPage:null,player:null,kbps:""}},computed:f({},Object(p["c"])("d2admin",{activeSetting:"theme/activeSetting"})),methods:{playerInit:function(){var e=this;"RTMP"===this.activeSetting.name?this.$nextTick((function(){e.srs_player=null;var t=null,a=parse_query_string();if(t=e.url,!e.srs_player){$("#div_container"+e.index).remove();var i=$("<div/>");$(i).attr("id","div_container"+e.index),$("#player"+e.index).append(i);var r=$("<div/>");$(r).attr("id","player_id"+e.index),$(i).append(r);var n=$("#player"+e.index).width(),o=$("#player"+e.index).height();e.srs_player=new SrsPlayer("player_id"+e.index,n,o),e.srs_player.on_player_ready=function(){if(t.indexOf(".m3u8")>0&&2,a.buffer)for(var e=0;e<bts.length-1;e++){var i=bts[e],r=bts[e+1];if(Number(a.buffer)>=i&&Number(a.buffer)<r){i;break}}this.play(t)},e.srs_player.on_player_timer=function(t,a,i,r,n){e.kbps=i.toFixed(0)+"kbps"},e.srs_player.start()}})):this.$nextTick((function(){e.pc=null,e.startPlay=function(){$("#rtc_media_player"+e.index).show();var t=parse_rtmp_url(e.url),a=window.location.protocol;e.pc&&e.pc.close(),e.pc=new RTCPeerConnection(null),e.pc.onaddstream=function(t){$("#rtc_media_player"+e.index).prop("srcObject",t.stream)},new Promise((function(t,a){e.pc.addTransceiver("audio",{direction:"recvonly"}),e.pc.addTransceiver("video",{direction:"recvonly"}),e.pc.createOffer((function(e){t(e)}),(function(e){a(e)}))})).then((function(t){return e.pc.setLocalDescription(t).then((function(){return t}))})).then((function(e){return new Promise((function(i,r){var n=t.port||1985,o=t.user_query.play||"/rtc/v1/play/";o.lastIndexOf("/")!==o.length-1&&(o+="/");var s=a+"//"+t.server+":"+n+o;for(var l in t.user_query)"api"!==l&&"play"!==l&&(s+="&"+l+"="+t.user_query[l]);s=s.replace(o+"&",o+"?");var c={api:s,streamurl:t.url,clientip:null,sdp:e.sdp};$.ajax({type:"POST",url:s,data:JSON.stringify(c),contentType:"application/json",dataType:"json"}).done((function(e){if(e.code)r(e);else{var o=a+"//"+t.server+":"+n+"/rtc/v1/nack/";$("#sessionid").html(e.sessionid),$("#simulator-drop").attr("href",o+"?drop=1&username="+e.sessionid),i(e.sdp)}})).fail((function(e){r(e)}))}))})).then((function(t){return e.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}))})).catch((function(t){throw e.pc.close(),$("#rtc_media_player"+e.index).hide(),t}))},$("#rtc_media_player"+e.index).hide();var t=parse_query_string();"true"===t.autostart&&($("#rtc_media_player"+e.index).prop("muted",!0),e.startPlay())}))},playerInitWatch:function(e){var t=this;this.url=e;var a=this.url.split("/live/")[1];h["a"].queryChannel().then((function(i){var r=!1;if(i.data.map((function(e){e.id===a&&(r=!0)})),r)if("RTMP"===t.activeSetting.name){var n=t.hasUsableFlash();n||t.$refs.flashOpen.open(),t.url="rtmp://".concat(serverIp_app_live,":1935/live")+e.split("live")[1],t.playerInit()}else t.startPlay(),t.setIntervalFun();else{var o={id:a.split("@")[0],chid:a.split("@")[1]};h["a"].queryChannel(o).then((function(a){if("RTMP"===t.activeSetting.name){var i=t.hasUsableFlash();i||t.$refs.flashOpen.open(),t.url="rtmp://".concat(serverIp_app_live,":1935/live")+e.split("live")[1],t.playerInit()}else t.startPlay(),t.setIntervalFun()}))}}))},playerInitWatchCarousel:function(e){this.url=e,this.startPlay(),$("#rtc_media_player"+this.index).prop("muted",!0)},clearRtc:function(){"RTMP"===this.activeSetting.name?this.srs_player&&(this.kbps="",this.srs_player.stop(),this.srs_player=null):this.pc&&(this.pc.close(),$("#rtc_media_player"+this.index).hide())},setIntervalFun:function(){},hasUsableFlash:function(){var e;return e="undefined"!==typeof window.ActiveXObject?new ActiveXObject("ShockwaveFlash.ShockwaveFlash"):navigator.plugins["Shockwave Flash"],!!e},zhuapai:function(){var e,t,a=1;t=$("#output"),e=$("#rtc_media_player"+this.index).get(0);var i=function(){var i=document.createElement("canvas");i.width=e.videoWidth*a,i.height=e.videoHeight*a,i.getContext("2d").drawImage(e,0,0,i.width,i.height);var r=document.createElement("img");r.src=i.toDataURL(),t.prepend(r)};i()}},watch:{},mounted:function(){this.playerInit()},destroyed:function(){}},g=m,w=(a("1c79"),a("315e"),Object(c["a"])(g,i,r,!1,null,"57a62aec",null));t["a"]=w.exports},"90af":function(e,t,a){"use strict";a("9629")},9192:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24,md:4}},[a("dev-tree",{ref:"devTree",attrs:{pageType:e.pageType,pageId:e.pageId},on:{selectChange:e.selectChange}})],1),a("el-col",{attrs:{span:24,md:20}},[a("div",{staticClass:"topo-content",staticStyle:{"margin-right":"10px"}},[a("div",{staticClass:"blockDiv"},e._l(e.videoArray,(function(t,i){return a("div",{key:i,class:"block block"+e.selectValue},[a("div",{class:e.videoArray[i].arrows?"arrowsAltStyle":"arrowsStyle"},[a("player",{ref:"player"+i,refInFor:!0,staticClass:"dplayer",attrs:{widthStyle:"100%",index:i,heightStyle:"calc(100% - 10px)"}}),a("div",{staticClass:"mo",on:{click:function(t){return e.playerActiveChange(i)},dblclick:function(t){return e.arrowsTotal(i)}}},[a("div",{staticClass:"mo-name"},[e._v(e._s(t.pointName))])]),a("div",{class:"player-tool "+(e.activeVideokong===i?"playerActive":""),on:{click:function(t){return e.playerActiveChange(i)}}},[a("el-button",{attrs:{size:"mini",title:"全屏",icon:"fa fa-arrows"},on:{click:function(t){return e.arrowsAlt(i)}}}),a("el-button",{attrs:{size:"mini",title:"还原",icon:"fa fa-arrows-h"},on:{click:function(t){return e.arrows(i)}}}),a("el-button",{attrs:{size:"mini",title:"抓拍",icon:"fa fa-camera"},on:{click:function(a){return e.zhuapai(t)}}}),a("el-button",{attrs:{size:"mini",title:"录制",icon:"fa fa-film"}}),a("el-button",{staticStyle:{color:"#e43"},attrs:{size:"mini",title:"关闭",icon:"fa fa-square"},on:{click:function(t){return e.clearRtc(i)}}}),a("span",{staticClass:"d2-fr player-tool-text"},[e._v(e._s(t.name||""))])],1)],1)])})),0)])]),a("drawerTree",{ref:"drawerTree"})],1)},r=[],n=a("2f62"),o=a("868c"),s=a("9fab"),l=a("1fc7"),c=a("7658"),d=a("3709");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v={props:{pageType:{type:String,default:null},pageId:{type:String,default:null}},components:{DevTree:s["default"],player:o["a"],drawerTree:l["default"]},data:function(){return{videoArray:[],selectValue:1,activeVideo:0,activeVideokong:0,selectState:!1}},computed:h(h({},Object(n["c"])("d2admin",{devTreeNode:"tree/devTreeNode",activeSetting:"theme/activeSetting"})),{},{rawId:function(){var e=this.devTreeNode.id;return e},spaceName:function(){var e=this.devTreeNode.name;return e}}),watch:{rawId:function(e,t){var a=this;if(e)if("二次设备点位"===this.devTreeNode.camaraType){var i=null;this.videoArray.map((function(e,t){e.id===a.devTreeNode.camaraData.id&&(i=t)})),null===i?(this.activeChange(),this.goPreset(this.devTreeNode.camaraData.id,this.devTreeNode.token),this.getBasicInfo(this.devTreeNode.camaraData,this.devTreeNode)):(this.goPreset(this.devTreeNode.camaraData.id,this.devTreeNode.token),this.playerActiveChange(i),this.$set(this.videoArray[i],"pointName",this.devTreeNode.name))}else this.getBasicInfoOnw(this.devTreeNode.rawId,this.devTreeNode.ponitName,this.devTreeNode.rawVarName)}},mounted:function(){this.selectChange(1)},methods:{selectChange:function(e){this.selectValue=e;for(var t=0;t<this.selectValue;t++)this.videoArray[t]||this.videoArray.push({});this.videoArray.splice(e),this.selectState=!1},getBasicInfo:function(e,t){this.videoArray[this.activeVideo-1].devNum=e.devNum,this.videoArray[this.activeVideo-1].channelNum=e.channelNum,this.videoArray[this.activeVideo-1].id=e.id,this.$set(this.videoArray[this.activeVideo-1],"pointName",t.name),this.videoArray[this.activeVideo-1].nodeId=e.id,this.$set(this.videoArray[this.activeVideo-1],"name",e.name),this.videoArray[this.activeVideo-1].live=e.live,this.videoArray[this.activeVideo-1].addrSrc=e.addrSrc,this.videoPlayer()},getBasicInfoOnw:function(e,t,a){var i=this;d["a"].basicInfo({rawId:e,type:1}).then((function(r){i.basicInfo=r.data;var n={};i.basicInfo.map((function(e){"devNum"===e.url?n.devNum=e.name:"channelNum"===e.url?n.channelNum=e.name:"id"===e.url?(n.id=e.name,n.nodeId=e.name):"name"===e.url&&(n.name=e.name)})),n.live=n.channelNum+"@"+n.devNum;var o=null;i.videoArray.map((function(e,t){e.id===n.id&&(o=t)})),null===o?(i.activeChange(),i.videoArray[i.activeVideo-1]=h({},n),i.videoArray[i.activeVideo-1].rawId=e,i.videoArray[i.activeVideo-1].addrSrc="webrtc://".concat(serverIp_app_live,"/live/").concat(i.videoArray[i.activeVideo-1].devNum,"@").concat(i.videoArray[i.activeVideo-1].channelNum),i.goPreset(i.videoArray[i.activeVideo-1].id,t),i.videoPlayer(),i.$set(i.videoArray[i.activeVideo-1],"pointName",a),i.playerActiveChange([i.activeVideo-1])):(i.goPreset(n.id,t),i.playerActiveChange(o),i.$set(i.videoArray[o],"pointName",a))})).finally((function(){}))},videoPlayer:function(){var e=this;setTimeout((function(){e.$refs["player"+(e.activeVideo-1)][0].playerInitWatch(e.videoArray[e.activeVideo-1].addrSrc)}),0)},goPreset:function(e,t){var a={cameraId:e,point:t};c["a"].movePresetByAli(a).then((function(e){}))},openDrawer:function(e,t){if(!e)return!1;this.$refs.drawerTree.open(e,t)},activeChange:function(){this.selectState||(this.activeVideo=0,this.selectState=!0),this.activeVideo>this.selectValue-1?this.activeVideo=1:this.activeVideo++,this.playerActiveChange(0===this.activeVideo?0:this.activeVideo-1)},arrowsAlt:function(e){this.$set(this.videoArray[e],"arrows",!0)},arrows:function(e){this.$set(this.videoArray[e],"arrows",!1)},arrowsTotal:function(e){this.$set(this.videoArray[e],"arrows",!this.videoArray[e].arrows)},zhuapai:function(e){c["a"].snapShotAndExcuteBase({id:e.id}).then((function(t){var a="data:image/png;base64,"+t.data;if(window.navigator.msSaveOrOpenBlob){var i=atob(a.split(",")[1]),r=i.length,n=new Uint8Array(r);while(r--)n[r]=i.charCodeAt(r);var o=new Blob([n]);window.navigator.msSaveOrOpenBlob(o,(e.pointName||"chart-download")+".png")}else{var s=document.createElement("a");s.href=a,s.setAttribute("download",e.pointName||"chart-download"),s.click()}}))},clearRtc:function(e){this.$refs["player"+e][0].clearRtc(),this.$set(this.videoArray,e,{})},playerActiveChange:function(e){this.activeVideokong=e,this.$refs.devTree.active_itemChange(this.videoArray[e])},clearAll:function(){var e=this;this.videoArray.map((function(t,a){t.id&&e.$refs["player"+a][0].clearRtc(),e.$set(e.videoArray,a,{})}))}},beforeDestroy:function(){this.clearAll()}},f=v,y=(a("796f"),a("67ee"),a("2877")),m=Object(y["a"])(f,i,r,!1,null,"38beaca5",null);t["default"]=m.exports},9629:function(e,t,a){},a37b:function(e,t,a){},c92c:function(e,t,a){},f0f9:function(e,t,a){},ff66:function(e,t,a){}}]);