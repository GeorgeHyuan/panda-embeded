(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a6b8d1a","chunk-97409b40","chunk-3897b5d6","chunk-2d0be070"],{"0579":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:"add"===e.dialogTitle?"新增授权":"编辑授权",width:"500px",showFooter:!0,visible:e.visible},on:{"update:visible":function(t){e.visible=t},closeDialog:e.closeDialog,closed:e.handleClosed,comfirmDialog:e.comfirmDialog}},[e.template?a("d2-form",{ref:"keyForm",staticClass:"eventReport__header__form",attrs:{formOptions:e.formOptions,template:e.template,rules:e.rules},on:{"form-data-change":e.formChange}}):e._e()],1)},n=[],o=a("6c51"),r=a("2ef0"),c=a("8d33"),s={data:function(){return{dialogTitle:"add",visible:!1,uuid:null,formOptions:{labelWidth:"100px",inline:!0},template:{authName:{title:"授权名称",component:{name:"el-input",clearable:!0}},authUser:{title:"执行人员",component:{name:"el-select",options:[],clearable:!0}},choiceKey:{title:"选择钥匙",component:{name:"el-select",options:[],clearable:!0}},choiceLock:{title:"选择锁具",component:{name:"el-select",options:[],clearable:!0}},startTime:{title:"开始时间",component:{name:"el-date-picker",type:"datetime",placeholder:"开始时间",clearable:!0}},endTime:{title:"结束时间",component:{name:"el-date-picker",type:"datetime",placeholder:"结束时间",clearable:!0}}},rules:{authName:[{required:!0,message:"授权名称不能为空",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],authUser:[{required:!0,message:"执行人员不能为空",trigger:"change"}],choiceKey:[{required:!0,message:"钥匙不能为空",trigger:"change"}],choiceLock:[{required:!0,message:"锁具不能为空弄",trigger:"change"}],startTime:[{required:!0,message:"开始时间不能为空",trigger:"change"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"change"}]},editData:[]}},methods:{getAdministratorList:function(){var e=this;this.template.authUser.component.options=[];var t={page:1,pageSize:1e7,userName:"",owneUuid:""};c["a"].administratorList(t).then((function(t){var a=t.rows;a.forEach((function(t){e.template.authUser.component.options.push({label:t.name,value:t.uuid})}))}))},getAllKeyList:function(e){var t=this,a={keyOwner:e};c["a"].getAllKey(a).then((function(e){if(e&&e.data){var a=e.data;console.log(a,"钥匙信息"),t.template.choiceKey.component.options=[],a.forEach((function(e){t.template.choiceKey.component.options.push({label:e.keyName,value:e.uuid})}))}})).catch((function(e){console.log(e)}))},getAllLockList:function(){var e=this;c["a"].getAllLock().then((function(t){if(console.log(t,"锁具信息"),t&&t.data){var a=t.data;e.template.choiceLock.component.options=[],a.forEach((function(t){e.template.choiceLock.component.options.push({label:t.lockName,value:t.uuid})}))}})).catch((function(e){console.log(e)}))},open:function(e,t){var a=this;this.visible=!0,this.dialogTitle=e,"edit"===e&&this.$nextTick((function(){if(console.log(t[0],"当前条数据>>>"),t[0]){a.uuid=t[0]["uuid"];var e={};Object(r["forEach"])(a.template,(function(a,i){e[i]=t[0][i]})),a.$refs.keyForm.setFormData(e)}})),this.getAdministratorList(),this.getAllLockList()},closeDialog:function(){this.visible=!1},handleClosed:function(){this.visible=!1,this.$refs.keyForm.resetFields()},comfirmDialog:function(){var e=this;this.$refs["keyForm"].validate((function(t){if(!t)return console.log("error submit!!"),!1;"add"===e.dialogTitle?e.handleAdd():"edit"===e.dialogTitle&&e.handleEdit()}))},handleAdd:function(){var e=this;console.log(this.$refs.keyForm.formData,"新增的数据");var t=this.$refs.keyForm.formData,a={authName:t.authName,authUser:t.authUser,authKey:t.choiceKey,authLock:t.choiceLock,startTime:Object(o["g"])(t.startTime),endTime:Object(o["g"])(t.endTime)};c["a"].addAuth(a).then((function(t){e.$message({type:"success",message:"新增成功"}),e.handleClosed(),e.$emit("handleList")})).catch((function(e){console.log(e)}))},handleEdit:function(){var e=this,t=this.$refs.keyForm.formData,a={uuid:this.uuid,authName:t.authName,authUser:t.authUser,authKey:t.choiceKey,authLock:t.choiceLock,startTime:Object(o["g"])(t.startTime),endTime:Object(o["g"])(t.endTime)};c["a"].editAuth(a).then((function(t){e.$message({type:"success",message:"编辑成功"}),e.handleClosed(),e.$emit("handleList")})).catch((function(e){console.log(e)}))},handleSearch:function(){var e=this.$refs.form.formData;this.$emit("handleCheck",e)},formChange:function(e){"authUser"===e.key&&(this.$refs.keyForm.setFormData({choiceKey:null}),this.template.choiceKey.component.options=[],this.getAllKeyList(e.value))}},created:function(){}},l=s,u=(a("07c7"),a("2877")),h=Object(u["a"])(l,i,n,!1,null,null,null);t["default"]=h.exports},"07c7":function(e,t,a){"use strict";a("3728")},"2f06":function(e,t,a){"use strict";a.r(t),t["default"]={data:function(){return{columns:[{title:"序号",width:50,key:"serialNumber",showOverflowTooltip:!0},{title:"授权名称",key:"authName",showOverflowTooltip:!0},{title:"执行人员",key:"userName",showOverflowTooltip:!0},{title:"授权钥匙",key:"keyName",showOverflowTooltip:!0},{title:"锁具名称",key:"lockName",showOverflowTooltip:!0},{title:"开始时间",key:"startTime",showOverflowTooltip:!0},{title:"结束时间",key:"endTime",showOverflowTooltip:!0}],loading:!1,pagination:{currentPage:1,pageSize:20,total:0},options:{stripe:!0,height:"calc(100vh - 274px)",border:!0},data:[]}},methods:{},mounted:function(){},created:function(){}}},3728:function(e,t,a){},5676:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d2-clearfix"},[a("d2-form",{ref:"form",staticClass:"eventReport__header__form",attrs:{formOptions:e.formOptions,template:e.template},on:{"form-data-change":e.formChange}})],1)},n=[],o={name:"search-group",components:{},data:function(){this.$createElement;var e=this;return{formOptions:{labelWidth:"100px",inline:!0},template:{authName:{title:"授权名称",component:{name:"el-input",clearable:!0}},authUser:{title:"执行人员",component:{name:"el-input",clearable:!0}},lockName:{title:"锁具名称",component:{name:"el-input",clearable:!0}},searchBtn:{component:{render:function(t){return t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},["查询"])}}}}}},computed:{},created:function(){},methods:{handleSearch:function(){var e=this.$refs.form.formData;this.$emit("handleCheck",e)},formChange:function(e){}}},r=o,c=(a("d151"),a("2877")),s=Object(c["a"])(r,i,n,!1,null,"af17ee4a",null);t["default"]=s.exports},"8d33":function(e,t,a){"use strict";var i=a("9bd2"),n=VUE_APP_API_STATION;t["a"]={administratorList:function(e){var t=e.page,a=e.pageSize,o=void 0===a?1e7:a,r=e.userName,c=e.owneUuid;return Object(i["a"])({url:"".concat(n,"/user/getUserList"),method:"post",data:{page:t,pageSize:o,userName:r,owneUuid:c}})},getAllKey:function(e){var t=e.keyOwner;return Object(i["a"])({url:"".concat(n,"/intelligentLocks/key/getAll"),method:"post",data:{keyOwner:t}})},getAllLock:function(){return Object(i["a"])({url:"".concat(n,"/intelligentLocks/lock/getAll"),method:"post"})},addAuth:function(e){var t=e.authName,a=e.authUser,o=e.authKey,r=e.authLock,c=e.startTime,s=e.endTime;return Object(i["a"])({url:"".concat(n,"/intelligentLocks/auth/add"),method:"post",data:{authName:t,authUser:a,authKey:o,authLock:r,startTime:c,endTime:s}})},editAuth:function(e){var t=e.uuid,a=e.authName,o=e.authUser,r=e.authKey,c=e.authLock,s=e.startTime,l=e.endTime;return Object(i["a"])({url:"".concat(n,"/intelligentLocks/auth/update"),method:"post",data:{uuid:t,authName:a,authUser:o,authKey:r,authLock:c,startTime:s,endTime:l}})},deleteAllAuth:function(e){var t=e.uuidList;return Object(i["a"])({url:"".concat(n,"/intelligentLocks/auth/deleteAll"),method:"post",data:{uuidList:t}})},selectAuthInfo:function(e){var t=e.authName,a=e.userName,o=e.lockName,r=e.nowPage,c=e.pageSize;return Object(i["a"])({url:"".concat(n,"/intelligentLocks/auth/find"),method:"post",data:{authName:t,userName:a,lockName:o,nowPage:r,pageSize:c}})}}},b4bf:function(e,t,a){},cdef:function(e,t,a){"use strict";a("f66e")},d151:function(e,t,a){"use strict";a("b4bf")},d8e1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"keys-manage"},[a("d2-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("钥匙列表")]),a("div",{staticClass:"button_box",staticStyle:{"text-align":"right","margin-right":"5px",width:"50%"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("\n          新增\n        ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleEdit}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger"},on:{click:e.handleDel}},[e._v("删除")])],1)]),a("search-group",{on:{handleCheck:e.searchValue}}),a("d2-crud",{staticClass:"equipmentReport-crud",attrs:{columns:e.columns,data:e.data,loading:e.loading,pagination:e.pagination,options:e.options,"selection-row":""},on:{"row-click":function(t){return t.target!==t.currentTarget?null:e.clickRow(t)},"pagination-current-change":e.paginationCurrentChange,"selection-change":e.handleSelectionChange}})],1),a("dialog-form",{ref:"dialogForm",on:{handleList:e.initTableData}})],1)},n=[],o=a("5676"),r=a("2f06"),c=a("0579"),s=a("8d33"),l={mixins:[r["default"]],components:{SearchGroup:o["default"],DialogForm:c["default"]},data:function(){return{selectCheckBox:[],parameter:{}}},methods:{initTableData:function(){var e=this,t={authName:this.parameter.authName,userName:this.parameter.authUser,lockName:this.parameter.lockName,nowPage:this.pagination.currentPage,pageSize:this.pagination.pageSize};s["a"].selectAuthInfo(t).then((function(t){if(e.data=[],t&&t.data){var a=t.data;console.log(a,"获取到的数据"),a.forEach((function(t,a){var i=10*(e.pagination.currentPage-1);e.data.push({serialNumber:a+1+i,uuid:t.uuid,authName:t.authName,authUser:t.authUser,choiceKey:t.authKey,choiceLock:t.authLock,startTime:t.startTime,endTime:t.endTime,userName:t.userName,lockName:t.lockName,keyName:t.keyName})})),e.pagination.total=t.total}}))},searchValue:function(e){this.parameter=e,this.clearPagenation(),this.initTableData()},clickRow:function(){},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.initTableData()},clearPagenation:function(){this.pagination={currentPage:1,pageSize:20,total:0}},handleSelectionChange:function(e){this.selectCheckBox=e},handleAdd:function(){this.$refs.dialogForm.open("add")},handleEdit:function(){this.selectCheckBox.length?this.selectCheckBox.length>1?this.$message({message:"只能操作一条数据",type:"warning"}):this.$refs.dialogForm.open("edit",this.selectCheckBox):this.$message({message:"还没有选择设备，请勾选一条数据再进行操作",type:"warning"})},handleDel:function(){var e=this;if(this.selectCheckBox.length){var t=[];this.selectCheckBox.forEach((function(e){t.push(e.uuid)})),s["a"].deleteAllAuth({uuidList:t}).then((function(t){e.$message({type:"success",message:"删除成功"}),e.initTableData()}))}else this.$message({message:"还没有选择设备，请勾选一条数据再进行操作",type:"warning"})}},created:function(){this.initTableData()}},u=l,h=(a("cdef"),a("2877")),m=Object(h["a"])(u,i,n,!1,null,"6bbf350a",null);t["default"]=m.exports},f66e:function(e,t,a){}}]);