(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-459ec323"],{"1de3":function(e,t,a){},9951:function(e,t,a){"use strict";t["a"]={data:function(){return{implementOptions:[{value:1,label:"立即"},{value:2,label:"定时"},{value:3,label:"周期"}],taskStateOptions:[{value:6,label:"手动停止"},{value:5,label:"等待执行"},{value:4,label:"正在执行"},{value:3,label:"任务暂停"},{value:2,label:"异常终止"},{value:1,label:"已完成"}],taskTypeOptions:[{value:"1",label:"例行巡视"},{value:"2",label:"特殊巡视"},{value:"3",label:"专项巡视"},{value:"4",label:"自定义巡视"}],timeOptions:[{value:"1",label:"每天"},{value:"2",label:"每周"},{value:"3",label:"每月"}],monthOptions:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"},{value:"8",label:"8"},{value:"9",label:"9"},{value:"10",label:"10"},{value:"11",label:"11"},{value:"12",label:"12"},{value:"13",label:"13"},{value:"14",label:"14"},{value:"15",label:"15"},{value:"16",label:"16"},{value:"17",label:"17"},{value:"18",label:"18"},{value:"19",label:"19"},{value:"20",label:"20"},{value:"21",label:"21"},{value:"22",label:"22"},{value:"23",label:"23"},{value:"24",label:"24"},{value:"25",label:"25"},{value:"26",label:"26"},{value:"27",label:"27"},{value:"28",label:"28"},{value:"29",label:"29"},{value:"30",label:"30"},{value:"31",label:"31"}],weekOptions:[{value:"1",label:"周一"},{value:"2",label:"周二"},{value:"3",label:"周三"},{value:"4",label:"周四"},{value:"5",label:"周五"},{value:"6",label:"周六"},{value:"7",label:"周日"}],warningOptions:[{value:1,label:"是"},{value:0,label:"否"}],addrFormat:{"power-infra-gloves-detection":"未带手套","helmet-classify":"未带安全帽"}}}}},b236:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("dialog-container",{attrs:{title:e.title,width:"1200px",height:"400px",visible:e.visible,submitLoading:e.submitLoading,confirmText:"巡检成票","show-footer":"details"!==e.pageType},on:{"update:visible":function(t){e.visible=t},closed:e.handleClosed,closeDialog:e.close,comfirmDialog:e.comfirmDialog}},[a("div",{staticClass:"dialog-box"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-form",{ref:"ruleForm",staticClass:"d2-form d2-form-check",attrs:{"label-position":"right",model:e.formInline,rules:e.rules,disabled:"details"===e.pageType,"label-width":"90px"}},[a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-input",{model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1)],1),a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.formInline.type,callback:function(t){e.$set(e.formInline,"type",t)},expression:"formInline.type"}},e._l(e.taskTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{staticClass:"rules",attrs:{span:24}},[a("el-form-item",{attrs:{label:"预计时间",prop:"desc"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formInline.desc,callback:function(t){e.$set(e.formInline,"desc",t)},expression:"formInline.desc"}},[a("template",{slot:"append"},[e._v("分钟")])],2)],1)],1)],1)],1),"details"!==this.pageType?a("el-col",{attrs:{span:7,offset:1}},[a("d2-card",{staticClass:"box-card",attrs:{showRightRefreshBtn:!1,showRightMaxBtn:!1}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("请选择任务点位")])]),e.visible?a("el-tree",e._b({ref:"treeDevice",staticClass:"d2-tree-main",staticStyle:{height:"486px","overflow-y":"auto","overflow-x":"hidden"},attrs:{"node-key":"id",load:e.loadNode,data:e.primaryData,lazy:"",props:e.defaultProps,"expand-on-click-node":!1,"render-content":e.renderContent,"highlight-current":""},on:{"node-click":e.handleNodeClickDevice}},"el-tree",e.$attrs,!1)):e._e()],1)],1):e._e(),a("el-col",{attrs:{span:"details"!==this.pageType?8:15,offset:"details"!==this.pageType?0:1}},[a("d2-card",{staticClass:"box-card",attrs:{showRightRefreshBtn:!1,showRightMaxBtn:!1}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("已选任务点位列表")])]),e.visible?a("el-tree",{ref:"treeltxj",staticClass:"d2-tree-main",staticStyle:{height:"486px","overflow-y":"auto","overflow-x":"hidden"},attrs:{"node-key":"id",data:e.ltxjData,props:e.defaultPropsDv,"render-content":e.renderContentLtxj,"highlight-current":""}}):e._e()],1)],1)],1)],1)])},n=[],l=a("e1e5"),s=a("9951"),r=a("f0b0"),o=a("2f62");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var p={components:{},mixins:[s["a"]],data:function(){return{visible:!1,submitLoading:!1,formInline:{execType:"",name:"",type:null,taskId:""},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{validator:r["a"],trigger:"blur"},{max:64,message:"最大长度64 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"blur"}],execType:[{required:!0,message:"请选择执行方式",trigger:"blur"}]},rulesTime:{timeType:[{required:!0,message:"请选择时间类型",trigger:"blur"}],time:[{required:!0,message:"请选择时间",trigger:"blur"}],htime:[{required:!0,message:"请选择时分",trigger:"blur"}]},loading:!1,treeData:[],timesData:{timeType:"1",time:"",htime:"01:00"},primaryData:[{name:"primary"}],defaultProps:{children:"children",label:"name",id:"id",isLeaf:"leaf"},defaultPropsDv:{label:"varName",id:"varId"},ltxjData:[],treeClickCount:0,pageType:"",title:"新增巡检任务",stepTimeNum:0,isSelectList:[]}},computed:u(u({},Object(o["c"])("d2admin",{treeNode:"tree/treeNode"})),{},{deviceId:function(){var e=this.treeNode.id;return e}}),watch:{stepTimeNum:function(e){this.$set(this.formInline,"desc",e)}},mounted:function(){},methods:{open:function(e,t){var a=this;if(this.isSelectList=[],this.pageType=e,"edit"===e||"details"===e){this.title="edit"===e?"编辑巡检任务":"巡检任务详情";var i={id:t.id};l["a"].getInspectTaskById(i).then((function(e){a.timesData=JSON.parse(e.data.execTime),a.ltxjData=e.data.inspectPointArray,a.stepTimeFun(),a.$set(a.formInline,"name",e.data.name),a.$set(a.formInline,"type",e.data.type),a.$set(a.formInline,"execType",e.data.execType),a.$set(a.formInline,"taskId",e.data.id)})).finally((function(){}))}else this.title="新增巡检任务";this.init()},close:function(){this.visible=!1},handleClosed:function(){var e=this;this.$nextTick((function(){e.$refs.ruleForm.resetFields(),e.ltxjData=[]}))},init:function(){this.visible=!0},addTime:function(){this.timesData.push({timeType:"1",time:"",htime:"01:00"})},removeTime:function(e){this.$delete(this.timesData,e)},implementChange:function(e){this.timesData=2===e?{timeType:"1",time:"",htime:"01:00"}:{}},renderContent:function(e,t){var a=t.node,i=t.data,n=(t.store,"");return i.isSelect&&(n="el-icon-check"),e("span",{class:"custom-tree-node",attrs:{id:"node"+i.id}},[e("span",[e("i",{class:n,style:"color: #4EC752;float: left;margin-right: 5px;font-size: 16px;font-weight: 700;"}),e("i",{class:i.icon?"treeIcon "+i.icon:""}),a.label])])},renderContentLtxj:function(e,t){var a=this,i=t.node,n=t.data;t.store;return"details"===this.pageType?e("span",{class:"custom-tree-node"},[e("span",[n.spaceName+n.varName])]):e("span",{class:"custom-tree-node"},[e("span",[n.spaceName+n.varName]),e("span",[e("el-button",{attrs:{size:"mini",type:"text"},class:"custom-tree-node-remove-btn",style:"position: absolute;right:52px;",on:{click:function(){return a.remove(i,n)}}},["删除"])])])},remove:function(e,t){var a=this,i=e.parent,n=i.data.children||i.data,l=n.findIndex((function(e){return e.varId===t.varId}));n.splice(l,1),this.isSelectList.map((function(e){e.id===t.spaceId&&a.loadNode(e.node,e.resolve)})),this.stepTimeFun()},handleNodeClickDevice:function(e,t,a){var i=this;this.NodeObjDevice=e,t.data.icon?this.rawDetails="":(this.treeClickCount+=1,setTimeout((function(){2===i.treeClickCount&&(i.treeClickCount=0,i.relation(t)),i.treeClickCount=0}),300))},relation:function(e){var t=this,a=!1;if(this.ltxjData.map((function(i){i.varId===e.data.id&&(a=!0,t.$message.success("请不要添加相同的点位"))})),a)return!1;this.ltxjData.push({spaceName:e.parent.data.name,spaceId:e.parent.data.id,varName:e.data.name,varId:e.data.id,rawVarId:e.data.rawId,stepTime:e.data.stepTime,cameraType:e.data.nodeType}),this.$set(this.NodeObjDevice,"isSelect",!0),this.stepTimeFun()},stepTimeFun:function(){var e=0;this.ltxjData.map((function(t){e=Number(t.stepTime/60)+5/60+e})),this.stepTimeNum=e.toFixed(2)},loadNode:function(e,t){var a=this;0===e.level?l["a"].nodeGetById(this.deviceId).then((function(e){var i=a.hasChild([e.data]);return t(i)})):this.$nextTick((function(){l["a"].getCameraPoint({id:e.data.id}).then((function(i){var n=i.data.spaceDgtVos||[],l=i.data.spaceAnalogVos||[],s=i.data.spaceVoList||[],r=n.concat(l).concat(s),o=a.hasChild(r);return a.ltxjData.map((function(e){o.map((function(t){return e.varId===t.id&&(t.isSelect=!0),t}))})),e.childNodes=null,e.data.children=null,a.isSelectList.push({node:e,resolve:t,id:e.data.id}),t(o)})).finally((function(){a.loading=!1}))}))},hasChild:function(e){return e&&0!==e.length?(e.forEach((function(t,a){e[a].leaf=!e[a].hasChild})),e):[]},comfirmDialog:function(){var e=this;if(0===this.ltxjData.length)return this.$message.error("请选择点位"),!1;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.apiFun()}))},apiFun:function(){var e=this;this.submitLoading=!0;var t=JSON.parse(JSON.stringify(this.formInline));t.inspectPointArray=this.ltxjData,t.inspectPointTotal=this.ltxjData.length,t.stationId=this.deviceId,"edit"===this.pageType?(t.id=this.formInline.taskId,l["a"].updateInspectTask(t).then((function(t){var a=t.code;"0"===a&&(e.visible=!1,e.$emit("getappList"),e.$message.success("编辑成功"))})).catch((function(e){console.log(e)})).finally((function(){e.submitLoading=!1}))):l["a"].saveInspectTask(t).then((function(t){var a=t.code;"0"===a&&(e.visible=!1,e.$emit("getappList"),e.$message.success("创建成功"))})).catch((function(e){console.log(e)})).finally((function(){e.submitLoading=!1}))}}},m=p,f=(a("b52f"),a("2877")),h=Object(f["a"])(m,i,n,!1,null,"efe92c80",null);t["default"]=h.exports},b52f:function(e,t,a){"use strict";a("1de3")},e1e5:function(e,t,a){"use strict";var i=a("9bd2"),n=VUE_APP_API,l=VUE_APP_API_STATION;t["a"]={nodeGetById:function(e){return Object(i["a"])({url:"".concat(n,"/device/space/getById/").concat(e),method:"get"})},deleteInspectTaskById:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/deleteInspectTaskById/").concat(e),method:"delete"})},saveInspectTask:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/saveInspectTask"),method:"post",data:e})},updateInspectTask:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/updateInspectTask"),method:"put",data:e})},getPageInspectTask:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/getPageInspectTask"),method:"post",data:e})},getInspectTaskById:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/getInspectTaskById"),method:"post",data:e})},startTask:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/record/startTask"),method:"post",data:e})},getCameraPoint:function(e){return Object(i["a"])({url:"".concat(n,"/device/space/getInspectionPointById"),method:"post",params:e})},getCameraPointType:function(e){return Object(i["a"])({url:"".concat(n,"/device/space/getInspectionPointById?id=").concat(e.id,"&nodeTypeList=").concat(e.nodeTypeList[0],"&nodeTypeList=").concat(e.nodeTypeList[1]),method:"post"})},getCalendar:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/getCalendar"),method:"post",data:e})},getYear:function(e){return Object(i["a"])({url:"".concat(l,"/inspection/task/getYear"),method:"post",data:e})}}},f0b0:function(e,t,a){"use strict";function i(e,t,a){var i=/^[^\s]*$/;if(!i.test(t))return a(new Error("不能有空格"));a()}a.d(t,"a",(function(){return i}))}}]);