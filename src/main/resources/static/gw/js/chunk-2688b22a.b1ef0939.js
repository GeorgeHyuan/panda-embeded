(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2688b22a"],{"2f14":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("d2-container",{staticClass:"intelligent-locks-statistics"},[i("template",{slot:"header"},[i("el-breadcrumb",[i("el-breadcrumb-item",[t._v("当前位置")]),i("el-breadcrumb-item",{attrs:{to:{path:"/refresh"}}},[t._v("系统工况")])],1)],1),i("div",{staticClass:"topo-content"},[i("d2-card",{staticClass:"data-statistics",attrs:{cardHeaderShow:!1,xiaojiaoShow:!1}},[i("topo",{ref:"topo",staticClass:"topo"})],1)],1)],2)},a=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"top-basic-info"},[i("div",{staticClass:"info"},t._l(t.basicInfo,(function(e,n){return i("span",{key:n,staticClass:"info-col"},[i("div",[t._v(t._s(e.name))]),i("div",{staticClass:"info-value"},[t._v(t._s(e.value))])])})),0),i("div",{staticClass:"right-btn-group"},[i("div",{staticClass:"legend"},t._l(t.legend,(function(e,n){return i("div",{key:n},[i("span",{staticClass:"line",style:{border:e.color}}),i("span",{staticClass:"name"},[t._v(t._s(e.name))])])})),0),i("div",{staticClass:"refresh-btn"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",loading:t.refreshLoading},on:{click:t.refresh}},[t._v("更新")])],1)])]),i("div",{staticStyle:{height:"100%",overflow:"auto"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",overflow:"hidden"},style:{height:"calc("+t.height+"vh - 188px)"},attrs:{"element-loading-text":"拼命加载中","element-loading-background":"#080D21","element-loading-spinner":"el-icon-loading"}},[t.show?i("div",{attrs:{id:"echarts"}}):i("div",{staticClass:"no-topodata"},[t._v("此 节 点 暂 无 数 据")])])])])},s=[],r=i("2f62"),c=i("9bd2"),l=VUE_APP_API,d=VUE_APP_API_STATION,h={sysSpaceCondition:function(t){return Object(c["a"])({url:"".concat(d,"/homePage/sysSpaceCondition"),method:"post",params:t})},pingExecuteComTask:function(){return Object(c["a"])({url:"".concat(d,"/camera/pingExecuteComTask"),method:"get"})},sysConditionLine:function(t){return Object(c["a"])({url:"".concat(d,"/evt/sysConditionLine"),method:"post",data:t})},getTopoData:function(t){return Object(c["a"])({url:"".concat(l,"/tq/topo/getLastTopo"),method:"post",data:t})},scopeValue:function(t){return Object(c["a"])({url:"".concat(d,"/station/dict/queryByValue"),method:"post",params:t})},requestHistory:function(t){return Object(c["a"])({url:"".concat(l,"/tq/topo/getTopoCurve"),method:"post",data:t})},getTfdCurve:function(t){return Object(c["a"])({url:"".concat(l,"/tq/topo/getTfdCurve"),method:"post",data:t})},getTopoName:function(t){var e=t.spaceIdList,i=t.topoId;return Object(c["a"])({url:"".concat(l,"/tq/topo/getTopoName/").concat(i),method:"post",data:e})},getHistoryTopo:function(t){return Object(c["a"])({url:"".concat(l,"/tq/topo/getHistoryTopoNoPage"),method:"post",data:t})}},u=i("313e"),f=i.n(u);function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function m(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){g(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var b={name:"topo",props:{isCancel:{type:Boolean,default:null}},data:function(){var t=this;return{loading:!1,refreshLoading:!1,show:!0,total:0,height:100,basicInfo:{online:{name:"在线设备",value:0},offline:{name:"离线设备",value:0},cameraList:{name:"摄像头数",value:0},sensor:{name:"传感器数",value:0}},originalData:{},option:{},resData:[],legend:[{color:"1px solid #4EC752",name:"在线",key:"online",show:!0},{color:"1px dashed red",name:"离线",key:"offline",show:!0}],machine:[{value:"0",label:"海康"},{value:"1",label:"大华"},{value:"2",label:"宇视"}],timer:setInterval((function(){t.tableInit()}),6e5),clickSymbolList:[],clickChildrenLength:0,myChart:null}},computed:m(m({},Object(r["c"])("d2admin",{treeNode:"tree/treeNode"})),{},{deviceId:function(){var t=this.treeNode.id;return t}}),watch:{deviceId:function(){this.deviceId&&this.tableInit()},height:function(t){console.log(t,"height")}},mounted:function(){this.tableInit()},methods:{tableInit:function(){var t=this;if(this.deviceId){this.loading=!0;var e={spaceId:this.deviceId};for(var n in this.basicInfo)if(this.basicInfo.hasOwnProperty(n)){var a=this.basicInfo[n];a.value=0}this.originalData={},h.sysSpaceCondition(e).then((function(e){if(e.data){var n=e.data;t.originalData=m(m(m({},t.originalData),n),{},{symbol:"image://"+i("9800"),children:t.diguiSetItemStyle(n.sysSpaceConditions,1),lineStyle:{color:"#4EC752",curveness:1,type:"solid"}}),t.$nextTick((function(){t.echartsMit()}))}else t.show=!1})).catch((function(){t.show=!1})).finally((function(){t.loading=!1}))}},echartsMit:function(){var t=this,e=document.getElementById("echarts");this.myChart=f.a.init(e),this.myChart.clear(),this.option={tooltip:{trigger:"item",triggerOn:"mousemove",axisPointer:{type:"cross"},formatter:function(e){var i=e.data.rawBasicVoList,n=[];return i.map((function(e){"name"!==e.url&&"addr"!==e.url&&"desc"!==e.url&&"remark"!==e.url&&"model"!==e.url&&"manufacture"!==e.url&&"commissionDate"!==e.url&&"position"!==e.url&&"machine"!==e.url&&"nvrBy"!==e.url&&"devNum"!==e.url&&"channelNum"!==e.url&&"ipAddr"!==e.url&&"ipcChannel"!==e.url||("machine"===e.url&&t.machine.map((function(t){if(e.name===t.value)return e.name=t.label,e})),n.push('<span style="min-width: 200px;display:inline-block;"><span style="display: inline-block;width: auto;">'.concat(e.tag,":</span> &nbsp;<span>").concat(e.name?e.name:"","</span> </span><br>")))})),n.join("\n")},backgroundColor:"#101F40",borderWidth:1,borderColor:"#fff",borderRadius:5,padding:[10,20,10,10],textStyle:{color:"#fff"}},series:[{type:"tree",data:[this.originalData],symbolSize:[200,30],initialTreeDepth:100,edgeForkPosition:"50%",roam:"move",label:{normal:{position:"inside",align:"left",color:"#fff",fontSize:12,borderWidth:0,offset:[-85,1]}},leaves:{label:{normal:{position:"inside",align:"left"}}}}]},this.myChart.setOption(this.option,!0)},refresh:function(){var t=this;this.refreshLoading=!0,h.pingExecuteComTask().then((function(e){t.$message.success("更新成功"),t.tableInit(),t.timer=setInterval((function(){t.tableInit()}),6e5)})).catch((function(){t.$message.error("更新失败")})).finally((function(){t.refreshLoading=!1}))},clickFun:function(t){if(console.log("aaaaa",t),this.clickChildrenLength=0,t.dataIndex>1){var e=t.data.sysSpaceConditions;if(e)if(this.diguiGetChildLength(e),this.clickSymbolList.length){var i=!1,n=null;this.clickSymbolList.forEach((function(e,a){e.dataIndex===t.dataIndex&&(i=!0,n=a)})),i?(this.clickSymbolList.splice(n,1),this.height+=8*this.clickChildrenLength):(this.height>=100&&this.height-8*this.clickChildrenLength>=100?this.height-=8*this.clickChildrenLength:this.height=100,this.clickSymbolList.push({dataIndex:t.dataIndex,sysSpaceConditions:e}))}else this.height>=100&&this.height-8*this.clickChildrenLength>=100?this.height-=8*this.clickChildrenLength:this.height=100,this.clickSymbolList.push({dataIndex:t.dataIndex,sysSpaceConditions:e})}else this.height=100},diguiGetChildLength:function(t){var e=this;t.map((function(t){t.sysSpaceConditions&&e.diguiGetChildLength(t.sysSpaceConditions),e.clickChildrenLength+=1}))},diguiSetItemStyle:function(t,e){var n=this;if(this.show=!0,t&&0!==t.length)return t.map((function(t,a){e&&(t.online=!0),t.children=t.sysSpaceConditions,t.symbol="image://"+i("9800"),t.lineStyle={color:t.online?"#4EC752":"red",curveness:1,type:t.online?"solid":"dashed"},t.rawBasicVoList&&t.rawBasicVoList.map((function(e){"subType"!==e.url||"assistance_camera_yuntai"!==e.name&&"assistance_camera_gun"!==e.name&&"assistance_camera_speed"!==e.name?"type"===e.url&&"sensor"===e.name&&(n.basicInfo[e.name].value+=1,t.online?n.basicInfo.online.value+=1:n.basicInfo.offline.value+=1):(n.basicInfo["cameraList"].value+=1,t.online?n.basicInfo.online.value+=1:n.basicInfo.offline.value+=1)})),t.sysSpaceConditions?n.diguiSetItemStyle(t.sysSpaceConditions):(n.total+=1,n.total>=20&&n.total<=30&&(n.height+=8),n.total>30&&(n.height+=3))})),t}},beforeDestroy:function(){clearInterval(this.timer)}},v=b,y=(i("d5b4"),i("2877")),C=Object(y["a"])(v,o,s,!1,null,"dabcf698",null),I=C.exports,A={components:{Topo:I},data:function(){return{}},mounted:function(){}},S=A,O=(i("69ad"),Object(y["a"])(S,n,a,!1,null,"a3d466d6",null));e["default"]=O.exports},"4f5f":function(t,e,i){},"69ad":function(t,e,i){"use strict";i("f3dd")},9800:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALEAAAAdCAYAAADl941QAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAH1SURBVHhe7dtNSxtRAIVhl4IUrKa2YiVMEhJ1QPNtNZpUDWoxuhBRY00b1EI/UgkqpUWwXXQjCAmoXdgqQTfdKIgLf95xbkBwmBvNasYLZ/Ewu7N65zKLuQ2NTzQQqezBiFu1YXQE54hs5Y7lqs+nnQPSLu+qGfGL7ilElw+RLF4hlj9G+O0fIttEckeIr1QwVDhHeLGMFndC2qkgjfiZL43+lRP0ze2h2f2ayFGh7D7ixkFaK2RpxK/WTqHP/JYOEjkhOF8yDtaKpVXBEnF7z7QR8Zl0iMhJAx/O4PKOmnoVLBEHxjYQfXckHSFyUjx/Ak9izdSrYIlYz+zwW5gepVD2AF3j30y9CpaI/aNF9GR+SUeInNQ7uwvPYB0nMSOmx4oRk/IYMSmPEZPyGDEpjxGT8hgxKY8Rk/IYMSmPEZPyGDEpjxGT8uqOWM/8RHChLB0hclJk6bC+v9gC6U1E83+lI0ROEpc1vMnPpl4FS8RNLh2pzWu8jOSkQ0RO0Ia+ILl+aWr1liVioXvyO/pXK3iuz0oHiezUEV6unsKB9JalVUEaseBLFTBcuKhenw5M/DDehE9EtvGOFNH1Zhux9/+Q+Pgf2uCqtFOhZsRCm38c/rENhBZKhjKRbSJL+8azBN/IV7g8KWmft+6NmEgFjJgUp+EGtbJks2L1AtEAAAAASUVORK5CYII="},d5b4:function(t,e,i){"use strict";i("4f5f")},f3dd:function(t,e,i){}}]);