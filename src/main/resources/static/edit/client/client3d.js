/*
 * client3d.js - v0.3.1
 * Compiled Sun Sep 22 2019 21:34:52 GMT+0800 (GMT+08:00)
 * Copyright (c) 2019 www.hisense.com & www.hightopo.com
 */

var hteditor3d=function(){"use strict";function O(O){return/^scenes/.test(O)}function z(O){return/^models/.test(O)}function U(O){return/^symbols/.test(O)}function a(O){return/^assets/.test(O)}function b(O){return/\.obj$/i.test(O)}function T(O){return/\.mtl$/i.test(O)}function d(O){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(O)}function o(O){return ht.Default.getImageMap()[O]?(delete ht.Default.getImageMap()[O],!0):ht.Default.getCompTypeMap()[O]?(delete ht.Default.getCompTypeMap()[O],!0):(void 0!==ht.Default.getShape3dModel(O)&&ht.Default.setShape3dModel(O,void 0),!1)}function I(O,z,U,a){var b=new ht.Tab;return b.setName(z),b.setView(U),O.getTabModel().add(b),a&&O.getTabModel().sm().ss(b),b}function B(O){var z=new RegExp("(^|&)"+O+"=([^&]*)(&|$)"),U=window.location.search.substr(1).match(z);return null!=U?decodeURIComponent(U[2]):null}var k={createTablePane:function(){var O=new ht.widget.TablePane;return O.getView().style.border=hteditor.config.color_line+" solid 1px",O},removeItem:function(O,z){if(O){var U=O.indexOf(z);U>=0&&O.splice(U,1)}},alert:function(O,z,U,a){var b=[{label:hteditor.getString("editor.ok"),action:function(){T.hide(),U&&U()}}],T=new ht.widget.Dialog({title:O||" ",contentPadding:20,width:a||300,draggable:!0,content:"<p>"+z+"</p>",buttons:b});T.show()},config:window.hteditor_config||{}},e=function(){};ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("hxeditor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("hxeditor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.sphere",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("hxeditor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("hxeditor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("hxeditor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("hxeditor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("hxeditor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]});var H=(function(){function O(O){this.value=O}function z(z){function U(O,z){return new Promise(function(U,b){var o={key:O,arg:z,resolve:U,reject:b,next:null};d?d=d.next=o:(T=d=o,a(O,z))})}function a(U,T){try{var d=z[U](T),o=d.value;o instanceof O?Promise.resolve(o.value).then(function(O){a("next",O)},function(O){a("throw",O)}):b(d.done?"return":"normal",d.value)}catch(O){b("throw",O)}}function b(O,z){switch(O){case"return":T.resolve({value:z,done:!0});break;case"throw":T.reject(z);break;default:T.resolve({value:z,done:!1})}T=T.next,T?a(T.key,T.arg):d=null}var T,d;this._invoke=U,"function"!=typeof z.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(z.prototype[Symbol.asyncIterator]=function(){return this}),z.prototype.next=function(O){return this._invoke("next",O)},z.prototype.throw=function(O){return this._invoke("throw",O)},z.prototype.return=function(O){return this._invoke("return",O)}}(),function(O,z){if(!(O instanceof z))throw new TypeError("Cannot call a class as a function")}),S=function(){function O(O,z){for(var U=0;U<z.length;U++){var a=z[U];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(O,a.key,a)}}return function(z,U,a){return U&&O(z.prototype,U),a&&O(z,a),z}}(),f=function(O,z){if("function"!=typeof z&&null!==z)throw new TypeError("Super expression must either be null or a function, not "+typeof z);O.prototype=Object.create(z&&z.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(O,z):O.__proto__=z)},W=function(O,z){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!z||"object"!=typeof z&&"function"!=typeof z?O:z},A=function(){function O(z,U){var a=this;H(this,O),this.handler=z,this.editor=U,this.cookie=0,this.callbacks={},this.cmds={};var b=hteditor.config.host||window.location.hostname,T=hteditor.config.port||window.location.port,d="http://"+b+":"+T;this.socket=io.connect(d),this.socket.on("connect",function(){a.handler({type:"connected",message:d})}),this.socket.on("disconnect",function(){a.handler({type:"disconnected",message:d})}),this.socket.on("fileChanged",function(O){a.handler({type:"fileChanged",path:O.path,event:O.event})}),this.socket.on("operationDone",function(O,z){a.handleRespone(O,z)}),this.socket.on("download",function(O){a.handler({type:"download",path:O})}),this.socket.on("confirm",function(O,z){a.handler({type:"confirm",path:O,datas:z})})}return O.prototype.request=function(O,z,U){var a=++this.cookie;this.callbacks[a]=U,this.cmds[a]=O;var b=this.editor.sid;this.socket.emit(O,a,z,b?{sid:b}:null);var T=O;z&&(ht.Default.isString(z)?T=O+": "+z:z.path&&(T=O+": "+z.path)),this.handler({type:"request",message:T,cmd:O,data:z})},O.prototype.handleRespone=function(O,z){var U=this.callbacks[O],a=this.cmds[O];delete this.callbacks[O],delete this.cmds[O],U&&U(z),this.handler({type:"response",message:a,cmd:a,data:z})},O}(),i=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"scenes"))}return f(z,O),z.prototype.initTreeMenu=function(O,z){this.addLocateTreeFileItem(z),this.addNewFolderItem(z,this.tree),this.addRenameItem(z,this.tree),this.addDeleteItem(z,this.tree)},z.prototype.initListMenu=function(O,z){this.addLocateListFileItem(z),this.addNewFolderItem(z,this.list),this.addCopyItem(z),this.addPasteItem(z),this.addRenameItem(z,this.list),this.addDeleteItem(z,this.list),this.addExportItem(z)},z}(hteditor.Explorer),M=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"models"))}return f(z,O),z.prototype.initTreeMenu=function(O,z){this.addLocateTreeFileItem(z),this.addNewFolderItem(z,this.tree),this.addRenameItem(z,this.tree),this.addDeleteItem(z,this.tree)},z.prototype.initListMenu=function(O,z){this.addLocateListFileItem(z),this.addNewFolderItem(z,this.list),this.addCopyItem(z),this.addPasteItem(z),this.addRenameItem(z,this.list),this.addDeleteItem(z,this.list)},z}(hteditor.Explorer),Y=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"symbols"))}return f(z,O),z.prototype.initTreeMenu=function(O,z){this.addLocateTreeFileItem(z),this.addNewFolderItem(z,this.tree),this.addRenameItem(z,this.tree),this.addDeleteItem(z,this.tree)},z.prototype.initListMenu=function(O,z){this.addLocateListFileItem(z),this.addNewFolderItem(z,this.list),this.addCopyItem(z),this.addPasteItem(z),this.addRenameItem(z,this.list),this.addDeleteItem(z,this.list)},z}(hteditor.Explorer),m=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"assets"))}return f(z,O),z.prototype.initTreeMenu=function(O,z){this.addLocateTreeFileItem(z),this.addNewFolderItem(z,this.tree),this.addRenameItem(z,this.tree),this.addDeleteItem(z,this.tree)},z.prototype.initListMenu=function(O,z){this.addLocateListFileItem(z),this.addNewFolderItem(z,this.list),this.addCopyItem(z),this.addPasteItem(z),this.addRenameItem(z,this.list),this.addDeleteItem(z,this.list)},z}(hteditor.Explorer),_=hteditor.getString,x=function(O){function z(U){H(this,z);var a=W(this,O.call(this));a.editor=U,a.editor.menus.push(a);var b=[{label:_("editor.newsceneview"),action:function(){a.editor.newScene()}},{label:_("editor.newmodel"),items:[{label:_("editor.obj"),action:function(){a.editor.newOBJModel()}}]}];return a.setItems(b),a}return f(z,O),z}(ht.widget.ContextMenu),j=function(O){function z(U){H(this,z);var a=W(this,O.call(this,U.gv));return a.editor=U,a}return f(z,O),z.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},z.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},z.prototype.getDataAt=function(O){return this.gv.getDataAt(O)},z.prototype.getNodeAt=function(O){var z=this.getDataAt(O);return z instanceof ht.Node?z:null},z.prototype.setUp=function(){O.prototype.setUp.call(this),this.sm.cs()},z.prototype.$0$=function(O){},z.prototype.drawRect=function(O,z,U,a){z=this.toRect(z),a&&(O.fillStyle=a),U&&(O.strokeStyle=U),O.lineWidth=1,O.beginPath(),O.rect(z.x,z.y,z.width,z.height),O.stroke(),a&&O.fill(),U&&O.stroke()},z.prototype.drawPoint=function(O,z,U,a,b){z=this.toPoint(z),b&&(O.fillStyle=b),a&&(O.strokeStyle=a),O.lineWidth=1,O.beginPath(),O.arc(z.x,z.y,U,0,2*Math.PI,!0),b&&O.fill(),a&&O.stroke()},z.prototype.drawPoints=function(O,z,U,a,b){for(var T=0;T<z.length;T++)this.drawPoint(O,z[T],U,a,b)},z.prototype.drawLine=function(O,z,U,a){z=this.toPoint(z),U=this.toPoint(U),O.lineWidth=1,O.strokeStyle=a,O.beginPath(),O.moveTo(z.x,z.y),O.lineTo(U.x,U.y),O.stroke()},z.prototype.toRect=function(O){var z=this.zoom;return{x:O.x*z+this.tx,y:O.y*z+this.ty,width:O.width*z,height:O.height*z}},z.prototype.toPoint=function(O){return{x:O.x*this.zoom+this.tx,y:O.y*this.zoom+this.ty}},z.prototype.addData=function(O){this.editor.dm.add(O),this.editor.sm.ss(O),this.editor.gv.setFocus()},z.prototype.remove=function(O){this.dm.remove(O)},z.prototype.lp=function(O){return this.gv.lp(O)},S(z,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),z}(ht.graph.Interactor),N=function(O){function z(U,a,b){H(this,z);var T=W(this,O.call(this,U));return T.createFunc=a,T.points=[],T.segments=[],T.nextPoint=null,T.fill=b,T}return f(z,O),z.prototype.tearDown=function(){O.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},z.prototype.$49$=function(O){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},z.prototype.createShape=function(){if(this.points.length>1){var O=this.createFunc(this.points,this.segments);this.addData(O)}this.editor.$5$("edit"),this.editor.pointsEditingMode=!0},z.prototype.handle_mousedown=function(O){this.handle_touchstart(O)},z.prototype.handle_touchstart=function(O){if(ht.Default.preventDefault(O),ht.Default.isLeftButton(O))if(this.gv.setFocus(O),ht.Default.isDoubleClick(O))this.createShape();else{var z=this.lp(O);if(this.points.length){var U=this.points[this.points.length-1];if(Math.abs(U.x-z.x)<.01&&Math.abs(U.y-z.y)<.01)return}this.points.push(z),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(O),this.editor.rulerView.validateCanvas()}},z.prototype.handle_mousemove=function(O){this.nextPoint&&(this.nextPoint=this.lp(O),this.editor.rulerView.validateCanvas())},z.prototype.$0$=function(O){O.beginPath();for(var z=0,U=void 0,a=void 0,b=void 0,T=0;T<this.segments.length;T++){var d=this.segments[T];1===d?(U=this.toPoint(this.points[z++]),O.moveTo(U.x,U.y)):2===d?(U=this.toPoint(this.points[z++]),O.lineTo(U.x,U.y)):3===d?(U=this.toPoint(this.points[z++]),a=this.toPoint(this.points[z++]),O.quadraticCurveTo(U.x,U.y,a.x,a.y)):4===d?(U=this.toPoint(this.points[z++]),a=this.toPoint(this.points[z++]),b=this.toPoint(this.points[z++]),O.bezierCurveTo(U.x,po,y,a.x,a.y,b.x,b.y)):5===d&&O.closePath()}if(this.nextPoint){var o=this.toPoint(this.nextPoint);O.lineTo(o.x,o.y)}O.strokeStyle=hteditor.config.color_data_border,O.lineWidth=1,O.stroke(),this.fill&&(O.fillStyle=hteditor.config.color_transparent,O.fill()),this.drawPoints(O,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},z}(j),w=function(O){function z(U,a){H(this,z);var b=W(this,O.call(this,U));return b.createFunc=a,b}return f(z,O),z.prototype.tearDown=function(){O.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},z.prototype.handle_mousedown=function(O){this.handle_touchstart(O)},z.prototype.handle_touchstart=function(O){ht.Default.preventDefault(O),ht.Default.isLeftButton(O)&&(this.gv.setFocus(O),this.p1=this.lp(O),this.startDragging(O))},z.prototype.handleWindowMouseMove=function(O){this.handleWindowTouchMove(O)},z.prototype.handleWindowMouseUp=function(O){this.handleWindowTouchEnd(O)},z.prototype.handleWindowTouchMove=function(O){if(ht.Default.preventDefault(O),this.p1){this.p2=this.lp(O);var z=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(z);else{if(!z.width||!z.height)return;this.beginTransaction(),this.createNode(z,!1)}}},z.prototype.handleWindowTouchEnd=function(O){ht.Default.preventDefault(O),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.$5$("edit")},z.prototype.createNode=function(O,z){this.node=this.createFunc(O,z),this.node.s3(50,50,50),z?this.node.setPosition(O.x+O.width/2,O.y+O.height/2):this.node.setRect(O),this.addData(this.node)},z.prototype.$0$=function(O){this.node&&this.drawRect(O,this.node.getRect(),hteditor.config.color_data_border)},z}(j),q=hteditor.getString,D=function(O){function z(U){H(this,z);var a=W(this,O.call(this));return a.editor=U,a.initMenu(),a.$69$(),a.enableToolTip(),a}return f(z,O),z.prototype.initMenu=function(){var O=this.editor.mainMenu=new x(this.editor),z=function(z){O.isShowing()&&!O.getView().contains(z.target)&&O.hide()};window.addEventListener("touchstart",z,!1),window.addEventListener("mousedown",z,!1)},z.prototype.$69$=function(){var O=[];O.push(this.$68$()),O.push(this.createEditItem()),O.push(this.createCubeItem()),O.push(this.createCylinderItem()),O.push(this.createSphereItem()),O.push(this.createWallItem()),O.push(this.createDoorWindowItem()),O.push(this.createFloorItem()),O.push(this.createPipelineItem()),this.setItems(O)},z.prototype.$68$=function(){var O=this,z=hteditor.createItem("menu",q("editor.menu"),"editor.menu");return z.action=function(z,U,a){O.editor.mainMenu.isShowing()||(O.editor.mainMenu.showOnView(O,4,20),a.preventDefault(),a.stopPropagation())},z},z.prototype.createEditItem=function(){var O=this,z=function(){return"edit"===O.editor.$4$()},U=hteditor.createItem("edit",q("editor.edit"),"editor.edit",z);return U.action=function(){O.editor.$5$("edit")},U},z.prototype.createWallItem=function(){var O=this,z=function(){return"wall"===O.editor.$4$()},U=hteditor.createItem("wall",q("editor.wall"),"hxeditor.wall",z);return U.action=function(){var z=new N(O.editor,function(O,z){var U=new ht.Shape;return U.setTall(280),U.setThickness(14),U.setElevation(U.getTall()/2),U.setPoints(O),U.setSegments(z),U.s({"all.color":"#DDDDDD","shape.background":null,"shape.border.width":U.getThickness(),"shape.border.color":"#DDDDDD"}),U});O.editor.$5$("wall",z)},U},z.prototype.createDoorWindowItem=function(){var O=this,z=function(){return"doowWindow"===O.editor.$4$()},U=hteditor.createItem("doorWindow",q("editor.doorwindow"),"editor.doorWindow",z);return U.action=function(){var z=new w(O.editor,function(){return new ht.DoorWindow},!0);O.editor.$5$("doowWindow",z)},U},z.prototype.createFloorItem=function(){var O=this,z=function(){return"floor"===O.editor.$4$()},U=hteditor.createItem("floor",q("editor.floor"),"hxeditor.floor",z);return U.action=function(){var z=new N(O.editor,function(O,z){var U=new ht.Shape;return U.setTall(10),U.setThickness(-1),U.setElevation(-U.getTall()/2),U.setPoints(O),U.setSegments(z),U.s({"shape3d.color":"#EEEEEE","shape3d.top.color":"#EEEEEE","shape3d.bottom.color":"#EEEEEE","shape.background":"#EEEEEE"}),U.setAnchor3d(.5,0,.5),U},!0);O.editor.$5$("floor",z)},U},z.prototype.createPipelineItem=function(){var O=this,z=function(){return"pipeline"===O.editor.$4$()},U=hteditor.createItem("pipeline",q("editor.pipeline"),"hxeditor.pipeline",z);return U.action=function(){var z=new N(O.editor,function(O,z){var U=new ht.Polyline;return U.setPoints(O),U.setSegments(z),U.setThickness(10),U.s({shape3d:"cylinder","shape3d.color":"#BFBFBF","shape3d.top.color":"#BFBFBF","shape3d.bottom.color":"#BFBFBF","shape.background":null,"shape.border.width":U.getThickness(),"shape.border.color":"#BFBFBF"}),U});O.editor.$5$("pipeline",z)},U},z.prototype.createCubeItem=function(){var O=this,z=function(){return"cube"===O.editor.$4$()},U=hteditor.createItem("cube",q("editor.cube"),"hxeditor.cube",z);return U.action=function(){var z=new w(O.editor,function(){var O=new ht.Node;return O.s({"all.color":"#DDDDDD"}),O.setAnchor3d(.5,0,.5),O},!0);O.editor.$5$("cube",z)},U},z.prototype.createCylinderItem=function(){var O=this,z=function(){return"cylinder"===O.editor.$4$()},U=hteditor.createItem("cylinder",q("editor.cylinder"),"hxeditor.cylinder",z);return U.action=function(){var z=new w(O.editor,function(){var O=new ht.Node;return O.s({shape3d:"cylinder","shape3d.color":"#DDDDDD"}),O.setAnchor3d(.5,0,.5),O},!0);O.editor.$5$("cylinder",z)},U},z.prototype.createSphereItem=function(){var O=this,z=function(){return"sphere"===O.editor.$4$()},U=hteditor.createItem("cube",q("editor.sphere"),"hxeditor.sphere",z);return U.action=function(){var z=new w(O.editor,function(){var O=new ht.Node;return O.s({shape3d:"sphere","shape3d.color":"#DDDDDD"}),O.setAnchor3d(.5,0,.5),O},!0);O.editor.$5$("sphere",z)},U},z}(ht.widget.Toolbar),v=hteditor.getString,L=function(O){function z(U){H(this,z);var a=W(this,O.call(this));return a.editor=U,a.$69$(),a.enableToolTip(),a.setStickToRight(!0),a.editor.gv.addPropertyChangeListener(a.handlePropertyChange,a),a.$70$(),a}return f(z,O),z.prototype.handlePropertyChange=function(O){"zoom"===O.property&&this.$70$()},z.prototype.$70$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},z.prototype.$69$=function(){var O=this,z=void 0,U=[];z=hteditor.createItem("save",v("editor.save"),"editor.save"),z.action=function(){O.editor.save()},U.push(z),z=hteditor.createItem("reload",v("editor.reload"),"editor.reload"),z.action=function(){O.editor.reload()},U.push(z),U.push({separator:!0}),z=hteditor.createItem("grid",v("editor.showaxis"),"editor.axis",function(){return!O.editor.scene.isEditHelperDisabled()}),z.action=function(){O.editor.scene.setEditHelperDisabled(!O.editor.scene.isEditHelperDisabled())},U.push(z),z=hteditor.createItem("grid",v("editor.showgrid"),"editor.grid",function(){return O.editor.gridVisible}),z.action=function(){O.editor.toggleGridEnabled()},U.push(z),z=hteditor.createItem("preview",v("editor.preview"),"editor.preview"),z.action=function(){O.editor.preview()},U.push(z),U.push({separator:!0}),U.push(this.createZoomItem()),z=hteditor.createItem("zoomToFit",v("editor.zoomtofit"),"editor.zoomtofit"),z.action=function(){O.editor.zoomToFit()},U.push(z),U.push({separator:!0}),z=hteditor.createItem("toggleLeft",v("editor.toggleleft"),"editor.toggleleft"),z.action=function(){O.editor.toggleLeft()},U.push(z),z=hteditor.createItem("toggleRight",v("editor.toggleright"),"editor.toggleright"),z.action=function(){O.editor.toggleRight()},U.push(z),this.setItems(U)},z.prototype.createZoomItem=function(){var O=this,z=this.label=ht.Default.createDiv(!0);z.style.font=this.getLabelFont(),z.style.color=this.getLabelColor(),z.style.cursor="ew-resize",z.style.width="40px",z.style.height=ht.Default.widgetRowHeight+"px",z.style.lineHeight=ht.Default.widgetRowHeight+"px",z.style.whiteSpace="nowrap",z.style.textAlign="center";var U=function(z){z.preventDefault();var U=O.editor.gv;ht.Default.isDoubleClick(z)&&U.zoomReset();var a=U.getZoom(),b=ht.Default.getClientPoint(z).x,T=function(O){O.preventDefault();var z=ht.Default.getClientPoint(O).x-b;U.setZoom(a*(1+.005*z))};window.addEventListener("mousemove",T,!1),window.addEventListener("touchmove",T,!1);var d=function(O){O.preventDefault(),window.removeEventListener("mousemove",T,!1),window.removeEventListener("touchmove",T,!1),window.removeEventListener("mouseup",d,!1),window.removeEventListener("touchend",d,!1)};window.addEventListener("mouseup",d,!1),window.addEventListener("touchend",d,!1)};return z.addEventListener("mousedown",U,!1),z.addEventListener("touchstart",U,!1),{id:"zoom",unfocusable:!0,element:z}},z}(ht.widget.Toolbar),G=function(O){function z(U){H(this,z);var a=W(this,O.call(this,U.dm));return a.editor=U,a.setEditable(!0),a.topDiv=ht.Default.createDiv(),a}return f(z,O),z.prototype.isInteractive=function(){return!1},z.prototype.handleDelete=function(){this.removeSelection()},z.prototype.getBrightness=function(){return null},z.prototype.isDroppable=function(O,z){return z.view===this.editor.models.list||(z.view===this.editor.symbols.list||z.view===this.editor.assets.list)},z.prototype.$59$=function(O){if(this.dragImage){var z=hteditor.config.dragImageSize,U=ht.Default.getPagePoint(O);this.dragImage.style.left=U.x-z/2+"px",this.dragImage.style.top=U.y-z/2+"px"}},z.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},z.prototype.handleCrossDrag=function(O,z,U){var a=this,b=U.view,T=b.draggingData;if("enter"===z){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var d=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),d,d,"centerUniform",T,U.view,null,ht.Default.devicePixelRatio),this.$59$(O),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===z||"cancel"===z)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===z)this.$59$(O);else if("drop"===z&&(ht.Default.removeHTML(this.topDiv),T)){this.removeDragImage();var o=this.getHitPosition(O);b.isSelected(T)?b.sm().toSelection().each(function(z){b.handleDropToEditView?b.handleDropToEditView(a,z,o,O):a.$100$(z,o)}):b.handleDropToEditView?b.handleDropToEditView(this,T,o,O):this.$100$(T,o)}},z.prototype.$100$=function(O,z){if(O){var U=O.url,a=O.fileType;if("model"===a||"symbol"===a||d(U)){var b=new ht.Node;"model"===a?b.s({shape3d:U}):("symbol"===a||d(U))&&(b.s({shape3d:"billboard","shape3d.image":U,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),b.setImage(U)),b.setAnchor3d(.5,0,.5),b.p3(z),b.s("wf.visible","selected"),this.dm().add(b),this.sm().ss(b)}}},z.prototype.toImage=function(O){var z=k.config.imageSize||400,U=this.getWidth(),a=this.getHeight(),b=Math.max(U,a),T=z/b;return U=Math.floor(U*T),a=Math.floor(a*T),this.toCanvas(O,U,a).toDataURL("image/png",1)},z}(ht.graph3d.Graph3dView),V={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},u=function(){function O(z){var U=this;H(this,O),this.graphView=z,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(O){"validate"===O.kind&&U.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){U.iv()}),this.dm.sm().addSelectionChangeListener(function(O){U.iv()}),this.dm.addDataPropertyChangeListener(function(O){U.handleDataPropertyChanged(O)}),this.dm.addPropertyChangeListener(function(O){U.handleDataModelPropertyChanged(O)}),this.dm.layout=function(O){U._autoLayout||(U._autoLayout=new ht.layout.AutoLayout(U.graphView)),U._autoLayout.layout(O,function(){U.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(O){O.keep=!0})}return O.prototype.handleDataPropertyChanged=function(O){V[O.property]&&this.iv()},O.prototype.handleDataModelPropertyChanged=function(O){this.validateCanvas()},O.prototype.onPropertyChanged=function(O){this.iv()},O.prototype.addData=function(O){this.dm.add(O),this.dm.sm().ss(O),this.graphView.setFocus()},O.prototype.validateCanvas=function(){var O=this.graphView._topCanvas;if(O){var z=hteditor.initContext(O);z.clearRect(0,0,O.clientWidth,O.clientHeight),this.graphView.getInteractors().each(function(O){O.$0$&&O.$0$(z)}),z.restore()}},O.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},O.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},O.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},O.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},S(O,[{key:"dm",get:function(){return this.graphView.dm()}}]),O}();hteditor.msClass(u,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var X=function(O){function z(U){H(this,z);var a=W(this,O.call(this,U.dm));return a.editor=U,a._topCanvas=ht.Default.createCanvas(),a._topDiv=ht.Default.createDiv(),a._view.insertBefore(a._topCanvas,a._scrollBarDiv),a._view.insertBefore(a._topDiv,a._scrollBarDiv),a.mi(function(O){"prepareMove"!==O.kind&&"prepareEdit"!==O.kind||!O.event.altKey||(a.editor.copy(),a.editor.paste(!0),a.validate())}),a}return f(z,O),z.prototype.isInteractive=function(){return!1},z.prototype.initMenu=function(){var O=this,z=[];this.menu=new ht.widget.ContextMenu(z),z.push({id:"bringToFront",label:hteditor.getString("editor.bringtofront"),action:function(){O.editor.bringToFront()},visible:function(){return!!O.editor.ld}}),z.push({id:"bringForward",label:hteditor.getString("editor.bringforward"),action:function(){O.editor.bringForward()},visible:function(){return!!O.editor.ld}}),z.push({id:"sendBackward",label:hteditor.getString("editor.sendbackward"),action:function(){O.editor.sendBackward()},visible:function(){return!!O.editor.ld}}),z.push({id:"sendToBack",label:hteditor.getString("editor.sendtoback"),action:function(){O.editor.sendToBack()},visible:function(){return!!O.editor.ld}}),z.push({separator:!0,visible:function(){return!!O.editor.ld}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},z.prototype.getUnionNodeRect=function(O){var z=this,U=void 0;return O=O._as||O,O.forEach(function(O){O instanceof ht.Node&&(U=ht.Default.unionRect(U,z.getNodeRect(O)))}),U},z.prototype.getImage=function(O){var z=O.s("shape3d");if(z){var U=ht.Default.getShape3dModel(z);if(U&&U.json&&U.json.image)return U.json.image;if("sphere"===z||"cylinder"===z)return"hxeditor.sphere.image"}var a=O.getImage();return a&&"node_image"!==a?a:O.s("shape3d.image")?O.s("shape3d.image"):"hxeditor.cube.image"},z.prototype.getSelectWidth=function(O){return!this.isEditable(O)||O instanceof ht.Edge?O.s("select.width"):0},z.prototype.isDroppable=function(O,z){return z.view===this.editor.models.list||(z.view===this.editor.symbols.list||z.view===this.editor.assets.list)},z.prototype.$59$=function(O){if(this.dragImage){var z=hteditor.config.dragImageSize,U=ht.Default.getPagePoint(O);this.dragImage.style.left=U.x-z/2+"px",this.dragImage.style.top=U.y-z/2+"px"}},z.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},z.prototype.handleCrossDrag=function(O,z,U){var a=this,b=U.view,T=b.draggingData;if("enter"===z){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var d=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),d,d,"centerUniform",T,U.view,null,ht.Default.devicePixelRatio),this.$59$(O),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===z||"cancel"===z?(this._topDiv.style.border="",this.removeDragImage()):"over"===z?this.$59$(O):"drop"===z&&(this._topDiv.style.border="",T&&(this.removeDragImage(),this.sm().cs(),b.handleDropToEditView?b.handleDropToEditView(this,T,this.lp(O),O):b.isSelected(T)?b.sm().toSelection().each(function(z){a.$100$(z,O)}):this.$100$(T,O)))},z.prototype.$100$=function(O,z){var U=this.lp(z);if("model"===O.fileType){var a=new ht.Node;a.s({shape3d:O.url}),a.setAnchor3d(.5,0,.5),a.setPosition(U),this.dm().add(a),this.sm().ss(a)}else if("symbol"===O.fileType||"image"===O.fileType){var b=new ht.Node;b.s({shape3d:"billboard","shape3d.image":O.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),b.setAnchor3d(.5,0,.5),b.p(U),b.setImage(O.url),this.dm().add(b),this.sm().ss(b)}},z}(ht.graph.GraphView),l=hteditor.combineShapes,Z=hteditor.splitShape,t={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(O,z){if(O instanceof ht.Node){var U=O.s("shape3d")
;if(ht.Default.isString(U)&&hteditor.isJSON(U))return null}return hteditor.config.color_dark}},name:{func:function(O,z){if(O instanceof ht.Shape)return O.getThickness()>0?"hxeditor.wall":"hxeditor.floor";if(O instanceof ht.Node){var U=O.s("shape3d");if(U){if(ht.Default.isString(U)&&hteditor.isJSON(U))return U.substr(0,U.length-4)+"png";if("sphere"===U)return"hxeditor.sphere";if("cylinder"===U)return"hxeditor.cylinder"}return"hxeditor.cube"}return O.getIcon()}},rect:[0,0,20,16]}]},P=hteditor.getString,$={box:"editor.box",sphere:"editor.sphere",cone:"editor.cone",torus:"editor.torus",cylinder:"editor.cylinder",star:"editor.star",rect:"editor.rect",roundRect:"editor.roundrect",triangle:"editor.triangle",rightTriangle:"editor.righttriangle",parallelogram:"editor.parallelogram",trapezoid:"editor.trapezoid"},R=function(O){function z(U){H(this,z);var a=W(this,O.call(this,U,U.dm));return a.initMenu(),a}return f(z,O),z.prototype.handleDelete=function(){this.removeSelection()},z.prototype.onDataDoubleClicked=function(O,z){z.altKey?this.editor.gv.fitData(O,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(O,!0),this.editor.scene.flyTo(O,{animation:!0}))},z.prototype.getLabel=function(z){var U=O.prototype.getLabel.call(this,z);if(!U){var a=z.s("shape3d");z instanceof ht.Shape?U=P("cylinder"===a?"editor.pipeline":z.getThickness()>0?"editor.wall":"editor.floor"):z instanceof ht.Node&&((U=P($[a]))||(U=hteditor.isJSON(a)?hteditor.fileNameToDisplayName(a):a)),U||(U=P("editor.cube"))}return U||""},z.prototype.getIcon=function(O){return t},z.prototype._endDrag=function(O,z){var U=this,a=z.type,b=z.parent,T=z.refData;if(this.isSelected(this.draggingData)){var d=this.getTopRowOrderSelection();"down"===a&&d.reverse(),d.each(function(O){U._dropData(O,a,b,T)})}else this._dropData(this.draggingData,a,b,T),this.sm().ss(this.draggingData);b&&this.expand(b)},z.prototype._dropData=function(O,z,U,a){if(O.setParent(U),"down"===z||"up"===z){var b=U?U.getChildren():this.dm().getRoots(),T=b.indexOf(a);"down"===z&&T++,b.indexOf(O)<T&&T--,this.dm().moveTo(O,T)}else U||this.dm().moveToBottom(O)},z.prototype.isEditable=function(O){return!0},z.prototype.rename=function(O,z){O.setDisplayName(z)},z.prototype.initMenu=function(){var O=this,z=function(){for(var z=O.editor.sm.getSelection(),U=0,a=z.length;U<a;U++)if(!(z.get(U)instanceof ht.Shape))return!1;return!0};this.menu=new ht.widget.ContextMenu;var U=[{id:"combine",label:P("editor.combineshapes"),action:function(){O.editor.beginTransaction(),l(O.editor.sm.getSelection().toArray(),O.editor.ld.getClass()),O.editor.endTransaction()},visible:function(){return O.editable&&O.editor.sm.size()>1&&z()}},{id:"splitShape",label:P("editor.splitshape"),action:function(){O.editor.beginTransaction(),Z(O.editor.ld,O.editor.ld.getClass()),O.editor.endTransaction()},visible:function(){return O.editable&&1===O.editor.sm.size()&&O.editor.ld instanceof ht.Shape}}];this.menu.setItems(U),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},z}(hteditor.DNDTree),n=function(O){function z(U){return H(this,z),W(this,O.call(this,U))}return f(z,O),z.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},z.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},z.prototype.$6$=function(){},z}(hteditor.DataView),s=hteditor.getString,g=function(O){function z(U){H(this,z);var a=W(this,O.call(this));a.editor=U,a.buttons={};var b=[];b.push(a.createItem("cluster",s("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),b.push(a.createItem("distributeHorizontal",s("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),b.push(a.createItem("distributeVertical",s("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),b.push(a.createItem("alignLeft",s("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),b.push(a.createItem("alignHorizontal",s("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),b.push(a.createItem("alignRight",s("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),b.push(a.createItem("alignTop",s("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),b.push(a.createItem("alignVertical",s("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),b.push(a.createItem("alignBottom",s("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var T=.1,d=[T,T,T,T,T,T,T,T,T];return a.addRow(b,d),a.updateItems(),a.editor.sm.ms(function(){return a.updateItems()}),a}return f(z,O),z.prototype.createItem=function(O,z,U){var a=this;U.forEach(function(O){O.borderCap="round"}),U[0].borderColor=U[0].borderColor||hteditor.config.color_dark,U[1].borderColor=U[1].borderColor||hteditor.config.color_select;var b={width:16,height:16,fitSize:!0,comps:U};return this.buttons[O]=hteditor.createButton(null,z,b,function(){a[O]()})},z.prototype.updateItems=function(){var O=[];this.editor.sm.each(function(z){z instanceof ht.Node&&O.push(z)}),O.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):O.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},z.prototype.getUnionRect=function(O){return this.editor.gv?this.editor.gv.getUnionNodeRect(O):null},z.prototype.isSelected=function(O){return this.editor.sm.contains(O)},z.prototype.hasSelectedGroupParent=function(O){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},z.prototype.hasSelectedHost=function(O){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},z.prototype.cluster=function(){var O=this.selection;if(O.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var z=void 0,U=void 0;O.forEach(function(O){void 0===z?z=U=O.getElevation():(z>O.getElevation()&&(z=O.getElevation()),U<O.getElevation()&&(U=O.getElevation()))}),O.sort(function(O,z){return O.getElevation()-z.getElevation()});for(var a=(U-z)/(O.length-1),b=1;b<O.length-1;b++)O[b].setElevation(z+b*a);this.editor.endTransaction()}},z.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},z.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},z.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},z.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},z.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},z.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},z.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},z.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},S(z,[{key:"selection",get:function(){var O=this,z=[];return this.editor.sm.each(function(U){U instanceof ht.Node&&(O.hasSelectedGroupParent(U.getParent())||O.hasSelectedHost(U)||z.push(U))}),z}}]),z}(ht.widget.FormPane),K=function(O){function z(U,a){var b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];H(this,z);var T=W(this,O.call(this,U,a,a,b));return T.setHPadding(8),T.setVPadding(4),T.addUpdateHandler(function(){T.initDataBindings()}),T}return f(z,O),z.prototype.initForm=function(){O.prototype.initForm.call(this),this.addCustomProperties()},z.prototype.addTitle=function(O,z){var U=this._oldTitle;this.editor.fireEvent("titleCreating",{oldTitle:U,title:O,inspector:this});var a=[],b=hteditor.getString("editor."+O.toLowerCase(),!0)||hteditor.getString(O);a.push({element:b,font:hteditor.config.boldFont}),z=z||{},z.title=O,z.background=hteditor.config.color_pane_dark;var T=this.addRow(a,[.1],null,z);return this._oldTitle=O,this.editor.fireEvent("titleCreated",{oldTitle:U,title:O,inspector:this}),T},z.prototype.addOneRow=function(O,z,U){for(var a=[this.indent,.1],b=2,T=O.length;b<T;b++)a.push(20);var d=this.addRow(O,a,z?this.getRowHeight()*z:null,U);return d.index=this.getRows().length-1,d},z.prototype.addDBRow=function(O,z,U,a,b){var T=this,d=void 0;if(k.config.dataBindings&&(!k.config.dataBindings.filter||k.config.dataBindings.filter(z,U))){var o=function(){k.config.dataBindings.onButtonClicked(T.data,z,U)},I=z+":"+U,B=this.addButton(O,null,I,null,o,!0);this.updateHandlers.push(function(){if(!O.hidden&&T.data){var a=k.config.isDataBound(T.data,z,U);B.setIcon(a?"editor.bind.state":"editor.unbind.state")}})}return d=this.addOneRow(O,b,a),d.keys={name:U,displayName:this.toDisplayName(O),accessType:z},d},z.prototype.initDataBindings=function(){var O=this,z=this._dataBindingRowInfos;z&&z.length>0&&(this.removeRows(z),this._dataBindingRowInfos=null);var U=this._dataBindingHandlers;U&&U.length>0&&(U.forEach(function(z){O.removeUpdateHandler(z)}),this._dataBindingHandlers=null);var a=this.data;if(a){var b=[a.s("all.image"),a.s("top.image"),a.s("bottom.image"),a.s("left.image"),a.s("right.image"),a.s("front.image"),a.s("back.image"),a.s("shape3d.image"),a.s("shape3d.top.image"),a.s("shape3d.bottom.image"),a.s("shape3d.from.image"),a.s("shape3d.to.image")],T=[];if(b.forEach(function(O){O&&T.push(ht.Default.getImage(O))}),0!==T.length){for(var d=[],o=!1,I=0,B=T.length;I<B;I++){var k=T[I];if(!k){o=!0;break}k.dataBindings&&d.push.apply(d,k.dataBindings)}if(o){var e=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var z=arguments.length,U=Array(z),a=0;a<z;a++)U[a]=arguments[a];e.apply(ht.Default,U),O.initDataBindings(),ht.Default.handleImageLoaded=e})}if(0!==d.length){var H=this.updateHandlers.length;z=[this.addTitle(hteditor.getString("DataBindings"))];var S={};d.forEach(function(U){var a=U.attr;if(!S[a]){S[a]=1;var b=O.$88$(U);z.push(O.addDBRow(b,"a",a))}}),this._dataBindingRowInfos=z,this._dataBindingHandlers=this.updateHandlers.slice(H),this._dataBindingHandlers.forEach(function(O){O()})}}}},z.prototype.$88$=function(O){var z=[],U=O.attr,a=hteditor.config.valueTypes[O.valueType];if(!a)return this.editor.fireEvent("error",{message:"Wrong value type:"+O.valueType,dataBind:O}),!1;var b=hteditor.getString(O.name)||U,T=function(O){return O.a(U)},d=function(O,z){return O.a(U,z)};return"int"===a.type||"number"===a.type?a.angle?this.addLabelRotation(z,b,T,d,a.min,a.max,a.step):this.addLabelRange(z,b,T,d,a.min,a.max,a.step,a.type):"color"===a.type?this.addLabelColor(z,b,T,d):"boolean"===a.type?this.addLabelCheckBox(z,b,T,d):"enum"===a.type?this.addLabelComboBox(z,b,T,d,a.values,a.labels,a.icons):"multiline"===a.type?this.addLabelMultiline(z,b,T,d):"font"===a.type?this.addLabelFont(z,b,T,d):"image"===a.type?this.addLabelImage(z,b,T,d):"url"===a.type?this.addLabelURL(z,b,T,d):"colorArray"===a.type?this.addLabelArray(z,b,T,d,"color"):"numberArray"===a.type?this.addLabelArray(z,b,T,d,"number"):"stringArray"===a.type?this.addLabelArray(z,b,T,d,"string"):"objectArray"===a.type?this.addLabelArray(z,b,T,d,"object"):"function"===a.type?this.addLabelFunction(z,b,T,d,U):"object"===a.type?this.addLabelObject(z,b,T,d,U):this.addLabelInput(z,b,T,d),z},z.prototype.addLabelData=function(O,z,U,a){var b=this,T=this.addLabelInput(O,z,function(O){var z=U(O);return z?z.toLabel()||z.getClassName():""}),d=T.getElement();T.isDroppable=function(O,z){return z.view.draggingData&&b.dataModel===z.view.draggingData.getDataModel()},T.handleCrossDrag=function(O,z,U){"enter"===z?d.style.border="solid "+k.config.color_select_dark+" 2px":"exit"===z||"cancel"===z?d.style.border="":"over"===z||"drop"===z&&(d.style.border="",b.setValue(a,U.view.draggingData),T.setFocus())},d.onkeydown=function(O){ht.Default.isDelete(O)&&b.setValue(a,null)};var o=new ht.widget.Image;o.drawImage=function(O,z,U,a,T,d){var I=o.data,B=b.editor.list;I&&B&&B.dm().contains(I)&&(z=B.getIcon(I))&&drawStretchImage(O,ht.Default.getImage(z),"centerUniform",U,a,T,d,I,B)},this.updateHandlers.push(function(){if(!O.hidden){var z=o.data;o.data=b.getValue(U),o.fp("data",z,o.data)}}),O.push(o)},z.prototype.addLabelComboBoxURL=function(O,z,U,a,b,T,d,o){var I=this,B=this.addLabelComboBox(O,z,U,a,b,T,d);if(a){B.setEditable(!0);var e=B.getView();B.isDroppable=o||function(O,z){return!!z.view.draggingData},B.handleCrossDrag=function(O,z,U){if("enter"===z)e.style.border="solid "+k.config.color_select_dark+" 2px";else if("exit"===z||"cancel"===z)e.style.border="";else if("over"===z);else if("drop"===z){e.style.border="";var b=e.value=U.view.draggingData.uuid;B.setFocus(),I.setValue(a,b)}}}return B},z.prototype.addImage=function(O,z,U,a,b){var T=this,d=new ht.widget.Image;d.vectorDataBindingDisabled=!0;var o=a||function(O){var z=ht.Default.getImage(O);return z&&z.snapshotURL?z.snapshotURL:O};this.updateHandlers.push(function(){if(!O.hidden){var U=T.getValue(z);d.rawIcon=U,d.setIcon(o(U))}});var I=d.getView();I.style.cursor="pointer";var B=function(O){O.preventDefault(),b&&!b(d)||(ht.Default.isDoubleClick(O)?T.editor.open(d.rawIcon):T.editor.selectFileNode(d.rawIcon))};return I.addEventListener("mousedown",B,!1),I.addEventListener("touchstart",B,!1),O.push(d),d},S(z,[{key:"type",set:function(O){this._type=O},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}},{key:"indent",get:function(){return hteditor.config.indent}},{key:"indent2",get:function(){return hteditor.config.indent2}}]),z}(hteditor.Inspector),h=ht.Default.preventDefault,r=ht.Default.isLeftButton,Q=ht.Default.isMiddleButton,p=ht.Default.getTouchCount,J=ht.Default.isCtrlDown,C=ht.Default.isShiftDown,F=ht.Default.getClientPoint,c=function(O){var z=O.touches[0],U=O.touches[1],a=z.clientX,b=z.clientY,T=U.clientX,d=U.clientY;return Math.sqrt((a-T)*(a-T)+(b-d)*(b-d))},E=function(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O},OO="undefined"!=typeof Float32Array?Float32Array:Array,zO=function(){return E(new OO(16))},UO=Math.abs,aO=Math.sqrt,bO=function(O,z,U,a){var b,T,d,o,I,B,k,e,H,S,f=z[0],W=z[1],A=z[2],i=a[0],M=a[1],Y=a[2],m=U[0],_=U[1],x=U[2];return UO(f-m)<1e-6&&UO(W-_)<1e-6&&UO(A-x)<1e-6?E(O):(k=f-m,e=W-_,H=A-x,S=1/aO(k*k+e*e+H*H),k*=S,e*=S,H*=S,b=M*H-Y*e,T=Y*k-i*H,d=i*e-M*k,S=aO(b*b+T*T+d*d),S?(S=1/S,b*=S,T*=S,d*=S):(b=0,T=0,d=0),o=e*d-H*T,I=H*b-k*d,B=k*T-e*b,S=aO(o*o+I*I+B*B),S?(S=1/S,o*=S,I*=S,B*=S):(o=0,I=0,B=0),O[0]=b,O[1]=o,O[2]=k,O[3]=0,O[4]=T,O[5]=I,O[6]=e,O[7]=0,O[8]=d,O[9]=B,O[10]=H,O[11]=0,O[12]=-(b*f+T*W+d*A),O[13]=-(o*f+I*W+B*A),O[14]=-(k*f+e*W+H*A),O[15]=1,O)},TO=function(O){function z(U){return H(this,z),W(this,O.call(this,U))}return f(z,O),z.prototype.handle_contextmenu=function(O){h(O)},z.prototype.handle_mousewheel=function(O){this.gv.handleScroll(O,O.wheelDelta/40)},z.prototype.handle_DOMMouseScroll=function(O){2===O.axis&&this.gv.handleScroll(O,-O.detail)},z.prototype.handle_keydown=function(O){this.gv.handleKeyDown(O)},z.prototype.handle_mousedown=function(O){this.handle_touchstart(O)},z.prototype.handle_touchstart=function(O){h(O);var z=this,U=z.gv,a=r(O),b=Q(O),T=U.getDataInfoAt(O),d=T?T.data:null,o=T?T.part:null,I=U.sm(),B=p(O),k=1===B;U.setFocus(O)&&(z.state=null,z.pendingCS=null,d?J(O)?I.co(d)?I.rs(d):I.as(d):I.co(d)||I.ss(d):a&&(z.pendingCS=F(O)),z.state||((a||b)&&k&&!d?z.state="pan":a&&k&&d instanceof ht.Node&&U.isSelected(d)?U.isMovable(d)&&(z.state="move",z.p3=d.p3(),z.movedata=d):ht.Default.isTouchable&&(B>2?z.state="pan":2===B&&(z.dist=c(O),z.state="pinch"))),z.point=U.lp(O),ht.Default.startDragging(z,O),ht.Default.isDoubleClick(O)?U.handleDoubleClick(O,d,o):U.handleClick(O,d,o))},z.prototype.handle_mouseup=function(O){this.handle_touchend(O)},z.prototype.handle_touchend=function(O){var z=this.pendingCS;z&&(ht.Default.getDistance(z,F(O))<=1&&this.gv.sm().cs(),this.pendingCS=null)},z.prototype.handleWindowMouseMove=function(O){this.handleWindowTouchMove(O)},z.prototype.handleWindowTouchMove=function(O){var z=this,U=z.gv,a=z.state,b=z.point,T=U.dm(),d=U.lp(O),o=d.x-b.x,I=d.y-b.y,B=U.getWidth(),k=U.getHeight();if(B&&k){if("move"===a){U._moving||T.beginTransaction(),U.fi({kind:U._moving?"betweenMove":"beginMove",event:O}),U._moving=1;var e=z.p3,H=U.getPositionInfo(e),S=bO(zO(),U._eye,U._center,U._up);o=o/B*H.width,I=-1*I/k*H.height;var f=[S[0]*o,S[4]*o,S[8]*o],W=[S[1]*I,S[5]*I,S[9]*I],A=f[0]+W[0],i=f[1]+W[1],M=f[2]+W[2],Y=[e[0]+A,e[1]+i,e[2]+M];U.moveSelection(A,i,M),z.p3=Y}else if("pinch"===a&&2===p(O)){U.fi({kind:U._pinching?"betweenPinch":"beginPinch",event:O}),U._pinching=1;var m=c(O);U.handlePinch(m,z.dist),z.dist=m}else("pan"===a||C(O))&&z.pan(O,o,I);z.point=d}},z.prototype.pan=function(O,z,U){var a=this.gv;if(a.isPannable()){var b=a.getWidth(),T=a.getHeight();if(!b||!T)return;var d=a.getCenterInfo(),o=z/b*d.width,I=-1*U/T*d.height;a.fi({kind:a._panning?"betweenPan":"beginPan",event:O}),a._panning=1,a.pan(-o,-I)}},z.prototype.handleWindowMouseUp=function(O){this.handleWindowTouchEnd(O)},z.prototype.handleWindowTouchEnd=function(O){var z=this,U=z.gv,a=U.dm();U._moving&&(delete U._moving,U.fi({kind:"endMove",event:O}),U.onMoveEnded(),a.endTransaction()),U._panning&&(delete U._panning,U.fi({kind:"endPan",event:O}),U.onPanEnded()),U._pinching&&(delete U._pinching,U.fi({kind:"endPinch",event:O}),U.onPinchEnded()),z.dist=z.point=z.state=z.p3=z.movedata=z.pendingCS=null},z}(ht.graph3d.Interactor),dO=hteditor.getString,oO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"scene",!0))}return f(z,O),z.prototype.initForm=function(){var z=this;O.prototype.initForm.call(this);var U=void 0;this.addTitle(dO("editor.titlescenes")),U=[],this.addLabelInput(U,dO("editor.vertices"),function(){var O=z.editor.scene.getRenderInfo();return O?O.vertices:""}),this.addLabelInput(U,dO("editor.faces"),function(){var O=z.editor.scene.getRenderInfo();return O?O.faces:""}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelInput(U,dO("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(U,[this.indent,.1]),U=[],U.push(dO("editor.camera")),this.addButton(U,null,dO("editor.reset"),"editor.resetsize.state",function(){z.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(U,"X",function(O){return parseFloat(z.editor.scene.getEye()[0])},function(O,U){var a=z.editor.scene.getEye();z.editor.scene.setEye(U,a[1],a[2])},"int",1),this.addLabelInput(U,"Y",function(O){return parseFloat(z.editor.scene.getEye()[1])},function(O,U){var a=z.editor.scene.getEye();z.editor.scene.setEye(a[0],U,a[2])},"int",1),this.addLabelInput(U,"Z",function(O){return parseFloat(z.editor.scene.getEye()[2])},function(O,U){var a=z.editor.scene.getEye();z.editor.scene.setEye(a[0],a[1],U)},"int",1),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]),U=[],U.push(dO("editor.center")),this.addButton(U,null,dO("editor.reset"),"editor.resetsize.state",function(){z.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(U,"X",function(O){return parseFloat(z.editor.scene.getCenter()[0])},function(O,U){var a=z.editor.scene.getCenter();z.editor.scene.setCenter(U,a[1],a[2])},"int",1),this.addLabelInput(U,"Y",function(O){return parseFloat(z.editor.scene.getCenter()[1])},function(O,U){var a=z.editor.scene.getCenter();z.editor.scene.setCenter(a[0],U,a[2])},"int",1),this.addLabelInput(U,"Z",function(O){return parseFloat(z.editor.scene.getCenter()[2])},function(O,U){var a=z.editor.scene.getCenter();z.editor.scene.setCenter(a[0],a[1],U)},"int",1),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]),U=[],this.addLabelRange(U,dO("editor.near"),function(){return z.editor.scene.getNear()},function(O,U){z.editor.scene.setNear(U)},1,void 0,1,"int"),this.addLabelRange(U,dO("editor.far"),function(){return z.editor.scene.getFar()},function(O,U){z.editor.scene.setFar(U)},0,void 0,100,"int"),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelColor(U,dO("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(U,[this.indent,.1]),U=[],this.addLabelColor(U,dO("editor.gridcolor"),function(O){var U=z.editor.scene.getGridColor();return U instanceof Array?"rgba("+Math.floor(255*U[0])+","+Math.floor(255*U[1])+","+Math.floor(255*U[2])+","+U[3]+")":z.editor.scene.getGridColor()},function(O,U){z.editor.scene.setGridColor(U)}),this.addRow(U,[this.indent,.1]),U=[],this.addLabelRange(U,dO("editor.gridsize"),function(O){return z.editor.scene.getGridSize()},function(O,U){z.editor.scene.setGridSize(U)},0,void 0,1,"int"),this.addLabelRange(U,dO("editor.gridgap"),function(O){return z.editor.scene.getGridGap()},function(O,U){z.editor.scene.setGridGap(U),z.editor.gv.getEditInteractor().setStyle("gridBlockSize",U)},1,void 0,1,"int"),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelImage(U,dO("editor.envmapimage"),function(O){return O.getEnvmap()},function(O,z){return O.setEnvmap(z)}),this.addRow(U,[this.indent,.1,20]);var a=this.editor.scene,b=this.editor.scene.getHighlightHelper(),T=hteditor.config.valueTypes.HighlightEnum;U=[],this.addLabelComboBox(U,dO("editor.highlight"),function(){return b.mode},function(O,z){b.mode=z},T.values,T.labels),this.addRow(U,[this.indent,.1]);var d=[],o=a.getPostProcessingModule("Bloom"),I=void 0,B=function(){I!==o.enable&&(o.enable?d.forEach(function(O,U){O.index=z.getRows().indexOf(k)+U+1,z.addRow(O.items,O.widths,O.height,O)}):z.removeRows(d),I=o.enable)};U=[],this.addLabelCheckBox(U,dO("editor.bloom"),function(){return o.enable},function(O,U){a.enablePostProcessing("Bloom",U),a.iv(),z.updateProperties()});var k=this.addOneRow(U);U=[],this.addLabelRange(U,dO("editor.bloomstrength"),function(){return o.strength},function(O,U){o.strength=U,a.iv(),z.updateProperties()},0,void 0,.01,"number"),d.push(this.addOneRow(U)),U=[],this.addLabelRange(U,dO("editor.bloomradius"),function(){return o.radius},function(O,U){o.radius=U,a.iv(),z.updateProperties()},0,void 0,.01,"number"),d.push(this.addOneRow(U)),U=[],this.addLabelRange(U,dO("editor.bloomthreshold"),function(){return o.threshold},function(O,U){o.threshold=U,a.iv(),z.updateProperties()},0,1,.01,"number"),d.push(this.addOneRow(U)),U=[];var e=["json","dm","gv"];this.addLabelFunction(U,dO("editor.onpredeserialize"),function(O){return O.a("onPreDeserialize")},function(O,z){O.a("onPreDeserialize",z)},"onPreDeserialize",e),this.addOneRow(U),U=[],e=["json","dm","gv","datas"],this.addLabelFunction(U,dO("editor.onpostdeserialize"),function(O){return O.a("onPostDeserialize")},function(O,z){O.a("onPostDeserialize",z)},"onPostDeserialize",e),this.addOneRow(U);var H=a.getMoveMode,S=function(){return"xyz"},f=new ht.Math.Vector3,W=new ht.Math.Vector3,A=new ht.Math.Vector3,i=function(O){if(O){f.fromArray(a.getCenter()),W.fromArray(a.getEye()),W.sub(f);var z=[0,1,0];"right"===O?z=[1,0,0]:"front"===O&&(z=[0,0,1]),A.fromArray(z).setLength(W.length()).add(f),a.setEye(A.toArray())}},M=a.getInteractors().toArray(),Y=new TO(a);U=[];var m=!1;this.addLabelComboBox(U,dO("editor.orthographic"),function(){return m},function(O,z){m=z,a.setOrtho(!!z),z?(a.getMoveMode=S,a.setInteractors([Y]),i(m)):(a.getMoveMode=H,a.setInteractors(M.slice(0))),a.setRotatable(!z),a.setResettable(!z),a.setWalkable(!z),a.setEditHelperDisabled(!!z)},[!1,"top","right","front"],[dO("editor.none"),dO("editor.viewtype.top"),dO("editor.viewtype.right"),dO("editor.viewtype.front")]),this.addOneRow(U);var _=a.getPostProcessingModule("Dof"),x=[],j=void 0,N=function(){j!==_.enable&&(_.enable?x.forEach(function(O,U){O.index=z.getRows().indexOf(w)+U+1,z.addRow(O.items,O.widths,O.height,O)}):z.removeRows(x),j=_.enable)};U=[],this.addLabelCheckBox(U,dO("editor.dof"),function(O){return _.enable},function(O,U){a.enablePostProcessing("Dof",U),U&&!_.image&&ht.Default.xhrLoad("assets/Depth.png",function(){_.image="assets/Depth.png",z.updateProperties()}),a.iv(),z.updateProperties()});var w=this.addOneRow(U);U=[],this.addLabelImage(U,dO("editor.dof.image"),function(O){return _.image},function(O,U){_.image=U,z.updateProperties()}),x.push(this.addOneRow(U)),U=[],this.addLabelRange(U,dO("editor.dof.aperture"),function(O){return parseFloat(_.aperture)},function(O,U){_.aperture=U,z.updateProperties()},0,1,.001,"number"),x.push(this.addOneRow(U)),this.addUpdateHandler(function(){B(),N()})},z}(K),IO=hteditor.getString,BO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"data",!1))}return f(z,O),z.prototype.initForm=function(){O.prototype.initForm.call(this),this.$12$(),this.addWireframeProperties(),this.addTransformProperties()},z.prototype.$12$=function(){var O=this;this.addTitle(IO("editor.titlebasic"));var z=[];this.addLabelInput(z,IO("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(z,IO("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelURL(z,IO("editor.navigate"),function(O){return O.a("navigate")||""},function(O,z){O.a("navigate",z)},function(O,z){var U=z.view.draggingData;return U&&("scene"===U.fileType||"display"===U.fileType)}),this.addLabelInput(z,IO("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelComboBoxURL(z,IO("editor.type"),function(O){return O.s("shape3d")},function(z,U){z.s("shape3d",U),O.editor.updateInspector()},["","billboard","plane","cone","cylinder","roundRect","sphere","torus","triangle"],void 0,void 0,function(O,z){return!!z.view.draggingData&&"model"===z.view.draggingData.fileType}),this.addImage(z,function(O){return O.s("shape3d")},void 0,function(O){return hteditor.isJSON(O)?O.substr(0,O.length-5)+".png":null},function(O){return hteditor.isJSON(O.rawIcon)}),this.addOneRow(z),z=[],this.addLabelCheckBox(z,IO("editor.selectable"),function(O){return O.s("3d.selectable")},function(O,z){O.s("2d.selectable",z),O.s("3d.selectable",z)}),this.addLabelCheckBox(z,IO("editor.movable"),function(O){return O.s("3d.movable")},function(O,z){O.s("2d.movable",z),O.s("3d.movable",z)}),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelCheckBox(z,IO("editor.editable"),function(O){return O.s("3d.editable")},function(O,z){O.s("2d.editable",z),O.s("3d.editable",z)}),this.addLabelCheckBox(z,IO("editor.visible"),function(O){return O.s("3d.visible")},function(O,z){O.s("2d.visible",z),O.s("3d.visible",z)}),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelCheckBox(z,IO("editor.interactive"),function(O){return O.s("interactive")},function(O,z){return O.s("interactive",z)}),this.addRow(z,[this.indent,.1]),z=[],this.addLabelRange(z,IO("editor.envmap"),function(O){return O.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(z,[this.indent,.1]),z=[],this.addLabelRange(z,IO("editor.brightness"),function(O){return O.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(z,[this.indent,.1]),z=[],this.addLabelObject(z,IO("editor.polygonoffset"),function(O){return O.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(z,[this.indent,.1])},z.prototype.addTransformProperties=function(){this.addTitle(IO("editor.titletransform"));var O=k.config.numberPrecision,z=O.position||0,U=0===z?"int":"number",a=1/Math.pow(10,z),b=[];b.push(IO("editor.position")),this.addButton(b,null,IO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Node&&O.p3(0,0,0)}),this.addLabelInput(b,"X",function(O){return Number(O.getX().toFixed(z))},function(O,z){return O.setX(parseFloat(z))},U,a),this.addLabelInput(b,"Y",function(O){return Number(O.getElevation().toFixed(z))},function(O,z){return O.setElevation(parseFloat(z))},U,a),this.addLabelInput(b,"Z",function(O){return Number(O.getY().toFixed(z))},function(O,z){return O.setY(parseFloat(z))},U,a),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var T=O.rotation||0;U=0===T?"int":"number",a=1/Math.pow(10,T),b=[],b.push(IO("editor.rotation")),this.addButton(b,null,IO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Node&&O.r3(0,0,0)}),this.addLabelInput(b,"X",function(O){return Number((180/Math.PI*O.getRotationX()).toFixed(T))},function(O,z){O instanceof ht.Node&&O.setRotationX(z*Math.PI/180)},U,a),this.addLabelInput(b,"Y",function(O){return Number((180/Math.PI*O.getRotationY()).toFixed(T))},function(O,z){O instanceof ht.Node&&O.setRotationY(z*Math.PI/180)},U,a),this.addLabelInput(b,"Z",function(O){return Number((180/Math.PI*O.getRotationZ()).toFixed(T))},function(O,z){O instanceof ht.Node&&O.setRotationZ(z*Math.PI/180)},U,a),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var d=O.size||0;U=0===d?"int":"number",a=1/Math.pow(10,d),b=[],b.push(IO("editor.size")),this.addButton(b,null,IO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Node&&O.s3(-1,-1,-1)}),this.addLabelInput(b,"X",function(O){return Number(O.getWidth().toFixed(d))},function(O,z){return O.setWidth(parseFloat(z))},U,a),this.addLabelInput(b,"Y",function(O){return Number(O.getTall().toFixed(d))},function(O,z){return O.setTall(parseFloat(z))},U,a),this.addLabelInput(b,"Z",function(O){return Number(O.getHeight().toFixed(d))},function(O,z){return O.setHeight(parseFloat(z))},U,a),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var o=O.anchor||0;U=0===o?"int":"number",a=1/Math.pow(10,o),b=[],b.push(IO("editor.anchor")),this.addButton(b,null,IO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Node&&O.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(b,"X",function(O){return Number(O.getAnchorX().toFixed(o))},function(O,z){O instanceof ht.Node&&O.setAnchor3d(parseFloat(z),O.getAnchorElevation(),O.getAnchorY(),!0)},U,a),this.addLabelInput(b,"Y",function(O){return Number(O.getAnchorElevation().toFixed(o))},function(O,z){O instanceof ht.Node&&O.setAnchor3d(O.getAnchorX(),parseFloat(z),O.getAnchorY(),!0)},U,a),this.addLabelInput(b,"Z",function(O){return Number(O.getAnchorY().toFixed(o))
},function(O,z){O instanceof ht.Node&&O.setAnchor3d(O.getAnchorX(),O.getAnchorElevation(),parseFloat(z),!0)},U,a),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var I=O.scale||0;U=0===I?"int":"number",a=1/Math.pow(10,I),b=[],b.push(IO("editor.scale")),this.addButton(b,null,IO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Node&&O.setScale3d(1,1,1)}),this.addLabelInput(b,"X",function(O){return Number(O.getScaleX().toFixed(I))},function(O,z){O instanceof ht.Node&&O.setScaleX(parseFloat(z))},U,a),this.addLabelInput(b,"Y",function(O){return Number(O.getScaleTall().toFixed(I))},function(O,z){O instanceof ht.Node&&O.setScaleTall(parseFloat(z))},U,a),this.addLabelInput(b,"Z",function(O){return Number(O.getScaleY().toFixed(I))},function(O,z){O instanceof ht.Node&&O.setScaleY(parseFloat(z))},U,a),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1])},z.prototype.addWireframeProperties=function(){this.addTitle(IO("editor.titlewireframe"));var O=[];this.addLabelComboBox(O,IO("editor.visible"),hteditor.getter("s","wf.visible"),function(O,z){O.s("wf.visible",z)},[!1,!0,"selected"]),this.addLabelCheckBox(O,IO("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(O,[this.indent,.1,this.indent2,.1]),O=[],this.addLabelColor(O,IO("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(O,[this.indent,.1]),O=[],this.addLabelCheckBox(O,IO("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),this.addLabelCheckBox(O,IO("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(O,[this.indent,.1,this.indent2,.1]),O=[],this.addLabelComboBox(O,IO("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[IO("editor.wfdontcombine"),IO("editor.wfcombineadjacent"),IO("editor.wfcombinecommon"),IO("editor.wfcombinesmooth")]),this.addRow(O,[this.indent,.1])},z}(K),kO=hteditor.getString,eO=["all","front","back","left","right","top","bottom"],HO=function(O,z,U){return function(a){var b=a.s(O+"."+z);return U&&void 0===b?a.s("all."+z):b}},SO=function(O){return function(z){var U=z.s(O);return U||(U=z.s("all.uv.scale")),U?U[0]:1}},fO=function(O){return function(z,U){var a=z.s(O);a||(a=z.s("all.uv.scale")),z.s(O,[U,a?a[1]:1])}},WO=function(O){return function(z){var U=z.s(O);return U||(U=z.s("all.uv.scale")),U?U[1]:1}},AO=function(O){return function(z,U){var a=z.s(O);a||(a=z.s("all.uv.scale")),z.s(O,[a?a[0]:1,U])}},iO=function(O){return function(z){z.s(O,null)}},MO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Cube"))}return f(z,O),z.prototype.initForm=function(){O.prototype.initForm.call(this),this.addCubeProperties()},z.prototype.addCubeProperties=function(){var O=void 0,z=void 0,U=0,a=new ht.widget.TabView;z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var T=eO[b]+".image";O=[],this.addLabelImage(O,kO("editor.face."+eO[b]),HO(eO[b],"image"),hteditor.setter("s",T)),z.addRow(O,[this.indent,.1,20])}I(a,kO("editor.image"),z,!0),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var d=eO[b]+".uv.scale";O=[],this.addLabel(O,kO("editor.face."+eO[b])),this.addButton(O,null,kO("editor.reset"),"editor.resetsize.state",iO(d)),this.addLabelInput(O,"U",SO(d),fO(d),"number",1),this.addLabelInput(O,"V",WO(d),AO(d),"number",1),z.addRow(O,[this.indent-20-8,20,20,.1,20,.1])}I(a,kO("editor.repeat"),z,!0),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var o=eO[b]+".color";O=[],this.addLabelColor(O,kO("editor.face."+eO[b]),HO(eO[b],"color"),hteditor.setter("s",o)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.color"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var B=eO[b]+".transparent";O=[],this.addLabelCheckBox(O,kO("editor.face."+eO[b]),HO(eO[b],"transparent"),hteditor.setter("s",B)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.transparent"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var k=eO[b]+".visible";O=[],this.addLabelCheckBox(O,kO("editor.face."+eO[b]),HO(eO[b],"visible",!0),hteditor.setter("s",k)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.visible"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var e=eO[b]+".reverse.color";O=[],this.addLabelColor(O,kO("editor.face."+eO[b]),HO(eO[b],"reverse.color"),hteditor.setter("s",e)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.reversecolor"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var H=eO[b]+".reverse.flip";O=[],this.addLabelCheckBox(O,kO("editor.face."+eO[b]),HO(eO[b],"reverse.flip",!0),hteditor.setter("s",H)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.reverseflip"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var b=0;b<eO.length;b++){var S=eO[b]+".reverse.cull";O=[],this.addLabelCheckBox(O,kO("editor.face."+eO[b]),HO(eO[b],"reverse.cull",!0),hteditor.setter("s",S)),z.addRow(O,[this.indent,.1])}I(a,kO("editor.reversecull"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight());var f=a.getTabHeight()+U;O=[],O.push(a),this.addRow(O,[.1],f)},z}(BO),YO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Cone"))}return f(z,O),z}(BO),mO=hteditor.getString,_O=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],xO=["shape3d","shape3d.top","shape3d.bottom"],jO=function(O){return function(z){var U=z.s(O);return U?U[0]:1}},NO=function(O){return function(z,U){var a=z.s(O);z.s(O,[U,a?a[1]:1])}},wO=function(O){return function(z){var U=z.s(O);return U?U[1]:1}},qO=function(O){return function(z,U){var a=z.s(O);z.s(O,[a?a[0]:1,U])}},DO=function(O){return function(z){z.s(O,null)}},vO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Shape3d"))}return f(z,O),z.prototype.initForm=function(){O.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},z.prototype.getCurrentPoint=function(O){return this.editor.currentPoint?this.editor.currentPoint[O]:0},z.prototype.setCurrentPoint=function(O,z){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(O,z)},z.prototype.addTopBodyBottomProperties=function(){var O=void 0,z=void 0,U=0,a=new ht.widget.TabView,b=this.faces;z=new ht.widget.FormPane;for(var T=0;T<b.length;T++){var d=b[T]+".image";O=[],this.addLabelImage(O,mO("editor.face."+b[T]),hteditor.getter("s",d),hteditor.setter("s",d)),z.addRow(O,[this.indent,.1,20])}I(a,mO("editor.image"),z,!0),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var T=0;T<b.length;T++){var o=b[T]+".uv.scale";O=[],this.addLabel(O,mO("editor.face."+b[T])),this.addButton(O,null,mO("editor.reset"),"editor.resetsize.state",DO(o)),this.addLabelInput(O,"U",jO(o),NO(o),"number",1),this.addLabelInput(O,"V",wO(o),qO(o),"number",1),z.addRow(O,[this.indent-20-8,20,20,.1,20,.1])}I(a,mO("editor.repeat"),z,!0),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var T=0;T<b.length;T++){var B=b[T]+".color";O=[],this.addLabelColor(O,mO("editor.face."+b[T]),hteditor.getter("s",B),hteditor.setter("s",B)),z.addRow(O,[this.indent,.1,20])}I(a,mO("editor.color"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane;for(var T=0;T<b.length;T++){var k=b[T]+".visible";O=[],this.addLabelCheckBox(O,mO("editor.face."+b[T]),hteditor.getter("s",k),hteditor.setter("s",k)),z.addRow(O,[this.indent,.1,20])}I(a,mO("editor.visible"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight()),z=new ht.widget.FormPane,O=[],this.addLabelColor(O,mO("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),z.addRow(O,[this.indent,.1]),O=[],this.addLabelCheckBox(O,mO("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),z.addRow(O,[this.indent,.1]),O=[],this.addLabelCheckBox(O,mO("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),z.addRow(O,[this.indent,.1]),I(a,mO("editor.reverse"),z),z.validateImpl(),U=Math.max(U,z.getScrollHeight());var e=a.getTabHeight()+U;O=[],O.push(a),this.addRow(O,[.1],e)},z.prototype.addEffectProperties=function(){this.addTitle(mO("editor.titleeffect"));var O=[];this.addLabelCheckBox(O,mO("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(O,[this.indent,.1]),O=[],this.addLabelColor(O,mO("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(O,[this.indent,.1]),O=[],this.addLabelRange(O,mO("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(O,[this.indent,.1]),O=[],this.addLabelRange(O,mO("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(O,[this.indent,.1]),this.simple||(O=[],this.addLabelRange(O,mO("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(O,[this.indent,.1]),O=[],this.addLabelRange(O,mO("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(O,[this.indent,.1]))},z.prototype.addExtraProperties=function(O){},S(z,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?xO:_O}}]),z}(BO),LO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Cylinder"))}return f(z,O),z}(vO),GO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"RoundRect"))}return f(z,O),z}(BO),VO=["shape3d","shape3d.from","shape3d.to"],uO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Sphere"))}return f(z,O),S(z,[{key:"faces",get:function(){return VO}}]),z}(vO),XO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Torus"))}return f(z,O),z}(BO),lO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Triangle"))}return f(z,O),z}(BO),ZO=hteditor.getString,tO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Model"))}return f(z,O),z.prototype.$12$=function(){O.prototype.$12$.call(this);var z=[];z=[],this.addLabelCheckBox(z,ZO("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(z,[this.indent,.1]),z=[],this.addLabelColor(z,ZO("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(z,[this.indent,.1]),z=[],this.addLabelColor(z,ZO("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(z,[this.indent,.1]),z=[],this.addLabelRange(z,ZO("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(z,[this.indent,.1]),z=[],this.addLabelCheckBox(z,ZO("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(z,[this.indent,.1])},z}(BO),PO=hteditor.getString,$O=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Billboard"))}return f(z,O),z.prototype.$12$=function(){var z=this;O.prototype.$12$.call(this),this.addTitle(PO("editor.titlepanel"));var U=[];this.addLabelImage(U,PO("editor.image"),function(O){return O.s("shape3d.image")},function(O,z){O.s("shape3d.image",z)}),this.addOneRow(U),U=[],this.addLabelInput(U,PO("editor.texturescale"),function(O){return O.s("shape3d.texture.scale")||1},hteditor.setter("s","shape3d.texture.scale"),"number");U[U.length-1];this.addOneRow(U),U=[],this.addLabelCheckBox(U,PO("editor.alwaysontop"),hteditor.getter("s","shape3d.alwaysOnTop"),hteditor.setter("s","shape3d.alwaysOnTop")),this.addLabelCheckBox(U,PO("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,PO("editor.autorotate"),hteditor.getter("s","shape3d.autorotate"),hteditor.setter("s","shape3d.autorotate"));var a=U[U.length-1];this.addLabelCheckBox(U,PO("editor.cache"),hteditor.getter("s","shape3d.image.cache"),function(O,U){O.s("shape3d.image.cache",U),U&&z.editor.scene.invalidateShape3dCachedImage(O)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,PO("editor.fitsize"),function(O){return!!O.s("shape3d.fixSizeOnScreen")},function(O,z){O.s("shape3d.fixSizeOnScreen",!!z&&[-1,-1]),z&&O.s("shape3d.autorotate",!0),a.setDisabled(z),b.setDisabled(z)}),this.addLabelCheckBox(U,PO("editor.dynamic"),hteditor.getter("s","shape3d.vector.dynamic"),hteditor.setter("s","shape3d.vector.dynamic"));var b=U[U.length-1];this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelColor(U,PO("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(U,[this.indent,.1]),U=[],this.addLabelColor(U,PO("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(U,[this.indent,.1]),U=[],this.addLabelCheckBox(U,PO("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(U,PO("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(U,[this.indent,.1,this.indent2,.1])},z}(BO),RO=hteditor.getString,nO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Wall"))}return f(z,O),z.prototype.$12$=function(){O.prototype.$12$.call(this);var z=[];this.addLabelCheckBox(z,RO("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(z,[this.indent,.1])},z.prototype.addTransformProperties=function(){O.prototype.addTransformProperties.call(this);var z=[];this.addLabelRange(z,RO("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(z,RO("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(z,RO("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(z,[this.indent,.1,30,.1,30,.1])},z}(MO),sO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Floor"))}return f(z,O),z}(LO),gO=hteditor.getString,KO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Pipeline"))}return f(z,O),z.prototype.addTransformProperties=function(){O.prototype.addTransformProperties.call(this);var z=[];this.addLabelRange(z,gO("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(z,gO("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(z,gO("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(z,[this.indent,.1,30,.1,30,.1])},z.prototype.addExtraProperties=function(z){O.prototype.addExtraProperties.call(this);var U=[];this.addLabelInput(U,gO("editor.startangle"),function(O){return Math.round(180/Math.PI*O.s("shape3d.start.angle"))},function(O,z){O.s("shape3d.start.angle",z*Math.PI/180)},"int",1),z.addRow(U,[this.indent,.1]),U=[],this.addLabelInput(U,gO("editor.sweepangle"),function(O){return Math.round(180/Math.PI*O.s("shape3d.sweep.angle"))},function(O,z){O.s("shape3d.sweep.angle",z*Math.PI/180)},"int",1),z.addRow(U,[this.indent,.1])},S(z,[{key:"simple",get:function(){return!0}}]),z}(vO),hO=hteditor.getString,yO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Polyline"))}return f(z,O),z.prototype.addTransformProperties=function(){var z=this;O.prototype.addTransformProperties.call(this);var U=[];this.addLabelRange(U,hO("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(U,hO("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(U,hO("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(U,[this.indent,.1,30,.1,30,.1]),U=[],U.push(hO("editor.point")),this.addButton(U,null,hO("editor.reset"),"editor.resetsize.state",function(O){z.setCurrentPoint("e",0)}),this.addLabelInput(U,"X",function(O){return z.getCurrentPoint("x")},function(O,U){z.setCurrentPoint("x",U)},"int",1),this.addLabelInput(U,"Y",function(O){return z.getCurrentPoint("e")},function(O,U){z.setCurrentPoint("e",U)},"int",1),this.addLabelInput(U,"Z",function(O){return z.getCurrentPoint("y")},function(O,U){z.setCurrentPoint("y",U)},"int",1),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1])},S(z,[{key:"simple",get:function(){return!0}}]),z}(vO),rO=hteditor.getString,QO=function(O){return function(z){var U=z.s(O);return U?U[0]:1}},pO=function(O){return function(z,U){var a=z.s(O);z.s(O,[U,a?a[1]:1])}},JO=function(O){return function(z){var U=z.s(O);return U?U[1]:1}},CO=function(O){return function(z,U){var a=z.s(O);z.s(O,[a?a[0]:1,U])}},FO=function(O){return function(z){z.s(O,null)}},cO=function(O){function z(U){return H(this,z),W(this,O.call(this,U,"Edge"))}return f(z,O),z.prototype.initForm=function(){O.prototype.initForm.call(this),this.$89$(),this.$91$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},z.prototype.$12$=function(){var O=this;this.addTitle(rO("editor.titlebasic"));var z=[];this.addLabelInput(z,rO("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(z,rO("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelURL(z,rO("editor.navigate"),function(O){return O.a("navigate")||""},function(O,z){O.a("navigate",z)},function(O,z){var U=z.view.draggingData;return U&&("scene"===U.fileType||"display"===U.fileType)}),this.addLabelInput(z,rO("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelComboBoxURL(z,rO("editor.type"),function(O){return O.s("shape3d")},function(z,U){z.s("shape3d",U),O.editor.updateInspector()},["","cylinder"],void 0,void 0,function(O,z){return!!z.view.draggingData&&"model"===z.view.draggingData.fileType}),this.addImage(z,function(O){return O.s("shape3d")},void 0,function(O){return hteditor.isJSON(O)?O.substr(0,O.length-5)+".png":null},function(O){return hteditor.isJSON(O.rawIcon)}),this.addOneRow(z),z=[],this.addLabelCheckBox(z,rO("editor.selectable"),function(O){return O.s("3d.selectable")},function(O,z){O.s("2d.selectable",z),O.s("3d.selectable",z)}),this.addLabelCheckBox(z,rO("editor.movable"),function(O){return O.s("3d.movable")},function(O,z){O.s("2d.movable",z),O.s("3d.movable",z)}),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelCheckBox(z,rO("editor.editable"),function(O){return O.s("3d.editable")},function(O,z){O.s("2d.editable",z),O.s("3d.editable",z)}),this.addLabelCheckBox(z,rO("editor.visible"),function(O){return O.s("3d.visible")},function(O,z){O.s("2d.visible",z),O.s("3d.visible",z)}),this.addRow(z,[this.indent,.1,this.indent2,.1]),z=[],this.addLabelCheckBox(z,rO("editor.interactive"),function(O){return O.s("interactive")},function(O,z){return O.s("interactive",z)}),this.addRow(z,[this.indent,.1]),z=[],this.addLabelRange(z,rO("editor.envmap"),function(O){return O.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(z,[this.indent,.1]),z=[],this.addLabelRange(z,rO("editor.brightness"),function(O){return O.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(z,[this.indent,.1]),z=[],this.addLabelObject(z,rO("editor.polygonoffset"),function(O){return O.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(z,[this.indent,.1])},z.prototype.addTransformProperties=function(){},z.prototype.$89$=function(){this.addTitle("TitleEdgeBasic");var O=[];this.addLabelComboBox(O,rO("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(O,[this.indent,.1]),O=[],this.addLabelInput(O,rO("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(O,rO("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(O,[this.indent,.1,this.indent2,.1]),O=[],this.addLabelInput(O,rO("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(O,rO("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(O,[this.indent,.1,this.indent2,.1]),O=[],this.addLabelColor(O,rO("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(O,rO("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(O,[this.indent,.1,this.indent2,.1]),O=[],this.addLabelImage(O,rO("editor.image"),hteditor.getter("s","shape3d.image"),hteditor.setter("s","shape3d.image")),this.addRow(O,[this.indent,.1,20]),O=[],this.addLabel(O,"UV"),this.addButton(O,null,rO("editor.reset"),"editor.resetsize.state",FO("shape3d.uv.scale")),this.addLabelInput(O,"U",QO("shape3d.uv.scale"),pO("shape3d.uv.scale"),"number",1),this.addLabelInput(O,"V",JO("shape3d.uv.scale"),CO("shape3d.uv.scale"),"number",1),this.addRow(O,[this.indent-20-8,20,20,.1,20,.1]),O=[],this.addLabel(O,"UV "+rO("editor.offset")),this.addButton(O,null,rO("editor.reset"),"editor.resetsize.state",FO("shape3d.uv.offset")),this.addLabelInput(O,"U",function(O){return(O.s("shape3d.uv.offset")||[0,0])[0]},function(O,z){var U=O.s("shape3d.uv.offset")||[];O.s("shape3d.uv.offset",[z,U[1]])},"number",.1),this.addLabelInput(O,"V",function(O){return(O.s("shape3d.uv.offset")||[0,0])[1]},function(O,z){var U=O.s("shape3d.uv.offset")||[];O.s("shape3d.uv.offset",[U[0],z])},"number",.1),this.addRow(O,[this.indent-20-8,20,20,.1,20,.1])},z.prototype.$91$=function(){},z.prototype.addEdgeSourceNodeProperties=function(){var O=k.config.numberPrecision;this.addTitle("editor.titleedgesourcenode");var z=[];this.addLabelData(z,rO("editor.node"),hteditor.getter("p","source"),function(O,z){O instanceof ht.Edge&&(null==z||z instanceof ht.Node||z instanceof ht.Edge)&&(O.setSource(z),O.s("edge.source.percent",.5))}),this.addRow(z,[this.indent,.1,20]);var U=O.anchor||0,a=0===U?"int":"number",b=1/Math.pow(10,U);z=[],z.push(rO("editor.anchor")),this.addButton(z,null,rO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Edge&&O.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(z,"X",function(O){var z=O.s("edge.source.anchor.x");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.source.anchor.x",parseFloat(z))},a,b),this.addLabelInput(z,"Y",function(O){var z=O.s("edge.source.anchor.elevation");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.source.anchor.elevation",parseFloat(z))},a,b),this.addLabelInput(z,"Z",function(O){var z=O.s("edge.source.anchor.y");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.source.anchor.y",parseFloat(z))},a,b),this.addRow(z,[this.indent-40-8,20,20,.1,20,.1,20,.1])},z.prototype.addEdgeTargetNodeProperties=function(){var O=k.config.numberPrecision;this.addTitle("editor.titleedgetargetnode");var z=[];this.addLabelData(z,rO("editor.node"),hteditor.getter("p","target"),function(O,z){O instanceof ht.Edge&&(null==z||z instanceof ht.Node||z instanceof ht.Edge)&&(O.setTarget(z),O.s("edge.target.percent",.5))}),this.addRow(z,[this.indent,.1,20]);var U=O.anchor||0,a=0===U?"int":"number",b=1/Math.pow(10,U);z=[],z.push(rO("editor.anchor")),this.addButton(z,null,rO("editor.reset"),"editor.resetsize.state",function(O){O instanceof ht.Edge&&O.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(z,"X",function(O){var z=O.s("edge.target.anchor.x");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.target.anchor.x",parseFloat(z))},a,b),this.addLabelInput(z,"Y",function(O){var z=O.s("edge.target.anchor.elevation");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.target.anchor.elevation",parseFloat(z))},a,b),this.addLabelInput(z,"Z",function(O){var z=O.s("edge.target.anchor.y");return null==z&&(z=.5),Number(z.toFixed(U))},function(O,z){O instanceof ht.Edge&&O.s("edge.target.anchor.y",parseFloat(z))},a,b),this.addRow(z,[this.indent-40-8,20,20,.1,20,.1,20,.1])},z}(BO),EO=hteditor.getString,Oz=function(O){function z(U){H(this,z);var a=W(this,O.call(this));a.editor=U;var b=[];return b.push({label:EO("editor.ok"),action:function(){a.ok()}}),b.push({label:EO("editor.cancel"),action:function(){a.hide()}}),a.dm=new ht.DataModel,a.node=new ht.Node,a.node.s("wf.visible",!0),a.node.setAnchor3d(.5,0,.5),a.dm.add(a.node),a.g3d=new ht.graph3d.Graph3dView(a.dm),a.g3d.setGridVisible(!0),a.formPane=a.createFromPane(),a.splitView=new ht.widget.SplitView(a.g3d,a.formPane,"h",.55),a.setConfig({title:EO("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:a.splitView,buttons:b,buttonsAlign:"right"}),a.setModal(!1),a}return f(z,O),z.prototype.toJSON=function(){var O={modelType:"obj"};return O.obj=this.formPane.v("obj"),O.mtl=this.formPane.v("mtl"),O.image=this.formPane.v("imageURL"),O.prefix=this.formPane.v("prefix"),O.center=this.formPane.v("center"),this.formPane.v("reverseFlipMtls")&&(O.reverseFlipMtls="*"),O.ignoreImage=!!this.formPane.v("ignoreImage"),O.ignoreColor=!!this.formPane.v("ignoreColor"),O.s3=[Number(this.formPane.v("sX")),Number(this.formPane.v("sY")),Number(this.formPane.v("sZ"))],O.r3=[Number(this.formPane.v("rX")),Number(this.formPane.v("rY")),Number(this.formPane.v("rZ"))],O},z.prototype.ok=function(){var O=this,z=this.formPane.v("url");if(z){this.json=this.toJSON();var U={path:z,content:ht.Default.stringify(this.json)};this.editor.request("upload",U,function(a){U={path:z.substr(0,z.length-5)+".png",content:O.g3d.toDataURL(O.dm.getBackground())},O.editor.request("upload",U,function(z){O.hide()})})}},z.prototype.open=function(O,z){this.url=O,this.json=z,this.node.s("shape3d",O),this.node.p3(0,0,0),this.g3d.reset(),this.update(),this.isShowing()||this.show()},z.prototype.update=function(){var O=this.json;if(this.url){this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",this.url);var z=ht.Default.getShape3dModel(this.url);if(z&&z.rawS3){var U=z.rawS3[0],a=z.rawS3[1],b=z.rawS3[2],T=Math.max(a,U/(this.g3d.getAspect()||1)),d=T/2/Math.tan(this.g3d.getFovy()/2);d=2*Math.max(b/2,d),this.g3d.setEye(0,a/2,d),this.g3d.setCenter(0,a/2,0),this.g3d.setNear(Math.min(10,d/4)),this.g3d.setFar(Math.max(1e4,4*d)),O=this.json=ht.Default.parse(ht.Default.stringify(z.json))}}else this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url",this.editor.models.currentDir+"/***.json");O||(O={obj:"",mtl:"",imageURL:"",prefix:"",center:!0,s3:[1,1,1],r3:[0,0,0],image:null}),this.formPane.v("obj",O.obj||""),this.formPane.v("mtl",O.mtl||""),this.formPane.v("imageURL",O.image||""),this.formPane.v("prefix",O.prefix||""),this.formPane.v("reverseFlipMtls",!!O.reverseFlipMtls),this.formPane.v("center",!!O.center);var o=O.s3||[1,1,1];this.formPane.v("sX",o[0]),this.formPane.v("sY",o[1]),this.formPane.v("sZ",o[2]);var I=O.r3||[0,0,0];this.formPane.v("rX",I[0]),this.formPane.v("rY",I[1]),this.formPane.v("rZ",I[2]),this.formPane.getItemById("image").element.setIcon(O.image)},z.prototype.createFromPane=function(){var O=this,z=new ht.widget.FormPane;z.addRow([{element:EO("editor.url")},{id:"url",textField:{}}],[60,.1]),z.addRow([{element:"obj"},{id:"obj",textField:{handleChange:function(){var U=a.value;z.v("prefix")||z.v("prefix",U.substr(0,U.lastIndexOf("/")+1)),z.v("mtl")||z.v("mtl",U.substr(0,U.length-3)+"mtl"),O.updateModel()}}}],[60,.1]);var U=z.getViewById("obj"),a=U.getElement();U.isDroppable=function(O,z){return!!z.view.draggingData&&b(z.view.draggingData.getFileUUID())},U.handleCrossDrag=function(O,z,b){"enter"===z?a.style.border="solid "+k.config.color_select_dark+" 2px":"exit"===z||"cancel"===z?a.style.border="":"over"===z||"drop"===z&&(a.style.border="",a.value=b.view.draggingData.getFileUUID(),U.setFocus(),U.handleChange())},z.addRow([{element:"mtl"},{id:"mtl",textField:{handleChange:function(){var U=o.value;z.v("prefix")||z.v("prefix",U.substr(0,U.lastIndexOf("/")+1)),z.v("obj")||z.v("obj",U.substr(0,U.length-3)+"obj"),O.updateModel()}}}],[60,.1]);var d=z.getViewById("mtl"),o=d.getElement();d.isDroppable=function(O,z){return!!z.view.draggingData&&T(z.view.draggingData.getFileUUID())},d.handleCrossDrag=function(O,z,U){"enter"===z?o.style.border="solid "+k.config.color_select_dark+" 2px":"exit"===z||"cancel"===z?o.style.border="":"over"===z||"drop"===z&&(o.style.border="",o.value=U.view.draggingData.getFileUUID(),d.setFocus(),d.handleChange())},z.addRow([{element:EO("editor.imageprefix")},{id:"prefix",textField:{}}],[60,.1]),z.addRow([{element:EO("editor.reverseFlipMtls")},{id:"reverseFlipMtls",checkBox:{onClicked:function(){O.updateModel()}}},{element:EO("editor.modelcenter"),align:"right"},{id:"center",checkBox:{onClicked:function(){O.updateModel()}}}],[60,.1,60,.1]),z.addRow([{element:EO("editor.modelignoreImage")},{id:"ignoreImage",checkBox:{onClicked:function(){O.updateModel()}}},{element:EO("editor.modelignoreColor"),align:"right"},{id:"ignoreColor",checkBox:{onClicked:function(){O.updateModel()}}}],[60,.1,60,.1]),z.addRow([],[.1],1.01,{background:"#E4E4E4"}),z.addRow([null,"X","Y","Z"],[60,.1,.1,.1]),z.addRow([EO("editor.scale"),{id:"sX",textField:{type:"number"}},{id:"sY",textField:{type:"number"}},{id:"sZ",textField:{type:"number"}}],[60,.1,.1,.1]);var I=k.config.numberPrecision,B=I.rotation||0;z.addRow([EO("editor.rotation"),{id:"rX",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(O){this.setText((O/Math.PI*180).toFixed(B))},type:"number"}},{id:"rY",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(O){this.setText((O/Math.PI*180).toFixed(B))},type:"number"}},{id:"rZ",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(O){this.setText((O/Math.PI*180).toFixed(B))},type:"number"}}],[60,.1,.1,.1]),["s","r"].forEach(function(U){["X","Y","Z"].forEach(function(a){var b=z.getViewById(U+a).getElement();b.onblur=function(){return O.updateModel()},b.onkeydown=function(z){ht.Default.isEnter(z)&&O.updateModel()}})}),z.addRow([],[.1],1.01,{background:"#E4E4E4"}),z.addRow([{element:EO("editor.image")},{id:"imageURL",textField:{}}],[60,.1]),z.addRow([{id:"image",image:{}}],[.1],70);var e=z.getViewById("imageURL").getElement();return e.onblur=function(z){O.formPane.getItemById("image").element.setIcon(e.value)},e.onkeydown=function(z){ht.Default.isEnter(z)&&O.formPane.getItemById("image").element.setIcon(e.value)},z},z.prototype.updateModel=function(){var O=this.toJSON(),z=JSON.stringify(O);this._currentJSON!==z&&(this.node.s("shape3d",O),this._currentJSON=z)},z}(ht.widget.Dialog),zz=hteditor.getString,Uz=function(){function b(O){
var z=this;H(this,b),this.params=O,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$39$=O.$39$;var U=ht.Default.getClass(hteditor.config.serviceClass||A);this.$40$=new U(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(O,U){for(var a in z.modelDialogs){var b=z.modelDialogs[a];O===b.url&&b.isShowing()&&b.update&&b.update()}z.inspector&&z.inspector.updateProperties()},this.serializer=new ht.JSONSerializer,this.serializer.isSerializable=function(O){return z.scene.sm().contains(O)},this.editable=!0}return b.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},b.prototype.removeEventListener=function(O,z){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},b.prototype.fireEvent=function(O,z){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},b.prototype.handleServiceEvent=function(b){if("connected"===b.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===b.type){var T=b.path;o(T)&&(this.scene.invalidateAll(),this.gv.invalidateAll()),O(T)?this.requestScenes():z(T)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):U(T)?this.requestSymbols():a(T)&&this.requestAssets()}else"download"===b.type?this.downloadFile(b.path):"confirm"===b.type&&this.requestImport(b.path);this.fireEvent(b.type,b)},b.prototype.downloadFile=function(O){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},b.prototype.requestImport=function(O){hteditor.Editor.prototype.requestImport.apply(this,arguments)},b.prototype.beginTransaction=function(){this.dm.beginTransaction()},b.prototype.endTransaction=function(){this.dm.endTransaction()},b.prototype.toggleGridEnabled=function(){this.gridVisible=!this.gridVisible},b.prototype.init=function(){var O=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new X(this),this.rulerView=new u(this.gv),this.scene=new G(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.sceneInspector=new oO(this),this.dataInspector=new BO(this),this.cubeInspector=new MO(this),this.coneInspector=new YO(this),this.cylinderInspector=new LO(this),this.roundRectInspector=new GO(this),this.sphereInspector=new uO(this),this.torusInspector=new XO(this),this.triangleInspector=new lO(this),this.modelInspector=new tO(this),this.billboardInspector=new $O(this),this.wallInspector=new nO(this),this.floorInspector=new sO(this),this.pipelineInspector=new KO(this),this.polylineInspector=new yO(this),this.edgeInspector=new cO(this),this.mainToolbar=new D(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new L(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){O.topBorderPane.setRightWidth(O.rightToolbar.getSumWidth())},this.$5$("edit"),this.mainTabView=new ht.widget.TabView,this.scenes=new i(this),this.models=new M(this),this.symbols=new Y(this),this.assets=new m(this),this.leftTopTabView=new ht.widget.TabView,I(this.leftTopTabView,zz("editor.scenes"),this.scenes,!0),I(this.leftTopTabView,zz("editor.models"),this.models),I(this.leftTopTabView,zz("editor.symbols"),this.symbols),I(this.leftTopTabView,zz("editor.assets"),this.assets),this.treeView=new R(this),this.jsonView=new n(this),this.rightBottomTabView=new ht.widget.TabView,I(this.rightBottomTabView,zz("editor.list"),this.treeView,!0),I(this.rightBottomTabView,zz("editor.data"),this.jsonView);var z=this.rightBottomTabView.getTabModel().sm();z.ms(function(){var U=z.ld();O.jsonView.visible=(U?U.getView():null)===O.jsonView}),this.alignPane=new g(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$39$),this.$39$&&this.$39$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$39$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.reset(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var U=this.params.open||B("hteditor")||hteditor.config.open;U&&(hteditor.isJSON(U)?this._pendingOpenJSON=U:"newscene"===U&&this.newScene())},b.prototype.initSID=function(){var O=window.location.href.match("sid=([0-9a-z-]*)");O&&(this.sid=O[1])},b.prototype.handleDataModelPropertyChange=function(O){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},b.prototype.handleScenelPropertyChange=function(O){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},b.prototype.handleDataModelChange=function(O){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},b.prototype.handleDataPropertyChange=function(O){var z=O.data;if("parent"===O.property&&z instanceof ht.Node&&!ht.Default.isIsolating()){var U=z.getParent();(!U||U instanceof ht.Node&&!(U instanceof ht.Block))&&z.setHost(U)}this.inspector&&!this.inspector.global&&this.inspector.data===z&&this.inspector.updateProperties(),this.jsonView.$67$()},b.prototype.handleSelectionChange=function(){this.updateInspector()},b.prototype.handleInteractor=function(O){"selectPoint"===O.kind&&(this.currentPoint=void 0===O.x?null:{x:O.x,y:O.y,e:O.e},this.updateInspector())},b.prototype.updateInspector=function(){this.inspector=null;var O=this.ld;if(O){var z=O.s("shape3d");O instanceof ht.Polyline?this.inspector=this.polylineInspector:O instanceof ht.Shape?"cylinder"===z?this.inspector=this.pipelineInspector:O.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:O instanceof ht.Node?z?hteditor.isJSON(z)?this.inspector=this.modelInspector:"billboard"===z||"plane"===z?this.inspector=this.billboardInspector:"cube"===z?this.inspector=this.cubeInspector:"cone"===z?this.inspector=this.coneInspector:"cylinder"===z?this.inspector=this.cylinderInspector:"roundRect"===z?this.inspector=this.roundRectInspector:"sphere"===z?this.inspector=this.sphereInspector:"torus"===z?this.inspector=this.torusInspector:"triangle"===z&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:O instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=O,this.inspector.updateProperties()),this.rightTopBorderPane.setCenterView(this.inspector)},b.prototype.reset=function(O){O||(this.url=null),this.dm.disableHistoryManager(),this.scene.setCenter([0,0,0]),this.scene.setEye([0,300,1e3]),this.scene.enablePostProcessing("Bloom",!1),this.scene.enablePostProcessing("Dof",!1),this.gridVisible=!0,this.dm.setName(void 0),this.dm.setBackground(void 0),this.dm.setHierarchicalRendering(!0),this.dm.setLayers(void 0),this.dm.setAttrObject(void 0),this.dm.setEnvmap(void 0),this.dm.clear(),this.editInteractor.setStyle("gridBlockSize",50),this.editInteractor.setStyle("gridThickLinesEvery",hteditor.config.displayGridThickLinesEvery),this.editInteractor.setStyle("gridThickColor",hteditor.config.displayGridThickColor),this.editInteractor.setStyle("gridLightColor",hteditor.config.displayGridLightColor),this.editInteractor.setStyle("gridAngle",hteditor.config.displayGridAngle),this.editInteractor.setStyle("gridRotation",hteditor.config.displayGridRotation),this.editInteractor.setStyle("gridZoomThreshold",.02),this.dm.enableHistoryManager(),this.dm.clearHistoryManager()},b.prototype.getModelDialog=function(O){var z=this.modelDialogs[O];if(!z){var U=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[O]:null;U||(U=Oz),z=this.modelDialogs[O]=new U(this)}return z},b.prototype.open=function(O,z){var U=this;if(ht.Default.isString(O)&&(O=this.getFileNode(O)),O&&!O.$34$){var a=O.url;"scene"===O.fileType?this.newScene(a):"model"===O.fileType&&ht.Default.xhrLoad(a,function(O){O=ht.Default.parse(O),U.getModelDialog(O.modelType).open(a,O)})}},b.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},b.prototype.newScene=function(O){O?(this.opened=!1,this.url=O,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},b.prototype.reload=function(){var O=this,z=this.url;z&&(this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:z}),this.reset(!0),this.dm.disableHistoryManager(),this.scene.deserialize(z,{finishFunc:function(U,a){O.gv.fitContent(!0);var b=U.scene;O.scene.setEye(b.eye),O.scene.setCenter(b.center),O.scene.setFar(b.far),O.scene.setNear(b.near),O.gridVisible=!!b.gridVisible,O.scene.setGridColor(b.gridColor),O.scene.setGridGap(b.gridGap),O.scene.setGridSize(b.gridSize),O.scene.setEditHelperDisabled(!!b.editHelperDisabled),O.rightToolbar.iv(),O.dm.enableHistoryManager(),O.dm.clearHistoryManager(),O.fireEvent(O.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:O,url:z}),O.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0}))},b.prototype.save=function(){var O=this;if(this.url)this.saveImpl(this.url);else{var z=this.scenes.currentDir,U=zz("editor.inputnewscenename"),a=function(U,a){if("ok"===a){var b=hteditor.isJSON(U)?hteditor.trimExtension(U):U,T=z+"/"+b+".json",d=!1;if(O.scenes.dataModel.each(function(O){O.url===T&&(d=!0)}),d){var o=[{label:zz("editor.ok"),action:function(){I.hide()}}],I=new ht.widget.Dialog({title:zz("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+T+"</p>",buttons:o});I.show()}else O.saveImpl(T)}},b={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",b),b.name?a(b.name,"ok"):hteditor.getInput(U,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},a)}},b.prototype.saveImpl=function(O){var z=this;if(O){this.url=O;var U={url:O,scene:this.scene};if(this.fireEvent("sceneSaving",U),U.preventDefault)return!1;U={path:U.url,content:this.serialize()},this.request("upload",U,function(a){!0===a&&(z.fireEvent("sceneSaved",U),U={path:O.substr(0,O.length-5)+".png",content:z.scene.toImage(z.dm.getBackground())},z.request("upload",U))})}},b.prototype.preview=function(){var O=this.dm.a("previewURL")||"scene.html";this.url&&-1===O.indexOf("?")&&(O+="?tag="+encodeURI(this.url));var z={url:O};this.fireEvent("sceneViewPreviewing",z),window.open(z.url,z.url),z={path:"previews/scene.json",content:this.serialize()},this.request("upload",z,function(O){})},b.prototype.deserialize=function(O){var z=this;this.scene.deserialize(O,function(O,U,a){var b=O.scene;b&&(b.eye&&z.scene.setEye(b.eye),b.center&&z.scene.setCenter(b.center),b.near&&z.scene.setNear(b.near),b.far&&z.scene.setFar(b.far),b.background&&z.dm.setBackground(b.background),b.gridSize&&z.scene.setGridSize(b.gridSize),b.gridGap&&z.scene.setGridGap(b.gridGap),b.gridColor&&z.scene.setGridColor(b.gridColor))})},b.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},b.prototype.toJSON=function(){var O=this.dm.toJSON();return O.scene={eye:this.scene.getEye(),center:this.scene.getCenter(),near:this.scene.getNear(),far:this.scene.getFar(),background:this.dm.getBackground(),gridVisible:this.gridVisible,gridSize:this.scene.getGridSize(),gridGap:this.scene.getGridGap(),gridColor:this.scene.getGridColor(),editHelperDisabled:this.scene.isEditHelperDisabled()},O},b.prototype.$4$=function(){return this._interactionState},b.prototype.$5$=function(O,z){var U=this;if(this._interactionState!==O){this._interactionState=O,this.pointsEditingMode=!1;var a=[];this.gv.getInteractors().each(function(z){z.keep?z.interactiveDisabled="edit"!==O:a.push(z)}),a.forEach(function(O){O.tearDown(),U.gv.getInteractors().remove(O)}),"edit"!==O&&(z.setUp(),this.gv.getInteractors().add(z)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},b.prototype.request=function(O,z,U,a){var b=this;U=U||e,a?setTimeout(function(){b.$40$.request(O,z,U)},a):this.$40$.request(O,z,U)},b.prototype.requestScenes=function(){var z=this;this._requestingScenes||(this.request("explore","/scenes",function(U){z._requestingScenes=!1,z.scenes.parse(U),z._pendingOpenJSON&&O(z._pendingOpenJSON)&&(z.scenes.dataModel.getDataById(z._pendingOpenJSON)?(z.open(z._pendingOpenJSON),z.selectFileNode(z._pendingOpenJSON)):k.config.newIfFailToOpen&&(z.newScene(),z.url=z._pendingOpenJSON,z.save()),delete z._pendingOpenJSON)},hteditor.config.requestDelay),this._requestingScenes=!0)},b.prototype.requestSymbols=function(){var O=this;this._requestingSymbols||(this.request("explore","/symbols",function(z){O._requestingSymbols=!1,O.symbols.parse(z)},hteditor.config.requestDelay),this._requestingSymbols=!0)},b.prototype.requestModels=function(){var O=this;this._requestingModels||(this.request("explore","/models",function(z){O._requestingModels=!1,O.models.parse(z)},hteditor.config.requestDelay),this._requestingModels=!0)},b.prototype.requestAssets=function(){var O=this;this._requestingAssets||(this.request("explore","/assets",function(z){O._requestingAssets=!1,O.assets.parse(z)},hteditor.config.requestDelay),this._requestingAssets=!0)},b.prototype.requestBase64=function(O,z){this.request("source",{url:O,encoding:"base64",prefix:"data:;base64,"},z)},b.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm();var O=this.serializer.toJSON();delete O.p,delete O.a,this._cloneJSON=ht.Default.stringify(O)}},b.prototype.paste=function(){if(this._cloneJSON){var O=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(O)}},b.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},b.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},b.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},b.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},b.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},b.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},b.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},b.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},b.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},b.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},b.prototype.handleKeydown=function(O){try{hteditor.Editor.prototype.handleKeydown.apply(this,arguments)}catch(O){return}var z=O.keyCode,U=ht.Default.isCtrlDown(O),a=ht.Default.isShiftDown(O);if(90===z){if(!U&&!a){var b=this.dm.sm().getSelection();0===b.length&&(b=null),this.zoomToFit(b)}}else if(71===z&&U){if(a){var T=this.dm.sm().ld();if(!T||!T.s("__group__"))return;this.beginTransaction();var d=T.getChildren().toArray();return d.forEach(function(O){O.setParent(null),O.setHost(null)}),this.dm.remove(T),this.dm.sm().ss(d),void this.endTransaction()}if(0===this.dm.sm().size())return;var o=this.scene.getBoundingBox(),I=o.min,B=o.max,k=B[0]-I[0],e=B[2]-I[2],H=B[1]-I[1];this.beginTransaction();var S=new ht.Node;S.s3(k,H,e),S.p3(I[0]+.5*k,I[1]+.5*H,I[2]+.5*e),S.s({shape3d:"box","shape3d.transparent":!0,"shape3d.color":"rgba(0, 0, 0, 0)","shape3d.reverse.cull":!0,__group__:!0}),this.dm.add(S);var b=this.dm.sm().getSelection();b.forEach(function(O){O.setParent(S),O.setHost(S)}),this.dm.sm().ss(S),this.endTransaction()}},b.prototype.selectFileNode=function(O){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},b.prototype.dropLocalFileOnDir=function(O,z){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},b.prototype.uploadLocalFile=function(O,z){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},b.prototype.zoomToFit=function(O){this.scene.flyTo(O,{animation:!0});var z=this.gv;if(!O)return void z.fitContent(!0);var U;O.each(function(O){U=ht.Default.unionRect(U,z.getDataUIBounds(O))}),ht.Default.grow(U,20,20),z.fitRect(U,!0)},S(b,[{key:"url",get:function(){return this._url},set:function(O){this._url=O,this.jsonView.updateUrl()}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(O){this.editInteractor.pointsEditingMode=O}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(O){this.editInteractor.setStyle("anchorVisible",O)}},{key:"gridVisible",get:function(){return this.scene.isGridVisible()},set:function(O){this.scene.setGridVisible(O),this.scene.setOriginAxisVisible(O),this.editInteractor.gridEnabled=O}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}}]),b}();return k.version="0.3.1",k.createEditor3d=function(O){if(window.location.host.indexOf("hightopo")>=0){var z="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+z+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}O&&(ht.Default.isString(O)?O={container:O}:O.tagName&&O.appendChild&&(O={container:O})),O=O||{};var U=void 0,a=void 0===O.container?k.config.container:O.container;return null===a?U=null:a?ht.Default.isString(a)?U=document.getElementById(a):a.length?(U=ht.Default.createDiv(),U.style.left=a[0]+"px",U.style.top=a[1]+"px",U.style.width=a[2]+"px",U.style.height=a[3]+"px",document.body.appendChild(U)):U=a:U=document.body,O.$39$=U,new Uz(O)},k.config.valueTypes||(k.config.valueTypes={}),k.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},k}();